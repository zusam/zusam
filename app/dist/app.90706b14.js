parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"OmAK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createElement=exports.h=r,exports.cloneElement=s,exports.createRef=j,exports.Component=R,exports.render=H,exports.rerender=d,exports.options=exports.default=void 0;var e=function(){},t={};exports.options=t;var n=[],o=[];function r(r,i){var l,a,s,p,c=o;for(p=arguments.length;p-- >2;)n.push(arguments[p]);for(i&&null!=i.children&&(n.length||n.push(i.children),delete i.children);n.length;)if((a=n.pop())&&void 0!==a.pop)for(p=a.length;p--;)n.push(a[p]);else"boolean"==typeof a&&(a=null),(s="function"!=typeof r)&&(null==a?a="":"number"==typeof a?a=String(a):"string"!=typeof a&&(s=!1)),s&&l?c[c.length-1]+=a:c===o?c=[a]:c.push(a),l=s;var u=new e;return u.nodeName=r,u.children=c,u.attributes=null==i?void 0:i,u.key=null==i?void 0:i.key,void 0!==t.vnode&&t.vnode(u),u}function i(e,t){for(var n in t)e[n]=t[n];return e}function l(e,t){null!=e&&("function"==typeof e?e(t):e.current=t)}var a="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;function s(e,t){return r(e.nodeName,i(i({},e.attributes),t),arguments.length>2?[].slice.call(arguments,2):e.children)}var p=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,c=[];function u(e){!e._dirty&&(e._dirty=!0)&&1==c.push(e)&&(t.debounceRendering||a)(d)}function d(){for(var e;e=c.pop();)e._dirty&&D(e)}function f(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&v(e,t.nodeName):n||e._componentConstructor===t.nodeName}function v(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function m(e){var t=i({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var o in n)void 0===t[o]&&(t[o]=n[o]);return t}function _(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}function h(e){var t=e.parentNode;t&&t.removeChild(e)}function y(e,t,n,o,r){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)l(n,null),l(o,e);else if("class"!==t||r)if("style"===t){if(o&&"string"!=typeof o&&"string"!=typeof n||(e.style.cssText=o||""),o&&"object"==typeof o){if("string"!=typeof n)for(var i in n)i in o||(e.style[i]="");for(var i in o)e.style[i]="number"==typeof o[i]&&!1===p.test(i)?o[i]+"px":o[i]}}else if("dangerouslySetInnerHTML"===t)o&&(e.innerHTML=o.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),o?n||e.addEventListener(t,b,a):e.removeEventListener(t,b,a),(e._listeners||(e._listeners={}))[t]=o}else if("list"!==t&&"type"!==t&&!r&&t in e){try{e[t]=null==o?"":o}catch(c){}null!=o&&!1!==o||"spellcheck"==t||e.removeAttribute(t)}else{var s=r&&t!==(t=t.replace(/^xlink:?/,""));null==o||!1===o?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof o&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),o):e.setAttribute(t,o))}else e.className=o||""}function b(e){return this._listeners[e.type](t.event&&t.event(e)||e)}var x=[],g=0,C=!1,N=!1;function w(){for(var e;e=x.shift();)t.afterMount&&t.afterMount(e),e.componentDidMount&&e.componentDidMount()}function k(e,t,n,o,r,i){g++||(C=null!=r&&void 0!==r.ownerSVGElement,N=null!=e&&!("__preactattr_"in e));var l=S(e,t,n,o,i);return r&&l.parentNode!==r&&r.appendChild(l),--g||(N=!1,i||w()),l}function S(e,t,n,o,r){var i=e,l=C;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||r)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),P(e,!0))),i.__preactattr_=!0,i;var a=t.nodeName;if("function"==typeof a)return V(e,t,n,o);if(C="svg"===a||"foreignObject"!==a&&C,a=String(a),(!e||!v(e,a))&&(i=_(a,C),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),P(e,!0)}var s=i.firstChild,p=i.__preactattr_,c=t.children;if(null==p){p=i.__preactattr_={};for(var u=i.attributes,d=u.length;d--;)p[u[d].name]=u[d].value}return!N&&c&&1===c.length&&"string"==typeof c[0]&&null!=s&&void 0!==s.splitText&&null==s.nextSibling?s.nodeValue!=c[0]&&(s.nodeValue=c[0]):(c&&c.length||null!=s)&&U(i,c,n,o,N||null!=p.dangerouslySetInnerHTML),L(i,t.attributes,p),C=l,i}function U(e,t,n,o,r){var i,l,a,s,p,c=e.childNodes,u=[],d={},v=0,m=0,_=c.length,y=0,b=t?t.length:0;if(0!==_)for(var x=0;x<_;x++){var g=c[x],C=g.__preactattr_;null!=(N=b&&C?g._component?g._component.__key:C.key:null)?(v++,d[N]=g):(C||(void 0!==g.splitText?!r||g.nodeValue.trim():r))&&(u[y++]=g)}if(0!==b)for(x=0;x<b;x++){var N;if(p=null,null!=(N=(s=t[x]).key))v&&void 0!==d[N]&&(p=d[N],d[N]=void 0,v--);else if(m<y)for(i=m;i<y;i++)if(void 0!==u[i]&&f(l=u[i],s,r)){p=l,u[i]=void 0,i===y-1&&y--,i===m&&m++;break}p=S(p,s,n,o),a=c[x],p&&p!==e&&p!==a&&(null==a?e.appendChild(p):p===a.nextSibling?h(a):e.insertBefore(p,a))}if(v)for(var x in d)void 0!==d[x]&&P(d[x],!1);for(;m<=y;)void 0!==(p=u[y--])&&P(p,!1)}function P(e,t){var n=e._component;n?A(n):(null!=e.__preactattr_&&l(e.__preactattr_.ref,null),!1!==t&&null!=e.__preactattr_||h(e),B(e))}function B(e){for(e=e.lastChild;e;){var t=e.previousSibling;P(e,!0),e=t}}function L(e,t,n){var o;for(o in n)t&&null!=t[o]||null==n[o]||y(e,o,n[o],n[o]=void 0,C);for(o in t)"children"===o||"innerHTML"===o||o in n&&t[o]===("value"===o||"checked"===o?e[o]:n[o])||y(e,o,n[o],n[o]=t[o],C)}var M=[];function T(e,t,n){var o,r=M.length;for(e.prototype&&e.prototype.render?(o=new e(t,n),R.call(o,t,n)):((o=new R(t,n)).constructor=e,o.render=E);r--;)if(M[r].constructor===e)return o.nextBase=M[r].nextBase,M.splice(r,1),o;return o}function E(e,t,n){return this.constructor(e,n)}function W(e,n,o,r,i){e._disable||(e._disable=!0,e.__ref=n.ref,e.__key=n.key,delete n.ref,delete n.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||i?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(n,r)),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=n,e._disable=!1,0!==o&&(1!==o&&!1===t.syncComponentUpdates&&e.base?u(e):D(e,1,i)),l(e.__ref,e))}function D(e,n,o,r){if(!e._disable){var l,a,s,p=e.props,c=e.state,u=e.context,d=e.prevProps||p,f=e.prevState||c,v=e.prevContext||u,_=e.base,h=e.nextBase,y=_||h,b=e._component,C=!1,N=v;if(e.constructor.getDerivedStateFromProps&&(c=i(i({},c),e.constructor.getDerivedStateFromProps(p,c)),e.state=c),_&&(e.props=d,e.state=f,e.context=v,2!==n&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(p,c,u)?C=!0:e.componentWillUpdate&&e.componentWillUpdate(p,c,u),e.props=p,e.state=c,e.context=u),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!C){l=e.render(p,c,u),e.getChildContext&&(u=i(i({},u),e.getChildContext())),_&&e.getSnapshotBeforeUpdate&&(N=e.getSnapshotBeforeUpdate(d,f));var S,U,B=l&&l.nodeName;if("function"==typeof B){var L=m(l);(a=b)&&a.constructor===B&&L.key==a.__key?W(a,L,1,u,!1):(S=a,e._component=a=T(B,L,u),a.nextBase=a.nextBase||h,a._parentComponent=e,W(a,L,0,u,!1),D(a,1,o,!0)),U=a.base}else s=y,(S=b)&&(s=e._component=null),(y||1===n)&&(s&&(s._component=null),U=k(s,l,u,o||!_,y&&y.parentNode,!0));if(y&&U!==y&&a!==b){var M=y.parentNode;M&&U!==M&&(M.replaceChild(U,y),S||(y._component=null,P(y,!1)))}if(S&&A(S),e.base=U,U&&!r){for(var E=e,V=e;V=V._parentComponent;)(E=V).base=U;U._component=E,U._componentConstructor=E.constructor}}for(!_||o?x.push(e):C||(e.componentDidUpdate&&e.componentDidUpdate(d,f,N),t.afterUpdate&&t.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);g||r||w()}}function V(e,t,n,o){for(var r=e&&e._component,i=r,l=e,a=r&&e._componentConstructor===t.nodeName,s=a,p=m(t);r&&!s&&(r=r._parentComponent);)s=r.constructor===t.nodeName;return r&&s&&(!o||r._component)?(W(r,p,3,n,o),e=r.base):(i&&!a&&(A(i),e=l=null),r=T(t.nodeName,p,n),e&&!r.nextBase&&(r.nextBase=e,l=null),W(r,p,1,n,o),e=r.base,l&&e!==l&&(l._component=null,P(l,!1))),e}function A(e){t.beforeUnmount&&t.beforeUnmount(e);var n=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var o=e._component;o?A(o):n&&(null!=n.__preactattr_&&l(n.__preactattr_.ref,null),e.nextBase=n,h(n),M.push(e),B(n)),l(e.__ref,null)}function R(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function H(e,t,n){return k(n,e,{},!1,t,!1)}function j(){return{}}i(R.prototype,{setState:function(e,t){this.prevState||(this.prevState=this.state),this.state=i(i({},this.state),"function"==typeof e?e(this.state,this.props):e),t&&this._renderCallbacks.push(t),u(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),D(this,2)},render:function(){}});var z={h:r,createElement:r,cloneElement:s,createRef:j,Component:R,render:H,rerender:d,options:t},F=z;exports.default=F;
},{}],"vnR2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={remove:e=>document.getElementById(e).outerHTML="",add:(t,r="alert-success",d=5e3)=>{let l=document.createElement("DIV");l.id=e.hash(t),l.innerHTML=t,l.classList.add("global-alert","alert",r),document.body.appendChild(l),setTimeout(()=>e.remove(l.id),d)},hash:e=>{let t=0;if(0==e.length)return t;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t}};var t=e;exports.default=t;
},{}],"O1i9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const A={getUrl:A=>{let e=A.match(/(\([^()]*)?https?:\/\/[-A-Za-z0-9+&@#\/%?=~_()|!:,.;]*[-A-Za-z0-9+&@#\/%=~_()|]/i);if(e&&e[0].startsWith("(")){let A=e[0].match(/https?:\/\//i);e.index+=A.index,e[0]=e[0].slice(A.index),e[0].endsWith(")")&&(e[0]=e[0].slice(0,-1))}return e},humanFullDate:A=>{let e=new Date(1e3*A);return(e=new Date(e.getTime()+6e4*e.getTimezoneOffset()*-1)).toISOString().replace("T"," ").replace(/\..*$/,"")},humanTime:e=>{if(!e)return null;const c=Math.abs(Math.round((Date.now()/1e3-e)/60));if(c<1)return lang.just_now;if(c<60)return lang.ago.replace(/{}/,c+"mn");if(c<1440)return lang.ago.replace(/{}/,Math.floor(c/60)+"h");new Date(1e3*e);return A.humanFullDate(e).split(" ")[0]},getId:A=>A?A.split("/").pop().replace(/\?.*$/,"").replace(/\.\w+$/,""):null,thumbnail:(A,e,c)=>A?"/api/images/thumbnail/"+e+"/"+c+"/"+A:null,crop:(A,e,c)=>A?"/api/images/crop/"+e+"/"+c+"/"+A:null,defaultAvatar:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAI4AAACOCAYAAADn/TAIAAAFIklEQVR4nO2dQW4UVxCGuQcnyA04QS6QnIBcILlAOEFOkOwRSNmwgQ0bIgErb0IkViwwG28SJUIKnrE9zN922208tqd/7K6qfl9J39rdrm9e1Xv9+vWd/x/eXQGM5U70BUBNEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsEAcsSoiz//z71cHu09Xh3svV8u2vq0+/fxN+Ta2TXhxJ82Uc/v0GeYJJL87Rx/cXxFEcvHsUfm0tk1qcxR8/bJTmdORZly6NSNHX2SKpxVm+/e1KcfrQqKTeZ//5d+HX7KDrFosX91fLP3/pUE+ne9KPJ/r6yolzWZm6LvomevH6x+OkPPt2WhHWf2+jDOvyqmsTY+4tY1lOK46a39sIJaxPnlBS+sRexzDxQ472/72Vax1GtpEnrTibZlMth2aS0TlBnKLx6cm98LwgTsFYvP4pPC+IUzDUZ0XnJb04gjgfWp6IzkkJcY4W/0XnKlUc7r0Kz0kJcQ4+PIvOVapAnC257pFDa0GpGgHl6ixojkegfxZxHEzHR3L4z1/ROUsRUz9zKy+O/mGtlyzdf3QeyomDPHpC/jg8ByXFOZXn4250DkMi24a1UuIIbbfYdoPXXEI9XvT/vbw4pwI9udcN33MPledMTXF5cYYCLXcezHLmpXvKKM0sxDkn0bqMabVZpUzL85Wbad1D5leAZiXOZaixFFpAu2xbqEQ7R9AI1pWmZI1ws+KMFq2bvXkb5b8m9FA38yiDOFcQ8YhDo4z6tOh7RxwDjTLaED51ZG6AEecaljs/T/KKy5eRaZsE4oxAU3m9FzV1VGmAEWcDmrZHjDKVGmDEGaCk6Y3MqaNiA4w4J4Q1wHuvUr1MhzgjUAM8dcxtlGlKnK407T6dXJo5jjLNiKOZy9QN8JxHmSbE0fk4U0fVxTzEeRjXAGd6dQVxRhKxAtzSKDM7caIa4MqPDJoXJ2IFWA1wtqPVEGdLjjetxzTAc55mz1qcqI1WLZem8uJEbbTK9N52BsqIE7nRitJUVJywjVaNrc3MRpyoafYcNlo1K07Ec6ZOmnXTrWP0+yP1L6P18pVSnIqHKan/Gh7xL/nmLFcqcbo9wAEN8G2GRs3uSzDrPm1OIqURp1ubCShNU4d+GPqqTfV9xynE0T+xBWmGofutPGtLIU7FnuamQs14xafrKcRpbbTZFNVWpsPF4WMfZ1FJnnBxWi5Tm6LKwmO4OHobgDgL9TwVZlzh4kRsj8geFd6SCBeHuBj6MUXnBXGKRvZeB3GSRvbFQcRJGjoOJTo3iFMwMn0NL6U4czzY+qYiOjepxWnhWH03onOTWhwtsxMXg1K1BZmOzlfpzHCcP+Jswdd+7VffsOqP0lfpGx61rxGtP5K/4wa2MGgn36Zj/jUTuqlHKNk+bJZSnF6e4UfM9IvvZdAblF1ydh6cJiz7NkxdX/dBkpPvRIwdwbK/m55GnBbQaCeRtvnKX/YHnYgTxFWTguyLfwJxAtm0F0klLXsZFogTTFe6TvoflbAq+48RJwlVhOlBHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLBAHLD4DOVazhHAxfyaAAAAAElFTkSuQmCC"};var e=A;exports.default=e;
},{}],"3MqM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("./util.js")),t=a(require("./alert.js")),r=a(require("./cache.js"));function a(e){return e&&e.__esModule?e:{default:e}}const s={sendFile:(e,a,s=null,n=null)=>r.default.get("apiKey").then(t=>{let r=new XMLHttpRequest;r.open("POST","/api/files/upload",!0),r.setRequestHeader("X-AUTH-TOKEN",t),r.addEventListener("load",e=>{e.target.status>199&&e.target.status<300?a(JSON.parse(e.target.response)):n?n(e.target.statusText):console.error(e.target.statusText)}),s&&(r.upload.onprogress=(e=>s({loaded:e.loaded,total:e.total}))),n&&r.addEventListener("error",e=>n(e)),r.send(e)}).catch(e=>{}).catch(e=>t.default.add(e)),get:(e,a=!1)=>r.default.get("apiKey").then(t=>{if(!e)return;let r={};return t&&(r["X-AUTH-TOKEN"]=t),a&&(r["X-NOCACHE"]="nocache"),fetch(e,{method:"GET",headers:new Headers(r)}).then(e=>e.ok&&e.json()).catch(t=>console.warn("ERROR for "+e,t))}).catch(e=>t.default.add(e)),post:(e,t,r="application/json")=>s.request(e,t,"POST",r),put:(e,t,r="application/json")=>s.request(e,t,"PUT",r),delete:(e,t,r="application/json")=>s.request(e,null,"DELETE",r),request:(e,a,s,n="application/json")=>r.default.get("apiKey").then(t=>{if(!e)return;let r={};t&&(r["X-AUTH-TOKEN"]=t),n&&(r["Content-type"]=n);let o={method:s,headers:new Headers(r)};return a&&(o.body="object"==typeof a&&"Object"==a.constructor.name?JSON.stringify(a):a),fetch(e,o).then(e=>{if("DELETE"==s)return e;try{return e.json()}catch(t){return console.warn(t.message),Promise.reject(t.message)}}).catch(t=>console.warn("ERROR for "+e,t))}).catch(e=>t.default.add(e))};var n=s;exports.default=n;
},{"./util.js":"O1i9","./alert.js":"vnR2","./cache.js":"NUMl"}],"NUMl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./http.js"));function t(e){return e&&e.__esModule?e:{default:e}}const a={data:{},events:{},register:(e,t)=>{void 0===a.events[e]&&(a.events[e]=[]),a.events[e].push(t)},remove:e=>{Object.keys(a.data).forEach(t=>{t.startsWith(e)&&(delete a.data[t],window.localStorage.removeItem(t))})},set:(e,t,s=null,r=!0)=>{const n={data:t,timestamp:Date.now(),cacheDuration:s};return r?window.localStorage.setItem(e,JSON.stringify(n)):a.data[e]=n,Promise.resolve(e)},get:(e,t=!1)=>{if(!e)return new Promise(e=>null);if(!t){let t=null;if((t=a.data[e])||(t=(t=window.localStorage.getItem(e))?JSON.parse(t):null),t){let s=t.cacheDuration||31536e6;t.timestamp<Date.now()-s&&(a.remove(e),t=null)}if(t)return"pending"==t.status?new Promise(t=>a.register(e,t)):new Promise(e=>e(t.data))}if(/^\/api/.test(e)){let t=1e4;return/^\/api\/(links)/.test(e)&&(t=216e5),a.data[e]={status:"pending"},a.update(e,t,!1)}return new Promise(e=>e(null))},update:(t,s=6e4,r=!1)=>(a.data[t]=Object.assign({status:"pending"},a.data[t]),e.default.get(t).then(e=>(a.set(t,e,s,r),a.data[t]=Object.assign({status:"ready"},a.data[t]),Array.isArray(a.events[t])&&a.events[t].forEach(e=>e.call(null,a.data[t].data)),delete a.events[t],new Promise(t=>t(e))))),resetCache:()=>{a.data={},a.events={},window.dispatchEvent(new CustomEvent("resetCache"))},reset:()=>window.localStorage.clear()&&a.resetCache()};var s=a;exports.default=s;
},{"./http.js":"3MqM"}],"L7ok":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={getOrientation:(e,t)=>{let r=new FileReader;r.onload=function(e){let r=new DataView(e.target.result);if(65496!=r.getUint16(0,!1))return t(-2);let n=r.byteLength,i=2;for(;i<n;){if(r.getUint16(i+2,!1)<=8)return t(-1);let e=r.getUint16(i,!1);if(i+=2,65505==e){if(1165519206!=r.getUint32(i+=2,!1))return t(-1);let e=18761==r.getUint16(i+=6,!1);i+=r.getUint32(i+4,e);let n=r.getUint16(i,e);i+=2;for(let l=0;l<n;l++)if(274==r.getUint16(i+12*l,e))return t(r.getUint16(i+12*l+8,e))}else{if(65280!=(65280&e))break;i+=r.getUint16(i,!1)}}return t(-1)},r.readAsArrayBuffer(e)}};var t=e;exports.default=t;
},{}],"J4Nk":[function(require,module,exports) {
"use strict";var r=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,e=Object.prototype.propertyIsEnumerable;function n(r){if(null==r)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(r)}function o(){try{if(!Object.assign)return!1;var r=new String("abc");if(r[5]="de","5"===Object.getOwnPropertyNames(r)[0])return!1;for(var t={},e=0;e<10;e++)t["_"+String.fromCharCode(e)]=e;if("0123456789"!==Object.getOwnPropertyNames(t).map(function(r){return t[r]}).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach(function(r){n[r]=r}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(o){return!1}}module.exports=o()?Object.assign:function(o,c){for(var a,i,s=n(o),f=1;f<arguments.length;f++){for(var u in a=Object(arguments[f]))t.call(a,u)&&(s[u]=a[u]);if(r){i=r(a);for(var b=0;b<i.length;b++)e.call(a,i[b])&&(s[i[b]]=a[i[b]])}}return s};
},{}],"T3DF":[function(require,module,exports) {
var r=arguments[3],e=arguments[4],t=arguments[5],o=JSON.stringify;module.exports=function(a,n){for(var f,i=Object.keys(t),u=0,s=i.length;u<s;u++){var l=i[u],w=t[l].exports;if(w===a||w&&w.default===a){f=l;break}}if(!f){f=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var d={};for(u=0,s=i.length;u<s;u++){d[l=i[u]]=l}e[f]=["function(require,module,exports){"+a+"(self); }",d]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[f]=f,e[v]=["function(require,module,exports){var f = require("+o(f)+");(f.default ? f.default : f)(self);}",c];var m={};!function r(t){m[t]=!0;for(var o in e[t][1]){var a=e[t][1][o];m[a]||r(a)}}(v);var p="("+r+")({"+Object.keys(m).map(function(r){return o(r)+":["+e[r][0]+","+o(e[r][1])+"]"}).join(",")+"},{},["+o(v)+"])",b=window.URL||window.webkitURL||window.mozURL||window.msURL,g=new Blob([p],{type:"text/javascript"});if(n&&n.bare)return g;var h=b.createObjectURL(g),j=new Worker(h);return j.objectURL=h,j};
},{}],"4Bm0":[function(require,module,exports) {
"function"==typeof Object.create?module.exports=function(t,e){e&&(t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}))}:module.exports=function(t,e){if(e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t}};
},{}],"xVqy":[function(require,module,exports) {
"use strict";var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";module.exports=function(e){for(var n=e.replace(/[\r\n=]/g,""),t=n.length,a=new Uint8Array(3*t>>2),c=0,i=0,o=0;o<t;o++)o%4==0&&o&&(a[i++]=c>>16&255,a[i++]=c>>8&255,a[i++]=255&c),c=c<<6|r.indexOf(n.charAt(o));var u=t%4*6;return 0===u?(a[i++]=c>>16&255,a[i++]=c>>8&255,a[i++]=255&c):18===u?(a[i++]=c>>10&255,a[i++]=c>>2&255):12===u&&(a[i++]=c>>4&255),a};
},{}],"iPmB":[function(require,module,exports) {
"use strict";var e;module.exports=function(){if(void 0!==e)return e;if(e=!1,"undefined"==typeof WebAssembly)return e;try{var r=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),t=new WebAssembly.Module(r);return 0!==new WebAssembly.Instance(t,{}).exports.test(4)&&(e=!0),e}catch(n){}return e};
},{}],"T64c":[function(require,module,exports) {
"use strict";var e=require("object-assign"),s=require("./lib/base64decode"),t=require("./lib/wa_detect"),i={js:!0,wasm:!0};function _(s){if(!(this instanceof _))return new _(s);var t=e({},i,s||{});if(this.options=t,this.__cache={},this.__init_promise=null,this.__modules=t.modules||{},this.__memory=null,this.__wasm={},this.__isLE=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0],!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}_.prototype.has_wasm=t,_.prototype.use=function(e){return this.__modules[e.name]=e,this.options.wasm&&this.has_wasm()&&e.wasm_fn?this[e.name]=e.wasm_fn:this[e.name]=e.fn,this},_.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error('mathlib: only "wasm" was enabled, but it\'s not supported'));var e=this;return this.__init_promise=Promise.all(Object.keys(e.__modules).map(function(s){var t=e.__modules[s];return e.options.wasm&&e.has_wasm()&&t.wasm_fn?e.__wasm[s]?null:WebAssembly.compile(e.__base64decode(t.wasm_src)).then(function(t){e.__wasm[s]=t}):null})).then(function(){return e}),this.__init_promise},_.prototype.__base64decode=s,_.prototype.__reallocate=function(e){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(e/65536)}),this.__memory;var s=this.__memory.buffer.byteLength;return s<e&&this.__memory.grow(Math.ceil((e-s)/65536)),this.__memory},_.prototype.__instance=function(s,t,i){if(t&&this.__reallocate(t),!this.__wasm[s]){var _=this.__modules[s];this.__wasm[s]=new WebAssembly.Module(this.__base64decode(_.wasm_src))}if(!this.__cache[s]){var n={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[s]=new WebAssembly.Instance(this.__wasm[s],{env:e(n,i||{})})}return this.__cache[s]},_.prototype.__align=function(e,s){var t=e%(s=s||8);return e+(t?s-t:0)},module.exports=_;
},{"object-assign":"J4Nk","./lib/base64decode":"xVqy","./lib/wa_detect":"iPmB"}],"4ME/":[function(require,module,exports) {
var r,a,t,n,e,o,f,h;function i(i){i<.5&&(i=.5);var u=Math.exp(.527076)/i,x=Math.exp(-u),l=Math.exp(-2*u),p=(1-x)*(1-x)/(1+2*u*x-l);return r=p,a=p*(u-1)*x,t=p*(u+1)*x,n=-p*l,e=2*x,o=-l,new Float32Array([r,a,t,n,e,o,f=(r+a)/(1-e-o),h=(t+n)/(1-e-o)])}function u(r,a,t,n,e,o){var f,h,i,u,x,l,p,v,M,c,w,y,A,m;for(M=0;M<o;M++){for(p=M,v=0,u=x=(f=r[l=M*e])*n[6],w=n[0],y=n[1],A=n[4],m=n[5],c=0;c<e;c++)i=(h=r[l])*w+f*y+u*A+x*m,x=u,u=i,f=h,t[v]=u,v++,l++;for(v--,p+=o*(e-1),u=x=(f=r[--l])*n[7],h=f,w=n[2],y=n[3],c=e-1;c>=0;c--)i=h*w+f*y+u*A+x*m,x=u,u=i,f=h,h=r[l],a[p]=t[v]+u,l--,v--,p-=o}}function x(r,a,t,n){if(n){var e=new Uint16Array(r.length),o=new Float32Array(Math.max(a,t)),f=i(n);u(r,e,o,f,a,t,n),u(e,r,o,f,t,a,n)}}module.exports=x;
},{}],"8pvh":[function(require,module,exports) {
"use strict";module.exports=function(r,t,e){for(var n,o,u,i,s,a=t*e,c=new Uint16Array(a),f=0;f<a;f++)n=r[4*f],o=r[4*f+1],u=r[4*f+2],s=n>=o&&n>=u?n:o>=u&&o>=n?o:u,i=n<=o&&n<=u?n:o<=u&&o<=n?o:u,c[f]=257*(s+i)>>1;return c};
},{}],"5CTm":[function(require,module,exports) {
"use strict";var r=require("glur/mono16"),e=require("./hsl_l16");module.exports=function(a,i,o,t,u,n){var s,l,v,f,c,h,m,q,b,d,g,p,w;if(!(0===t||u<.5)){u>2&&(u=2);var x=e(a,i,o),y=new Uint16Array(x);r(y,i,o,u);for(var A=t/100*4096+.5|0,M=257*n|0,U=i*o,_=0;_<U;_++)p=2*(x[_]-y[_]),Math.abs(p)>=M&&(s=a[w=4*_],l=a[w+1],v=a[w+2],h=257*((q=s>=l&&s>=v?s:l>=s&&l>=v?l:v)+(m=s<=l&&s<=v?s:l<=s&&l<=v?l:v))>>1,m===q?f=c=0:(c=h<=32767?4095*(q-m)/(q+m)|0:4095*(q-m)/(510-q-m)|0,f=s===q?65535*(l-v)/(6*(q-m))|0:l===q?21845+(65535*(v-s)/(6*(q-m))|0):43690+(65535*(s-l)/(6*(q-m))|0)),(h+=A*p+2048>>12)>65535?h=65535:h<0&&(h=0),0===c?s=l=v=h>>8:(b=2*h-(d=h<=32767?h*(4096+c)+2048>>12:h+((65535-h)*c+2048>>12))>>8,d>>=8,s=(g=f+21845&65535)>=43690?b:g>=32767?b+(6*(d-b)*(43690-g)+32768>>16):g>=10922?d:b+(6*(d-b)*g+32768>>16),l=(g=65535&f)>=43690?b:g>=32767?b+(6*(d-b)*(43690-g)+32768>>16):g>=10922?d:b+(6*(d-b)*g+32768>>16),v=(g=f-21845&65535)>=43690?b:g>=32767?b+(6*(d-b)*(43690-g)+32768>>16):g>=10922?d:b+(6*(d-b)*g+32768>>16)),a[w]=s,a[w+1]=l,a[w+2]=v)}};
},{"glur/mono16":"4ME/","./hsl_l16":"8pvh"}],"aIz4":[function(require,module,exports) {
"use strict";module.exports=function(r,e,s,t,n,o){if(!(0===t||n<.5)){n>2&&(n=2);var a=e*s,p=4*a,_=2*a,u=2*a,h=4*Math.max(e,s),i=p,x=i+_,f=x+u,l=f+u,m=l+h,b=this.__instance("unsharp_mask",p+_+2*u+h+32,{exp:Math.exp}),y=new Uint32Array(r.buffer);new Uint32Array(this.__memory.buffer).set(y);var M=b.exports.hsl_l16||b.exports._hsl_l16;M(0,i,e,s),(M=b.exports.blurMono16||b.exports._blurMono16)(i,x,f,l,m,e,s,n),(M=b.exports.unsharp||b.exports._unsharp)(0,0,i,x,e,s,t,o),y.set(new Uint32Array(this.__memory.buffer,0,a))}};
},{}],"kaVD":[function(require,module,exports) {
"use strict";module.exports="AGFzbQEAAAABMQZgAXwBfGACfX8AYAZ/f39/f38AYAh/f39/f39/fQBgBH9/f38AYAh/f39/f39/fwACGQIDZW52A2V4cAAAA2VudgZtZW1vcnkCAAEDBgUBAgMEBQQEAXAAAAdMBRZfX2J1aWxkX2dhdXNzaWFuX2NvZWZzAAEOX19nYXVzczE2X2xpbmUAAgpibHVyTW9ubzE2AAMHaHNsX2wxNgAEB3Vuc2hhcnAABQkBAAqJEAXZAQEGfAJAIAFE24a6Q4Ia+z8gALujIgOaEAAiBCAEoCIGtjgCECABIANEAAAAAAAAAMCiEAAiBbaMOAIUIAFEAAAAAAAA8D8gBKEiAiACoiAEIAMgA6CiRAAAAAAAAPA/oCAFoaMiArY4AgAgASAEIANEAAAAAAAA8L+gIAKioiIHtjgCBCABIAQgA0QAAAAAAADwP6AgAqKiIgO2OAIIIAEgBSACoiIEtow4AgwgASACIAegIAVEAAAAAAAA8D8gBqGgIgKjtjgCGCABIAMgBKEgAqO2OAIcCwu3AwMDfwR9CHwCQCADKgIUIQkgAyoCECEKIAMqAgwhCyADKgIIIQwCQCAEQX9qIgdBAEgiCA0AIAIgAC8BALgiDSADKgIYu6IiDiAJuyIQoiAOIAq7IhGiIA0gAyoCBLsiEqIgAyoCALsiEyANoqCgoCIPtjgCACACQQRqIQIgAEECaiEAIAdFDQAgBCEGA0AgAiAOIBCiIA8iDiARoiANIBKiIBMgAC8BALgiDaKgoKAiD7Y4AgAgAkEEaiECIABBAmohACAGQX9qIgZBAUoNAAsLAkAgCA0AIAEgByAFbEEBdGogAEF+ai8BACIIuCINIAu7IhGiIA0gDLsiEqKgIA0gAyoCHLuiIg4gCrsiE6KgIA4gCbsiFKKgIg8gAkF8aioCALugqzsBACAHRQ0AIAJBeGohAiAAQXxqIQBBACAFQQF0ayEHIAEgBSAEQQF0QXxqbGohBgNAIAghAyAALwEAIQggBiANIBGiIAO4Ig0gEqKgIA8iECAToqAgDiAUoqAiDyACKgIAu6CrOwEAIAYgB2ohBiAAQX5qIQAgAkF8aiECIBAhDiAEQX9qIgRBAUoNAAsLCwvfAgIDfwZ8AkAgB0MAAAAAWw0AIARE24a6Q4Ia+z8gB0MAAAA/l7ujIgyaEAAiDSANoCIPtjgCECAEIAxEAAAAAAAAAMCiEAAiDraMOAIUIAREAAAAAAAA8D8gDaEiCyALoiANIAwgDKCiRAAAAAAAAPA/oCAOoaMiC7Y4AgAgBCANIAxEAAAAAAAA8L+gIAuioiIQtjgCBCAEIA0gDEQAAAAAAADwP6AgC6KiIgy2OAIIIAQgDiALoiINtow4AgwgBCALIBCgIA5EAAAAAAAA8D8gD6GgIgujtjgCGCAEIAwgDaEgC6O2OAIcIAYEQCAFQQF0IQogBiEJIAIhCANAIAAgCCADIAQgBSAGEAIgACAKaiEAIAhBAmohCCAJQX9qIgkNAAsLIAVFDQAgBkEBdCEIIAUhAANAIAIgASADIAQgBiAFEAIgAiAIaiECIAFBAmohASAAQX9qIgANAAsLC7wBAQV/IAMgAmwiAwRAQQAgA2shBgNAIAAoAgAiBEEIdiIHQf8BcSECAn8gBEH/AXEiAyAEQRB2IgRB/wFxIgVPBEAgAyIIIAMgAk8NARoLIAQgBCAHIAIgA0kbIAIgBUkbQf8BcQshCAJAIAMgAk0EQCADIAVNDQELIAQgByAEIAMgAk8bIAIgBUsbQf8BcSEDCyAAQQRqIQAgASADIAhqQYECbEEBdjsBACABQQJqIQEgBkEBaiIGDQALCwvTBgEKfwJAIAazQwAAgEWUQwAAyEKVu0QAAAAAAADgP6CqIQ0gBSAEbCILBEAgB0GBAmwhDgNAQQAgAi8BACADLwEAayIGQQF0IgdrIAcgBkEASBsgDk8EQCAAQQJqLQAAIQUCfyAALQAAIgYgAEEBai0AACIESSIJRQRAIAYiCCAGIAVPDQEaCyAFIAUgBCAEIAVJGyAGIARLGwshCAJ/IAYgBE0EQCAGIgogBiAFTQ0BGgsgBSAFIAQgBCAFSxsgCRsLIgogCGoiD0GBAmwiEEEBdiERQQAhDAJ/QQAiCSAIIApGDQAaIAggCmsiCUH/H2wgD0H+AyAIayAKayAQQYCABEkbbSEMIAYgCEYEQCAEIAVrQf//A2wgCUEGbG0MAQsgBSAGayAGIARrIAQgCEYiBhtB//8DbCAJQQZsbUHVqgFBqtUCIAYbagshCSARIAcgDWxBgBBqQQx1aiIGQQAgBkEAShsiBkH//wMgBkH//wNIGyEGAkACfwJAIAxB//8DcSIFBEAgBkH//wFKDQEgBUGAIGogBmxBgBBqQQx2DAILIAZBCHYiBiEFIAYhBAwCCyAFIAZB//8Dc2xBgBBqQQx2IAZqCyIFQQh2IQcgBkEBdCAFa0EIdiIGIQQCQCAJQdWqAWpB//8DcSIFQanVAksNACAFQf//AU8EQEGq1QIgBWsgByAGa2xBBmxBgIACakEQdiAGaiEEDAELIAchBCAFQanVAEsNACAFIAcgBmtsQQZsQYCAAmpBEHYgBmohBAsCfyAGIgUgCUH//wNxIghBqdUCSw0AGkGq1QIgCGsgByAGa2xBBmxBgIACakEQdiAGaiAIQf//AU8NABogByIFIAhBqdUASw0AGiAIIAcgBmtsQQZsQYCAAmpBEHYgBmoLIQUgCUGr1QJqQf//A3EiCEGp1QJLDQAgCEH//wFPBEBBqtUCIAhrIAcgBmtsQQZsQYCAAmpBEHYgBmohBgwBCyAIQanVAEsEQCAHIQYMAQsgCCAHIAZrbEEGbEGAgAJqQRB2IAZqIQYLIAEgBDoAACABQQFqIAU6AAAgAUECaiAGOgAACyADQQJqIQMgAkECaiECIABBBGohACABQQRqIQEgC0F/aiILDQALCwsL";
},{}],"93IM":[function(require,module,exports) {
"use strict";module.exports={name:"unsharp_mask",fn:require("./unsharp_mask"),wasm_fn:require("./unsharp_mask_wasm"),wasm_src:require("./unsharp_mask_wasm_base64")};
},{"./unsharp_mask":"5CTm","./unsharp_mask_wasm":"aIz4","./unsharp_mask_wasm_base64":"kaVD"}],"iNKK":[function(require,module,exports) {
"use strict";module.exports=[{win:.5,filter:function(t){return t>=-.5&&t<.5?1:0}},{win:1,filter:function(t){if(t<=-1||t>=1)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var r=t*Math.PI;return Math.sin(r)/r*(.54+.46*Math.cos(r/1))}},{win:2,filter:function(t){if(t<=-2||t>=2)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var r=t*Math.PI;return Math.sin(r)/r*Math.sin(r/2)/(r/2)}},{win:3,filter:function(t){if(t<=-3||t>=3)return 0;if(t>-1.1920929e-7&&t<1.1920929e-7)return 1;var r=t*Math.PI;return Math.sin(r)/r*Math.sin(r/3)/(r/3)}}];
},{}],"NbUM":[function(require,module,exports) {
"use strict";var r=require("./resize_filter_info"),e=14;function t(r){return Math.round(r*((1<<e)-1))}module.exports=function(e,n,a,o,f){var i,l,h,s,u,M,y,c,g,m,w,A,b,d,v,x,I,_=r[e].filter,p=1/o,q=Math.min(1,o),z=r[e].win/q,F=Math.floor(2*(z+1)),j=new Int16Array((F+2)*a),k=0,B=!j.subarray||!j.set;for(i=0;i<a;i++){for(l=(i+.5)*p+f,h=Math.max(0,Math.floor(l-z)),u=(s=Math.min(n-1,Math.ceil(l+z)))-h+1,M=new Float32Array(u),y=new Int16Array(u),c=0,g=h,m=0;g<=s;g++,m++)c+=w=_((g+.5-l)*q),M[m]=w;for(A=0,m=0;m<M.length;m++)A+=b=M[m]/c,y[m]=t(b);for(y[a>>1]+=t(1-A),d=0;d<y.length&&0===y[d];)d++;if(d<y.length){for(v=y.length-1;v>0&&0===y[v];)v--;if(x=h+d,I=v-d+1,j[k++]=x,j[k++]=I,B)for(m=d;m<=v;m++)j[k++]=y[m];else j.set(y.subarray(d,v+1),k),k+=I}else j[k++]=0,j[k++]=0}return j};
},{"./resize_filter_info":"iNKK"}],"6gnA":[function(require,module,exports) {
"use strict";function o(o){return o<0?0:o>255?255:o}function r(r,n,f,t,c,e){var l,i,u,v,a,s,y,d,m,p,x,z=0,H=0;for(m=0;m<t;m++){for(a=0,p=0;p<c;p++){for(s=e[a++],y=e[a++],d=z+4*s|0,l=i=u=v=0;y>0;y--)v=v+(x=e[a++])*r[d+3]|0,u=u+x*r[d+2]|0,i=i+x*r[d+1]|0,l=l+x*r[d]|0,d=d+4|0;n[H+3]=o(v+8192>>14),n[H+2]=o(u+8192>>14),n[H+1]=o(i+8192>>14),n[H]=o(l+8192>>14),H=H+4*t|0}H=4*(m+1)|0,z=(m+1)*f*4|0}}function n(r,n,f,t,c,e){var l,i,u,v,a,s,y,d,m,p,x,z=0,H=0;for(m=0;m<t;m++){for(a=0,p=0;p<c;p++){for(s=e[a++],y=e[a++],d=z+4*s|0,l=i=u=v=0;y>0;y--)v=v+(x=e[a++])*r[d+3]|0,u=u+x*r[d+2]|0,i=i+x*r[d+1]|0,l=l+x*r[d]|0,d=d+4|0;n[H+3]=o(v+8192>>14),n[H+2]=o(u+8192>>14),n[H+1]=o(i+8192>>14),n[H]=o(l+8192>>14),H=H+4*t|0}H=4*(m+1)|0,z=(m+1)*f*4|0}}module.exports={convolveHorizontally:r,convolveVertically:n};
},{}],"DldL":[function(require,module,exports) {
"use strict";const e=require("./resize_filter_gen"),t=require("./convolve").convolveHorizontally,o=require("./convolve").convolveVertically;function i(e,t,o){let i=3,r=t*o*4|0;for(;i<r;)e[i]=255,i=i+4|0}module.exports=function(r){const n=r.src,l=r.width,c=r.height,s=r.toWidth,h=r.toHeight,a=r.scaleX||r.toWidth/r.width,u=r.scaleY||r.toHeight/r.height,v=r.offsetX||0,f=r.offsetY||0,d=r.dest||new Uint8Array(s*h*4),y=void 0===r.quality?3:r.quality,g=r.alpha||!1,q=e(y,l,s,a,v),w=e(y,c,h,u,f),H=new Uint8Array(s*c*4);return t(n,H,l,c,s,q),o(H,d,c,s,h,w),g||i(d,s,h),d};
},{"./resize_filter_gen":"NbUM","./convolve":"6gnA"}],"8MTq":[function(require,module,exports) {
"use strict";const t=require("./resize_filter_gen");function e(t,e,r){let n=3,i=e*r*4|0;for(;n<i;)t[n]=255,n=n+4|0}function r(t){return new Uint8Array(t.buffer,0,t.byteLength)}let n=!0;try{n=1===new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]}catch(s){}function i(t,e,i){if(n)e.set(r(t),i);else for(let r=i,n=0;n<t.length;n++){let i=t[n];e[r++]=255&i,e[r++]=i>>8&255}}module.exports=function(r){const n=r.src,s=r.width,f=r.height,h=r.toWidth,o=r.toHeight,a=r.scaleX||r.toWidth/r.width,y=r.scaleY||r.toHeight/r.height,l=r.offsetX||0,u=r.offsetY||0,_=r.dest||new Uint8Array(h*o*4),c=void 0===r.quality?3:r.quality,g=r.alpha||!1,b=t(c,s,h,a,l),w=t(c,f,o,y,u),A=this.__align(0+Math.max(n.byteLength,_.byteLength)),U=this.__align(A+f*h*4),m=this.__align(U+b.byteLength),d=m+w.byteLength,v=this.__instance("resize",d),L=new Uint8Array(this.__memory.buffer),p=new Uint32Array(this.__memory.buffer),x=new Uint32Array(n.buffer);return p.set(x),i(b,L,U),i(w,L,m),(v.exports.convolveHV||v.exports._convolveHV)(U,m,A,s,f,h,o),new Uint32Array(_.buffer).set(new Uint32Array(this.__memory.buffer,0,o*h)),g||e(_,h,o),_};
},{"./resize_filter_gen":"NbUM"}],"g4Tt":[function(require,module,exports) {
"use strict";module.exports="AGFzbQEAAAABFAJgBn9/f39/fwBgB39/f39/f38AAg8BA2VudgZtZW1vcnkCAAEDAwIAAQQEAXAAAAcZAghjb252b2x2ZQAACmNvbnZvbHZlSFYAAQkBAArmAwLBAwEQfwJAIANFDQAgBEUNACAFQQRqIRVBACEMQQAhDQNAIA0hDkEAIRFBACEHA0AgB0ECaiESAn8gBSAHQQF0IgdqIgZBAmouAQAiEwRAQQAhCEEAIBNrIRQgFSAHaiEPIAAgDCAGLgEAakECdGohEEEAIQlBACEKQQAhCwNAIBAoAgAiB0EYdiAPLgEAIgZsIAtqIQsgB0H/AXEgBmwgCGohCCAHQRB2Qf8BcSAGbCAKaiEKIAdBCHZB/wFxIAZsIAlqIQkgD0ECaiEPIBBBBGohECAUQQFqIhQNAAsgEiATagwBC0EAIQtBACEKQQAhCUEAIQggEgshByABIA5BAnRqIApBgMAAakEOdSIGQf8BIAZB/wFIG0EQdEGAgPwHcUEAIAZBAEobIAtBgMAAakEOdSIGQf8BIAZB/wFIG0EYdEEAIAZBAEobciAJQYDAAGpBDnUiBkH/ASAGQf8BSBtBCHRBgP4DcUEAIAZBAEobciAIQYDAAGpBDnUiBkH/ASAGQf8BSBtB/wFxQQAgBkEAShtyNgIAIA4gA2ohDiARQQFqIhEgBEcNAAsgDCACaiEMIA1BAWoiDSADRw0ACwsLIQACQEEAIAIgAyAEIAUgABAAIAJBACAEIAUgBiABEAALCw==";
},{}],"pP00":[function(require,module,exports) {
"use strict";module.exports={name:"resize",fn:require("./resize"),wasm_fn:require("./resize_wasm"),wasm_src:require("./convolve_wasm_base64")};
},{"./resize":"DldL","./resize_wasm":"8MTq","./convolve_wasm_base64":"g4Tt"}],"K7Ml":[function(require,module,exports) {
"use strict";const s=require("inherits"),t=require("multimath"),e=require("multimath/lib/unsharp_mask"),i=require("./mm_resize");function r(s){const r=s||[];let u={js:r.indexOf("js")>=0,wasm:r.indexOf("wasm")>=0};t.call(this,u),this.features={js:u.js,wasm:u.wasm&&this.has_wasm()},this.use(e),this.use(i)}s(r,t),r.prototype.resizeAndUnsharp=function(s,t){let e=this.resize(s,t);return s.unsharpAmount&&this.unsharp_mask(e,s.toWidth,s.toHeight,s.unsharpAmount,s.unsharpRadius,s.unsharpThreshold),e},module.exports=r;
},{"inherits":"4Bm0","multimath":"T64c","multimath/lib/unsharp_mask":"93IM","./mm_resize":"pP00"}],"bY56":[function(require,module,exports) {
"use strict";const t=100;function e(t,e){this.create=t,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=e||2e3}e.prototype.acquire=function(){let t;return 0!==this.available.length?t=this.available.pop():((t=this.create()).id=this.lastId++,t.release=(()=>this.release(t))),this.acquired[t.id]=t,t},e.prototype.release=function(t){delete this.acquired[t.id],t.lastUsed=Date.now(),this.available.push(t),0===this.timeoutId&&(this.timeoutId=setTimeout(()=>this.gc(),100))},e.prototype.gc=function(){const t=Date.now();this.available=this.available.filter(e=>!(t-e.lastUsed>this.idle)||(e.destroy(),!1)),0!==this.available.length?this.timeoutId=setTimeout(()=>this.gc(),100):this.timeoutId=0},module.exports=e;
},{}],"6GG5":[function(require,module,exports) {
"use strict";function e(e){return Object.prototype.toString.call(e)}module.exports.isCanvas=function(t){let n=e(t);return"[object HTMLCanvasElement]"===n||"[object Canvas]"===n},module.exports.isImage=function(t){return"[object HTMLImageElement]"===e(t)},module.exports.limiter=function(e){let t=0,n=[];function r(){t<e&&n.length&&(t++,n.shift()())}return function(e){return new Promise((i,u)=>{n.push(()=>{e().then(e=>{i(e),t--,r()},e=>{u(e),t--,r()})}),r()})}},module.exports.cib_quality_name=function(e){switch(e){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},module.exports.cib_support=function(){return Promise.resolve().then(()=>{if("undefined"==typeof createImageBitmap||"undefined"==typeof document)return!1;let e=document.createElement("canvas");return e.width=100,e.height=100,createImageBitmap(e,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(t=>{let n=10===t.width;return t.close(),e=null,n})}).catch(()=>!1)};
},{}],"+AF2":[function(require,module,exports) {
"use strict";module.exports=function(){const e=require("./mathlib");let t;onmessage=function(s){let a=s.data.opts;t||(t=new e(s.data.features));let n=t.resizeAndUnsharp(a);postMessage({result:n},[n.buffer])}};
},{"./mathlib":"K7Ml"}],"Ubn3":[function(require,module,exports) {
"use strict";const t=2;module.exports=function(t,o,h,a,e,M){let r=h/t,l=a/o,n=(2*M+2+1)/e;if(n>.5)return[[h,a]];let u=Math.ceil(Math.log(Math.min(r,l))/Math.log(n));if(u<=1)return[[h,a]];let p=[];for(let i=0;i<u;i++){let e=Math.round(Math.pow(Math.pow(t,u-i-1)*Math.pow(h,i+1),1/u)),M=Math.round(Math.pow(Math.pow(o,u-i-1)*Math.pow(a,i+1),1/u));p.push([e,M])}return p};
},{}],"3ur6":[function(require,module,exports) {
"use strict";var t=1e-5;function e(e){var r=Math.round(e);return Math.abs(e-r)<t?r:Math.floor(e)}function r(e){var r=Math.round(e);return Math.abs(e-r)<t?r:Math.ceil(e)}module.exports=function(t){var o,i,h,d,n,s,a=t.toWidth/t.width,l=t.toHeight/t.height,f=e(t.srcTileSize*a)-2*t.destTileBorder,u=e(t.srcTileSize*l)-2*t.destTileBorder;if(f<1||u<1)throw new Error("Internal error in pica: target tile width/height is too small.");var c,g=[];for(d=0;d<t.toHeight;d+=u)for(h=0;h<t.toWidth;h+=f)(o=h-t.destTileBorder)<0&&(o=0),o+(n=h+f+t.destTileBorder-o)>=t.toWidth&&(n=t.toWidth-o),(i=d-t.destTileBorder)<0&&(i=0),i+(s=d+u+t.destTileBorder-i)>=t.toHeight&&(s=t.toHeight-i),c={toX:o,toY:i,toWidth:n,toHeight:s,toInnerX:h,toInnerY:d,toInnerWidth:f,toInnerHeight:u,offsetX:o/a-e(o/a),offsetY:i/l-e(i/l),scaleX:a,scaleY:l,x:e(o/a),y:e(i/l),width:r(n/a),height:r(s/l)},g.push(c);return g};
},{}],"mer+":[function(require,module,exports) {
"use strict";const t=require("object-assign"),e=require("webworkify"),i=require("./lib/mathlib"),a=require("./lib/pool"),r=require("./lib/utils"),n=require("./lib/worker"),o=require("./lib/stepper"),h=require("./lib/tiler"),s={};let l=!1;try{"undefined"!=typeof navigator&&navigator.userAgent&&(l=navigator.userAgent.indexOf("Safari")>=0)}catch(w){}let u=1;"undefined"!=typeof navigator&&(u=Math.min(navigator.hardwareConcurrency||1,4));const d={tile:1024,concurrency:u,features:["js","wasm","ww"],idle:2e3},g={quality:3,alpha:!1,unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0};let p,m;function c(){return{value:e(n),destroy:function(){if(this.value.terminate(),"undefined"!=typeof window){let t=window.URL||window.webkitURL||window.mozURL||window.msURL;t&&t.revokeObjectURL&&this.value.objectURL&&t.revokeObjectURL(this.value.objectURL)}}}}function f(e){if(!(this instanceof f))return new f(e);this.options=t({},d,e||{});let i=`lk_${this.options.concurrency}`;this.__limit=s[i]||r.limiter(this.options.concurrency),s[i]||(s[i]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}f.prototype.init=function(){if(this.__initPromise)return this.__initPromise;if(!1!==p&&!0!==p&&(p=!1,"undefined"!=typeof ImageData&&"undefined"!=typeof Uint8ClampedArray))try{new ImageData(new Uint8ClampedArray(400),10,10),p=!0}catch(h){}!1!==m&&!0!==m&&(m=!1,"undefined"!=typeof ImageBitmap&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?m=!0:this.debug("ImageBitmap does not support .close(), disabled")));let e=this.options.features.slice();if(e.indexOf("all")>=0&&(e=["cib","wasm","js","ww"]),this.__requested_features=e,this.__mathlib=new i(e),e.indexOf("ww")>=0&&"undefined"!=typeof window&&"Worker"in window)try{require("webworkify")(function(){}).terminate(),this.features.ww=!0;let t=`wp_${JSON.stringify(this.options)}`;s[t]?this.__workersPool=s[t]:(this.__workersPool=new a(c,this.options.idle),s[t]=this.__workersPool)}catch(h){}let n,o=this.__mathlib.init().then(e=>{t(this.features,e.features)});return n=m?r.cib_support().then(t=>{this.features.cib&&e.indexOf("cib")<0?this.debug("createImageBitmap() resize supported, but disabled by config"):e.indexOf("cib")>=0&&(this.features.cib=t)}):Promise.resolve(!1),this.__initPromise=Promise.all([o,n]).then(()=>this),this.__initPromise},f.prototype.resize=function(e,i,a){this.debug("Start resize...");let n=t({},g);if(isNaN(a)?a&&(n=t(n,a)):n=t(n,{quality:a}),n.toWidth=i.width,n.toHeight=i.height,n.width=e.naturalWidth||e.width,n.height=e.naturalHeight||e.height,0===i.width||0===i.height)return Promise.reject(new Error(`Invalid output size: ${i.width}x${i.height}`));n.unsharpRadius>2&&(n.unsharpRadius=2);let s=!1,u=null;n.cancelToken&&(u=n.cancelToken.then(t=>{throw s=!0,t},t=>{throw s=!0,t}));let d=Math.ceil(Math.max(3,2.5*n.unsharpRadius|0));return this.init().then(()=>{if(s)return u;if(this.features.cib){let t=i.getContext("2d",{alpha:Boolean(n.alpha)});return this.debug("Resize via createImageBitmap()"),createImageBitmap(e,{resizeWidth:n.toWidth,resizeHeight:n.toHeight,resizeQuality:r.cib_quality_name(n.quality)}).then(e=>{if(s)return u;if(!n.unsharpAmount)return t.drawImage(e,0,0),e.close(),t=null,this.debug("Finished!"),i;this.debug("Unsharp result");let a=document.createElement("canvas");a.width=n.toWidth,a.height=n.toHeight;let r=a.getContext("2d",{alpha:Boolean(n.alpha)});r.drawImage(e,0,0),e.close();let o=r.getImageData(0,0,n.toWidth,n.toHeight);return this.__mathlib.unsharp_mask(o.data,n.toWidth,n.toHeight,n.unsharpAmount,n.unsharpRadius,n.unsharpThreshold),t.putImageData(o,0,0),o=r=a=t=null,this.debug("Finished!"),i})}let a={};const g=t=>Promise.resolve().then(()=>this.features.ww?new Promise((e,i)=>{let a=this.__workersPool.acquire();u&&u.catch(t=>i(t)),a.value.onmessage=(t=>{a.release(),t.data.err?i(t.data.err):e(t.data.result)}),a.value.postMessage({opts:t,features:this.__requested_features,preload:{wasm_nodule:this.__mathlib.__}},[t.src.buffer])}):this.__mathlib.resizeAndUnsharp(t,a)),c=(t,e,i)=>{let a,n,o;const c=e=>this.__limit(()=>{if(s)return u;let h;if(r.isCanvas(t))this.debug("Get tile pixel data"),h=a.getImageData(e.x,e.y,e.width,e.height);else{this.debug("Draw tile imageBitmap/image to temporary canvas");let a=document.createElement("canvas");a.width=e.width,a.height=e.height;let r=a.getContext("2d",{alpha:Boolean(i.alpha)});r.globalCompositeOperation="copy",r.drawImage(n||t,e.x,e.y,e.width,e.height,0,0,e.width,e.height),this.debug("Get tile pixel data"),h=r.getImageData(0,0,e.width,e.height),r=a=null}let d={src:h.data,width:e.width,height:e.height,toWidth:e.toWidth,toHeight:e.toHeight,scaleX:e.scaleX,scaleY:e.scaleY,offsetX:e.offsetX,offsetY:e.offsetY,quality:i.quality,alpha:i.alpha,unsharpAmount:i.unsharpAmount,unsharpRadius:i.unsharpRadius,unsharpThreshold:i.unsharpThreshold};return this.debug("Invoke resize math"),Promise.resolve().then(()=>g(d)).then(t=>{if(s)return u;let i;if(h=null,this.debug("Convert raw rgba tile result to ImageData"),p)i=new ImageData(new Uint8ClampedArray(t),e.toWidth,e.toHeight);else if((i=o.createImageData(e.toWidth,e.toHeight)).data.set)i.data.set(t);else for(let e=i.data.length-1;e>=0;e--)i.data[e]=t[e];return this.debug("Draw tile"),l?o.putImageData(i,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth+1e-5,e.toInnerHeight+1e-5):o.putImageData(i,e.toX,e.toY,e.toInnerX-e.toX,e.toInnerY-e.toY,e.toInnerWidth,e.toInnerHeight),null})});return Promise.resolve().then(()=>{if(o=e.getContext("2d",{alpha:Boolean(i.alpha)}),r.isCanvas(t))return a=t.getContext("2d",{alpha:Boolean(i.alpha)}),null;if(r.isImage(t))return m?(this.debug("Decode image via createImageBitmap"),createImageBitmap(t).then(t=>{n=t})):null;throw new Error('".from" should be image or canvas')}).then(()=>{if(s)return u;this.debug("Calculate tiles");let t=h({width:i.width,height:i.height,srcTileSize:this.options.tile,toWidth:i.toWidth,toHeight:i.toHeight,destTileBorder:d}).map(t=>c(t));function a(){n&&(n.close(),n=null)}return this.debug("Process tiles"),Promise.all(t).then(()=>(this.debug("Finished!"),a(),e),t=>{throw a(),t})})},f=(e,i,a,r)=>{if(s)return u;let n,[o,h]=e.shift(),l=0===e.length;return r=t({},r,{toWidth:o,toHeight:h,quality:l?r.quality:Math.min(1,r.quality)}),l||((n=document.createElement("canvas")).width=o,n.height=h),c(i,l?a:n,r).then(()=>l?a:(r.width=o,r.height=h,f(e,n,a,r)))};let w=o(n.width,n.height,n.toWidth,n.toHeight,this.options.tile,d);return f(w,e,i,n)})},f.prototype.resizeBuffer=function(e){const i=t({},g,e);return this.init().then(()=>this.__mathlib.resizeAndUnsharp(i))},f.prototype.toBlob=function(t,e,i){return e=e||"image/png",new Promise(a=>{if(t.toBlob)return void t.toBlob(t=>a(t),e,i);const r=atob(t.toDataURL(e,i).split(",")[1]),n=r.length,o=new Uint8Array(n);for(let t=0;t<n;t++)o[t]=r.charCodeAt(t);a(new Blob([o],{type:e}))})},f.prototype.debug=function(){},module.exports=f;
},{"object-assign":"J4Nk","webworkify":"T3DF","./lib/mathlib":"K7Ml","./lib/pool":"bY56","./lib/utils":"6GG5","./lib/worker":"+AF2","./lib/stepper":"Ubn3","./lib/tiler":"3ur6"}],"n5/G":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./exif.js"));function t(e){return e&&e.__esModule?e:{default:e}}const i=require("pica")(),o={resize:(e,t,o,n)=>{let r=document.createElement("canvas");r.width=t,r.height=o,i.resize(e,r).then(e=>i.toBlob(e,"image/jpeg",.9)).then(e=>n(e))},handleImage:(t,i)=>{let n=t.size;try{let a=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(/Firefox/.test(navigator.userAgent)&&/Mobile/.test(navigator.userAgent)||a)return console.warn("Do not use image reduction on iOS/FirefoxMobile !"),void i(t);if(!t.type||!t.type.match(/image/))return console.warn("Do not use image reduction on invalid file !"),void i(t);if("image/gif"==t.type)return console.warn("Do not use image reduction on a gif !"),void i(t);if(n<1048576)return console.warn("Do not use image reduction on small file !"),void i(t);e.default.getOrientation(t,e=>{if(1!=e&&2!=e)return console.warn("Incorrect orientation !"),void i(t);let n=new Image;n.onload=(()=>{let e=Math.min(n.naturalWidth,2048),t=n.naturalHeight,r=Math.min(e/n.naturalWidth,t/n.naturalHeight),a=Math.floor(n.naturalWidth*r),l=Math.floor(n.naturalHeight*r);o.resize(n,a,l,e=>{i(e)})}),n.src=URL.createObjectURL(t)})}catch(r){console.warn(r),i(t)}}};var n=o;exports.default=n;
},{"./exif.js":"L7ok","pica":"mer+"}],"DIJp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./http.js"));function t(e){return e&&e.__esModule?e:{default:e}}const s={me:{},get:()=>s.me.id?Promise.resolve(s.me):s.update(),update:()=>e.default.get("/api/me",!0).then(e=>(s.me=e,window.dispatchEvent(new CustomEvent("meStateChange")),e)),removeNews:e=>{s.me.news&&(s.me.news=s.me.news.filter(t=>t!=e),window.dispatchEvent(new CustomEvent("meStateChange")))},isNews:e=>!!s.me.news&&s.me.news.includes(e)};var n=s;exports.default=n;
},{"./http.js":"3MqM"}],"td1v":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e={list:[],bodyStyle:"",nlgStyles:`\n        .nlg-left {\n            left: -${document.body.clientWidth}px !important;\n        }\n        .nlg-right {\n            left: ${2*document.body.clientWidth}px !important;\n        }\n    `,clickFn:t=>{t.preventDefault(),t.ctrlKey?window.open(t.currentTarget.getAttribute("href"),"_blank"):e.show(t.currentTarget)},stop:()=>{document.querySelectorAll("[data-nlg]").forEach(t=>t.removeEventListener("click",e.clickFn))},start:()=>{if(e.stop(),e.list=[],!document.getElementById("nlg-styles")){let t=document.createElement("style");t.id="nlg-styles",t.innerHTML=e.nlgStyles,document.body.append(t)}setTimeout(()=>{document.querySelectorAll("[data-nlg]").forEach(t=>{e.list.find(e=>e.getAttribute("href")==t.getAttribute("href"))||(e.list.push(t),t.addEventListener("click",e.clickFn))})},100)},show:(t,n=!1,d=null)=>{let l,i=t.dataset.src||t.src||t.href;switch(!0){case/\.(webm|mp4)$/.test(i):(l=document.createElement("video")).setAttribute("controls",!0);break;case/\.(jpg|jpeg|png|bmp|webp|gif|svg)$/.test(i):default:l=document.createElement("img")}if(l.classList.add("nlg-media"),d&&l.classList.add("nlg-"+d),e.bodyStyle=document.body.style.cssText,document.body.style.cssText="overflow: hidden",!n){let t=document.createElement("div");t.id="nlg-modal-bg",t.addEventListener("click",t=>{t.currentTarget==t.target&&e.hide()});let n=document.createElement("a");n.id="nlg-close",n.innerHTML="&times;",n.addEventListener("click",e.hide),e.keyPressClose=(t=>("Escape"==t.key||"Escape"==t.code)&&e.hide()),window.addEventListener("keydown",e.keyPressClose),document.body.appendChild(n),document.body.appendChild(t)}if(t.dataset.origin){let e=document.createElement("a");e.id="nlg-origin",e.href=t.dataset.origin,e.target="_blank",e.innerHTML='\n                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">\n                <path d="M224,295.6L116.8,402.9L153,439c15.1,15.1,4.4,41-17,41H24c-13.3,0-24-10.7-24-24V344c0-21.4,25.9-32.1,41-17l36.2,36.2 L184.5,256"/>\n                <path d="M224,216.4l107.3-107.3L295.1,73c-15.1-15.1-4.4-41,17-41h112c13.3,0,24,10.7,24,24v112c0,21.4-25.9,32.1-41,17l-36.2-36.2 L263.6,256"/>\n                </svg>\n            ',document.body.appendChild(e)}let o=document.createElement("div");o.classList.add("spinner");for(let e=0;e<5;e++)o.appendChild(document.createElement("div"));setTimeout(()=>{let e=document.querySelector("#nlg-modal-bg .spinner");e&&(e.style.opacity=1)},500),document.getElementById("nlg-modal-bg").appendChild(o);let r=document.createElement("div");r.id="nlg-modal";let s=()=>{let t=document.querySelector("#nlg-modal-bg .spinner");t&&(t.outerHTML="");let n="VIDEO"==l.tagName?l.videoWidth:l.width,d=n/("VIDEO"==l.tagName?l.videoHeight:l.height);l.width=Math.min(document.body.clientWidth,n),l.height=Math.min(document.body.clientHeight,l.width/d),l.width=l.height*d;let o=e.list.findIndex(e=>i===(e.dataset.src||e.src||e.href)),s=e.list[o+1],c=e.list[o-1];if(s){let t=document.createElement("a");t.classList.add("nlg-next"),t.innerHTML="&#10095;";let n=t=>{e.moveLeft(),setTimeout(()=>{e.hide(!0),e.show(s,!0,"right")},300)};t.addEventListener("click",n),e.keyPressRight=(e=>("ArrowRight"==e.key||"ArrowRight"==e.code)&&n(e)),window.addEventListener("keydown",e.keyPressRight),r.appendChild(t)}if(c){let t=document.createElement("a");t.innerHTML="&#10094;",t.classList.add("nlg-prev");let n=t=>{e.moveRight(),setTimeout(()=>{e.hide(!0),e.show(c,!0,"left")},300)};t.addEventListener("click",n),e.keyPressLeft=(e=>("ArrowLeft"==e.key||"ArrowLeft"==e.code)&&n(e)),window.addEventListener("keydown",e.keyPressLeft),r.appendChild(t)}r.style.cssText="opacity: 1;",setTimeout(e.center,1)};l.addEventListener("load",s),l.addEventListener("loadeddata",s),r.addEventListener("click",t=>{t.currentTarget==t.target&&e.hide()}),r.appendChild(l),document.body.appendChild(r),l.src=i,"VIDEO"==l.tagName&&l.play()},hide:(t=!1)=>{document.getElementById("nlg-modal")&&(window.removeEventListener("keydown",e.keyPressRight),window.removeEventListener("keydown",e.keyPressLeft),document.body.style.cssText=e.bodyStyle,document.getElementById("nlg-modal").outerHTML="",document.getElementById("nlg-origin")&&(document.getElementById("nlg-origin").outerHTML=""),1!=t&&(document.querySelector("#nlg-close").outerHTML="",document.getElementById("nlg-modal-bg").outerHTML="",window.removeEventListener("keydown",e.keyPressClose)))},moveLeft:()=>document.querySelector("#nlg-modal > .nlg-media").classList.add("nlg-left"),moveRight:()=>document.querySelector("#nlg-modal > .nlg-media").classList.add("nlg-right"),center:()=>{let e=document.querySelector("#nlg-modal > .nlg-media");e.classList.remove("nlg-right"),e.classList.remove("nlg-left")}};var t=e;exports.default=t;
},{}],"QBcK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("./cache.js")),t=n(require("./util.js")),i=n(require("./http.js")),a=n(require("./nlg.js")),o=n(require("./me.js"));function n(e){return e&&e.__esModule?e:{default:e}}const r={route:"",id:"",action:"",url:"",backUrl:"",backUrlPrompt:"",entityUrl:"",entityType:"",entity:{},toApp:e=>e?"/api/"+e.entityType+"s/"+e.id:console.warn(e)&&null,getParam:e=>{let t=window.location.search.substring(1).split("&").find(t=>t.split("=")[0]===e);return t?t.split("=")[1]:""},getSegments:()=>window.location.pathname.slice(1).split("?")[0].split("/"),isOutside:()=>["login","password-reset","signup","invitation","stop-notification-emails","public"].includes(r.route||r.getSegments()[0]),isEntity:e=>["messages","groups","users","links","files"].includes(e),navigate:(n,s={})=>{window.location.pathname;const l=window.location.search;switch([r.route,r.id,r.action]=n.slice(1).split("?")[0].split("/"),r.url="",r.backUrl="",r.entityUrl="",r.entityType="",r.backUrlPrompt="",r.route&&r.id&&(r.url="/"+r.route+"/"+r.id,r.isEntity(r.route)&&(r.entityUrl="/api/"+r.route+"/"+r.id,r.entityType=r.route),r.action&&(r.backUrl="/","users"==r.route&&(r.backUrl="/"),"groups"==r.route&&"write"==r.action&&(r.backUrl=r.url,r.backUrlPrompt=lang.cancel_write),r.url+="/"+r.action)),a.default.hide(),r.route){case"password-reset":case"stop-notification-emails":case"signup":case"login":case"share":case"public":n+=l;case"messages":case"groups":case"users":case"create-group":s.replace?history.replaceState(null,"",n):history.pushState(null,"",n),r.entityUrl?e.default.get(r.entityUrl).then(e=>{r.entity=e,"messages"==r.entityType&&e.group&&(r.backUrl="/groups/"+t.default.getId(e.group)),window.dispatchEvent(new CustomEvent("routerStateChange"))}):window.dispatchEvent(new CustomEvent("routerStateChange"));break;case"logout":e.default.reset(),window.location.href=window.location.origin;break;case"invitation":e.default.get("apiKey").then(e=>{e?i.default.post("/api/groups/invitation/"+r.id,{}).then(e=>{window.location.href=window.location.origin}):r.navigate("/signup?inviteKey="+r.id)});break;default:o.default.get().then(e=>{e?e.data.default_group?r.navigate("/groups/"+e.data.default_group):e.groups[0]?r.navigate("/groups/"+e.groups[0].id):window.location="/create-group":r.navigate("/login")})}},sync:()=>r.navigate(window.location.pathname,{replace:!0}),onClick:e=>{e.preventDefault(),e.stopPropagation();for(let i of document.getElementsByClassName("active"))i.classList.remove("active");const t=e.target.closest("a");t&&(e.ctrlKey?window.open(t.getAttribute("href"),"_blank"):r.navigate(t.getAttribute("href")))}};var s=r;exports.default=s;
},{"./cache.js":"NUMl","./util.js":"O1i9","./http.js":"3MqM","./nlg.js":"td1v","./me.js":"DIJp"}],"0rqM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.util=exports.router=exports.nlg=exports.me=exports.imageService=exports.http=exports.exif=exports.cache=exports.alert=void 0;var e=x(require("./alert.js")),t=x(require("./cache.js")),r=x(require("./exif.js")),s=x(require("./http.js")),o=x(require("./image-service.js")),u=x(require("./me.js")),i=x(require("./nlg.js")),p=x(require("./router.js")),l=x(require("./util.js"));function x(e){return e&&e.__esModule?e:{default:e}}const a=e.default;exports.alert=a;const c=t.default;exports.cache=c;const n=r.default;exports.exif=n;const f=s.default;exports.http=f;const d=o.default;exports.imageService=d;const j=u.default;exports.me=j;const q=i.default;exports.nlg=q;const g=p.default;exports.router=g;const h=l.default;exports.util=h;
},{"./alert.js":"vnR2","./cache.js":"NUMl","./exif.js":"L7ok","./http.js":"3MqM","./image-service.js":"n5/G","./me.js":"DIJp","./nlg.js":"td1v","./router.js":"QBcK","./util.js":"O1i9"}],"TXJy":[function(require,module,exports) {
module.exports="/zusam_logo.12e2d2b3.svg";
},{}],"GoyJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=a(require("/assets/zusam_logo.svg"));function a(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(){super(),this.state={showAlert:!1,error:""},this.sendLoginForm=this.sendLoginForm.bind(this),this.sendPasswordReset=this.sendPasswordReset.bind(this),this.showPasswordReset=this.showPasswordReset.bind(this),s.cache.get("apiKey").then(e=>e&&s.router.navigate("/"))}sendPasswordReset(e){e.preventDefault();let t=document.getElementById("login").value||"";t.toLowerCase(),this.setState({sending:!0}),s.http.post("/api/password-reset-mail",{mail:t}).then(e=>{this.setState({sending:!1}),e&&!e.message?s.alert.add(lang.password_reset_mail_sent):s.alert.add(lang[e.message],"alert-danger")})}sendLoginForm(e){e.preventDefault(),this.setState({showAlert:!1,sending:!0});let t=document.getElementById("login").value||"";t.toLowerCase();const a=document.getElementById("password").value;s.http.post("/api/login",{login:t,password:a}).then(e=>{this.setState({sending:!1}),e&&e.api_key?s.cache.set("apiKey",e.api_key).then(()=>{s.me.update().then(()=>{setTimeout(()=>s.router.navigate("/"),100)})}):e.message?s.alert.add(lang[e.message],"alert-danger"):s.alert.add(lang.error,"alert-danger")})}showPasswordReset(){this.setState({showResetPassword:!0})}render(){return(0,e.h)("div",{class:"login"},(0,e.h)("div",{class:"login-form"},(0,e.h)("img",{src:t.default}),!this.state.showResetPassword&&(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:lang.login_placeholder})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:lang.password_placeholder})),(0,e.h)("div",{class:"forgot-password"},(0,e.h)("span",{onClick:this.showPasswordReset},lang.forgot_password)),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:this.sendLoginForm,disabled:this.state.sending},lang.connect)),!!this.state.showResetPassword&&(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:lang.login_placeholder})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:this.sendPasswordReset,disabled:this.state.sending},lang.submit))))}}exports.default=o;
},{"preact":"OmAK","/core":"0rqM","/assets/zusam_logo.svg":"TXJy"}],"gfHB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core");class r extends e.Component{constructor(){super(),this.sendNewPassword=this.sendNewPassword.bind(this)}sendNewPassword(e){e.preventDefault(),s.cache.set("apiKey","");const r=document.getElementById("password").value||"",t=document.getElementById("password_confirmation").value||"",a=s.router.getParam("mail"),o=s.router.getParam("key");if(a&&r){if(r!=t)return void s.alert.add(lang.passwords_dont_match);s.http.post("/api/new-password",{mail:a,key:o,password:r}).then(e=>{e.api_key?(s.cache.set("apiKey",e.api_key),setTimeout(()=>s.router.navigate("/"),100)):s.alert.add(lang[e.message])}).catch(e=>console.warn(e))}}render(){return(0,e.h)("div",{class:"login"},(0,e.h)("div",{class:"login-form"},(0,e.h)("h2",{class:"title"},lang.reset_password_title),(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:lang.new_password_placeholder})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password_confirmation",placeholder:lang.confirm_password_placeholder})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:this.sendNewPassword},lang.submit))))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM"}],"HnNM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=r(require("/assets/zusam_logo.svg"));function r(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(){super(),this.state={showAlert:!1,error:"",inviteKey:t.router.getParam("inviteKey")},this.sendSignupForm=this.sendSignupForm.bind(this)}sendSignupForm(e){e.preventDefault(),this.setState({showAlert:!1});let s=document.getElementById("login").value||"";s.toLowerCase();const r=document.getElementById("password").value;t.cache.set("apiKey",""),t.http.post("/api/signup",{login:s,password:r,invite_key:this.state.inviteKey}).then(e=>{e&&!e.message?(t.cache.set("apiKey",e.api_key),setTimeout(()=>t.router.navigate("/"),100)):t.alert.add(lang[e.message])})}render(){return(0,e.h)("div",{class:"signup"},(0,e.h)("div",{class:"signup-form"},(0,e.h)("img",{src:s.default}),(0,e.h)("div",{class:"welcome lead"},lang.invitation_welcome),(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:lang.login_placeholder})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:lang.password_placeholder})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:this.sendSignupForm},lang.signup))))}}exports.default=o;
},{"preact":"OmAK","/core":"0rqM","/assets/zusam_logo.svg":"TXJy"}],"IWRl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core");class s extends e.Component{constructor(){super(),t.http.get("/api"+window.location.pathname).then(e=>{this.setState({message:lang.notification_emails_stopped})}).catch(e=>{console.warn(e),this.setState({message:lang.error})})}render(){return(0,e.h)("div",null,this.state.message||"")}}exports.default=s;
},{"preact":"OmAK","/core":"0rqM"}],"fWpd":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var c=require("preact");class l extends c.Component{constructor(c){super(c),this.state={regular:{comment:[512,512,[],"f075","M256 32C114.6 32 0 125.1 0 240c0 47.6 19.9 91.2 52.9 126.3C38 405.7 7 439.1 6.5 439.5c-6.6 7-8.4 17.2-4.6 26S14.4 480 24 480c61.5 0 110-25.7 139.1-46.3C192 442.8 223.2 448 256 448c141.4 0 256-93.1 256-208S397.4 32 256 32zm0 368c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C69.7 314.1 48 282.2 48 240c0-88.2 93.3-160 208-160s208 71.8 208 160-93.3 160-208 160z"],images:[576,512,[],"f302","M480 416v16c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V176c0-26.51 21.49-48 48-48h16v48H54a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6v-10h48zm42-336H150a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6V86a6 6 0 0 0-6-6zm6-48c26.51 0 48 21.49 48 48v256c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h384zM264 144c0 22.091-17.909 40-40 40s-40-17.909-40-40 17.909-40 40-40 40 17.909 40 40zm-72 96l39.515-39.515c4.686-4.686 12.284-4.686 16.971 0L288 240l103.515-103.515c4.686-4.686 12.284-4.686 16.971 0L480 208v80H192v-48z"],"check-circle":[512,512,[],"f058","M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 48c110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200-110.532 0-200-89.451-200-200 0-110.532 89.451-200 200-200m140.204 130.267l-22.536-22.718c-4.667-4.705-12.265-4.736-16.97-.068L215.346 303.697l-59.792-60.277c-4.667-4.705-12.265-4.736-16.97-.069l-22.719 22.536c-4.705 4.667-4.736 12.265-.068 16.971l90.781 91.516c4.667 4.705 12.265 4.736 16.97.068l172.589-171.204c4.704-4.668 4.734-12.266.067-16.971z"],"file-pdf":[384,512,[],"f1c1","M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm250.2-143.7c-12.2-12-47-8.7-64.4-6.5-17.2-10.5-28.7-25-36.8-46.3 3.9-16.1 10.1-40.6 5.4-56-4.2-26.2-37.8-23.6-42.6-5.9-4.4 16.1-.4 38.5 7 67.1-10 23.9-24.9 56-35.4 74.4-20 10.3-47 26.2-51 46.2-3.3 15.8 26 55.2 76.1-31.2 22.4-7.4 46.8-16.5 68.4-20.1 18.9 10.2 41 17 55.8 17 25.5 0 28-28.2 17.5-38.7zm-198.1 77.8c5.1-13.7 24.5-29.5 30.4-35-19 30.3-30.4 35.7-30.4 35zm81.6-190.6c7.4 0 6.7 32.1 1.8 40.8-4.4-13.9-4.3-40.8-1.8-40.8zm-24.4 136.6c9.7-16.9 18-37 24.7-54.7 8.3 15.1 18.9 27.2 30.1 35.5-20.8 4.3-38.9 13.1-54.8 19.2zm131.6-5s-5 6-37.3-7.8c35.1-2.6 40.9 5.4 37.3 7.8z"]},solid:{comment:[512,512,[],"f075","M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"],"pencil-alt":[512,512,[],"f303","M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"],"arrow-left":[448,512,[],"f060","M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"],"caret-down":[320,512,[],"f0d7","M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"],film:[512,512,[],"f008","M488 64h-8v20c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12V64H96v20c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12V64h-8C10.7 64 0 74.7 0 88v336c0 13.3 10.7 24 24 24h8v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h320v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h8c13.3 0 24-10.7 24-24V88c0-13.3-10.7-24-24-24zM96 372c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm272 208c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm0-168c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm112 152c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40z"],times:[352,512,[],"f00d","M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"]}}}render(){const l=this.state[this.props.family][this.props.icon];return l&&(0,c.h)("svg",{className:"fa-icon "+this.props.family+" "+this.props.icon,viewBox:"0 0 "+l[0]+" "+l[1]},(0,c.h)("path",{fill:"currentColor",d:l[4]}))}}exports.default=l;
},{"preact":"OmAK"}],"FklW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),i=require("/core"),t=l(require("../components/fa-icon.component.js"));function l(e){return e&&e.__esModule?e:{default:e}}class s extends e.Component{constructor(e){super(e),this.state={files:[]},this.toggleFile=this.toggleFile.bind(this),Array.isArray(e.files)&&e.files.forEach((e,t)=>{if("string"==typeof e&&i.cache.get(e).then(e=>{let i=this.state.files;null==e.fileIndex&&(e.fileIndex=t),i.splice(e.fileIndex,0,e),this.setState({files:i})}),"object"==typeof e){let i=this.state.files;null==e.fileIndex&&(e.fileIndex=t),i.splice(e.fileIndex,0,e),this.setState({files:i})}})}toggleFile(e,i){e.stopPropagation(),e.preventDefault(),"function"==typeof this.props.toggleFile&&this.props.toggleFile(e.currentTarget.getAttribute("fileIndex"))}renderFile(l,s=!1){let r=l.contentUrl?"/files/"+l.contentUrl:null,n=r;if(/image/.test(l.type)&&"image/gif"!=l.type&&(n=i.util.thumbnail(l.id,1366,999999)),1==s)return"ready"==l.status?(0,e.h)("a",{"data-nlg":!this.props.inWriter,"data-origin":r,href:!this.props.inWriter&&n,class:"rounded"},(0,e.h)("div",{className:"miniature"+(l.removed?" removed":""),style:"background-image:url('"+i.util.crop(l.id,160,160)+"')"}),(0,e.h)("div",{class:"remove-button",style:l.removed?"color:red":"",fileIndex:l.fileIndex,onClick:this.toggleFile},(0,e.h)(t.default,{family:"solid",icon:"times"}))):"raw"==l.status?(0,e.h)("a",{class:"rounded"},(0,e.h)("div",{class:"miniature"},(0,e.h)(t.default,{family:"regular",icon:"check-circle"}))):(0,e.h)("a",{class:"rounded"},(0,e.h)("div",{class:"miniature video-raw",style:"background-image:url('"+i.util.crop(l.id,160,160)+"')"}),(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)));if(l.contentUrl){if(/video/.test(l.type))return"ready"==l.status?(0,e.h)("video",{poster:i.util.thumbnail(l.id,1280,720),class:"img-fluid contained-height video",controls:"true",src:n}):(0,e.h)("a",{class:"image video-uploaded"},(0,e.h)("img",{class:"img-fluid video-raw",src:i.util.crop(l.id,320,180)}),(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)));if(/image/.test(l.type))return(0,e.h)("a",{"data-nlg":!this.props.inWriter,"data-origin":r,href:!this.props.inWriter&&n,className:"image"+(l.removed?" removed":"")},(0,e.h)("img",{class:"img-fluid",src:n}),(0,e.h)("div",{class:"remove-button",style:l.removed?"color:red":"",fileIndex:l.fileIndex,onClick:this.toggleFile},(0,e.h)(t.default,{family:"solid",icon:"times"})))}return(0,e.h)("div",{class:"file-placeholder"},l.error?(0,e.h)("div",{class:"orange-error"},""):(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)),(0,e.h)("div",{class:"progress-bar"},(0,e.h)("div",{style:{width:l.progress+"%"}})))}render(){return this.props.files&&0!==this.props.files.length?this.props.files&&this.props.files.length>3?(0,e.h)("div",{class:"file-grid"},this.state.files.sort((e,i)=>e.fileIndex>i.fileIndex?1:-1).map(e=>this.renderFile(e,!0))):(0,e.h)("div",{class:"d-flex justify-content-center flex-wrap"},this.state.files.sort((e,i)=>e.fileIndex>i.fileIndex?1:-1).map(e=>this.renderFile(e))):null}componentDidMount(){i.nlg.start()}componentDidUpdate(){i.nlg.start()}}exports.default=s;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd"}],"rXDu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var s=require("preact"),e=require("/core"),a=t(require("../components/fa-icon.component.js"));function t(s){return s&&s.__esModule?s:{default:s}}class r extends s.Component{render(){return(0,s.h)("div",{class:"message-head d-flex",id:this.props.message.id},(0,s.h)("div",null,(0,s.h)("img",{className:"rounded-circle material-shadow avatar"+(this.props.author?"":" removed-user"),src:this.props.author&&this.props.author.avatar?e.util.crop(this.props.author.avatar.id,100,100):e.util.defaultAvatar,title:this.props.author?this.props.author.name:""})),(0,s.h)("div",{class:"infos"},(0,s.h)("span",{class:"capitalize author"},this.props.author?this.props.author.name:"--"),(0,s.h)("span",{title:e.util.humanFullDate(this.props.message.createdAt)},e.util.humanTime(this.props.message.createdAt))),!this.props.isPublic&&(0,s.h)("div",{tabindex:"-1",class:"options dropdown",onBlur:s=>(!s.relatedTarget||!s.relatedTarget.href)&&s.target.classList.remove("active"),onClick:s=>s.currentTarget.classList.toggle("active")},(0,s.h)(a.default,{family:"solid",icon:"caret-down"}),(0,s.h)("div",{class:"dropdown-menu"},this.props.author&&this.props.author.id==e.me.me.id&&(0,s.h)("a",{class:"seamless-link",onClick:this.props.editMessage},lang.edit),this.props.author&&this.props.author.id==e.me.me.id&&(0,s.h)("a",{class:"seamless-link",onClick:this.props.deleteMessage},lang.delete),!this.props.message.parent&&(0,s.h)("a",{class:"seamless-link",onClick:this.props.openPublicLink},lang.public_link),!this.props.message.parent&&e.me.me.groups.length>1&&(0,s.h)("a",{class:"seamless-link",onClick:this.props.shareMessage},lang.share_message))))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd"}],"Dqqm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core");class r extends e.Component{render(){if(this.state.revealed){const s=this.props.url+"&autoplay=1&controls=2&wmode=opaque";return(0,e.h)("div",{class:"embed-responsive embed-responsive-16by9"},(0,e.h)("iframe",{allowfullscreen:!0,class:"embed-responsive-item",src:s}))}return(0,e.h)("div",{class:"embed-preview",onClick:()=>this.setState({revealed:!0})},(0,e.h)("div",{class:"youtube"}),(0,e.h)("img",{src:s.util.crop(this.props.preview.id,1024,270)}))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM"}],"jmUf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core");class r extends e.Component{render(){return this.state.revealed?(0,e.h)("div",{class:"embed-responsive embed-responsive-16by9"},(0,e.h)("iframe",{class:"embed-responsive-item",src:this.props.url})):(0,e.h)("div",{class:"embed-preview",onClick:()=>this.setState({revealed:!0})},(0,e.h)("div",{class:"soundcloud"}),(0,e.h)("img",{src:s.util.crop(this.props.preview.id,1024,270)}))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM"}],"0gPU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact");class t extends e.Component{render(){let t="";const s=this.props.url.split("/");switch(s[2]){case"www.twitch.tv":t=s.length>5&&"clip"==s[4]?"https://clips.twitch.tv/embed?clip="+s[5].replace(/\?.*$/,"")+"&autoplay=false":"https://player.twitch.tv/?video="+s[4].replace(/\?.*$/,"")+"&autoplay=false";break;case"clips.twitch.tv":t="https://clips.twitch.tv/embed?clip="+s[3].replace(/\?.*$/,"")+"&autoplay=false"}return(0,e.h)("div",{class:"embed-responsive embed-responsive-16by9"},(0,e.h)("iframe",{allowfullscreen:!0,class:"embed-responsive-item",src:t}))}}exports.default=t;
},{"preact":"OmAK"}],"U94+":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact");class s extends e.Component{render(){const s=this.props.url+"/size=large/bgcol=f5f5f5/linkcol=0687f5/minimal=true/tracklist=false/";return(0,e.h)("div",{class:"bandcamp-embed embed-responsive embed-responsive-1by1"},(0,e.h)("iframe",{class:"embed-responsive-item",src:s}))}}exports.default=s;
},{"preact":"OmAK"}],"7smv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _preact=require("preact"),_core=require("/core"),_youtubeEmbedComponent=_interopRequireDefault(require("./embeds/youtube-embed.component.js")),_soundcloudEmbedComponent=_interopRequireDefault(require("./embeds/soundcloud-embed.component.js")),_twitchEmbedComponent=_interopRequireDefault(require("./embeds/twitch-embed.component.js")),_bandcampEmbedComponent=_interopRequireDefault(require("./embeds/bandcamp-embed.component.js"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}class PreviewBlock extends _preact.Component{execute(e){if(e.innerHTML)eval(e.innerHTML);else{const t=e.getAttribute("src");if(t){const e=document.createElement("script");e.async=!0,e.src=t,document.head.appendChild(e)}}}componentDidMount(){this.embedContainer&&Array.from(this.embedContainer.getElementsByTagName("script")).forEach(e=>this.execute(e))}componentDidUpdate(){this.embedContainer&&Array.from(this.embedContainer.getElementsByTagName("script")).forEach(e=>this.execute(e))}getPreview(){if(this.props.data.providerUrl)switch(this.props.data.providerUrl.toLowerCase().replace(/\/$/,"").replace(/^https?:\/\/(www\.)?/,"")){case"youtube.com":if("video"==this.props.data.type&&this.props.data.code)return(0,_preact.h)(_youtubeEmbedComponent.default,{preview:this.props.preview,url:this.props.data.code.match(/https:\/\/[^\"\s]+/)[0]});break;case"soundcloud.com":if(this.props.data.code)return(0,_preact.h)(_soundcloudEmbedComponent.default,{preview:this.props.preview,url:this.props.data.code.match(/https:\/\/[^\"\s]+/)[0]+"&auto_play=true"});case"twitch.tv":return(0,_preact.h)(_twitchEmbedComponent.default,{preview:this.props.preview,url:this.props.data.url});case"bandcamp.com":if(this.props.data.code)return(0,_preact.h)(_bandcampEmbedComponent.default,{url:this.props.data.code.match(/https:\/\/.*album=\d+/)[0]});case"imgur.com":if("photo"==this.props.data.type)break;case"vimeo.com":case"dailymotion.com":if(this.props.data.code)return(0,_preact.h)("div",{class:"embed-container",ref:e=>this.embedContainer=e,dangerouslySetInnerHTML:{__html:this.props.data.code}})}if(this.props.data.providerName)switch(this.props.data.providerName.toLowerCase()){case"peertube":if(this.props.data.code)return(0,_preact.h)("div",{class:"embed-container",ref:e=>this.embedContainer=e,dangerouslySetInnerHTML:{__html:this.props.data.code}})}return/image/.test(this.props.data["content-type"])?(0,_preact.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,_preact.h)("img",{"data-nlg":!this.props.inWriter,href:this.props.url,class:"img-fluid cursor-pointer","data-src":this.props.url,src:this.props.preview&&!/gif/.test(this.props.data["content-type"])?_core.util.thumbnail(this.props.preview.id,1280,720):this.props.url})):/video/.test(this.props.data["content-type"])?(0,_preact.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,_preact.h)("video",{class:"img-fluid",controls:!0,src:this.props.url})):this.props.data.title&&(this.props.preview||this.props.data.description)?(0,_preact.h)("a",{class:"preview-card seamless-link d-inline-block",target:"_blank",href:this.props.url},(0,_preact.h)("div",{class:"card",style:"max-width: 480px"},this.props.preview&&(0,_preact.h)("img",{class:"card-img-top",src:_core.util.crop(this.props.preview.id,320,180)}),(0,_preact.h)("div",{class:"card-body p-1"},(0,_preact.h)("h5",null,this.props.data.title),this.props.data.description&&(0,_preact.h)("p",null,(0,_preact.h)("small",null,this.props.data.description.slice(0,500)))))):null}render(){if(!this.props.url||!this.props.data)return null;let e=this.getPreview();return e?(0,_preact.h)("p",{class:"text-center card-text"},e):null}}exports.default=PreviewBlock;
},{"preact":"OmAK","/core":"0rqM","./embeds/youtube-embed.component.js":"Dqqm","./embeds/soundcloud-embed.component.js":"jmUf","./embeds/twitch-embed.component.js":"0gPU","./embeds/bandcamp-embed.component.js":"U94+"}],"xBfm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=a(require("./preview-block.component.js")),i=a(require("./file-grid.component.js")),r=a(require("../components/fa-icon.component.js"));function a(e){return e&&e.__esModule?e:{default:e}}class l extends e.Component{displayMessageText(){if(!this.props.data)return"";let e=this.props.data.text.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim(),t=0,i=null;for(;i=s.util.getUrl(e.slice(t));){let s=i[0];s.length>=50&&(s=s.slice(0,25)+"..."+s.slice(-24));let r='<a href="'+i[0]+'" target="_blank">'+s+"</a>";e=e.slice(0,i.index+t)+r+e.slice(i.index+t+i[0].length),t+=i.index+r.length}return{__html:e=e.replace(/\n/g,"<br/>")}}render(){return(0,e.h)("div",{class:"message-body"},this.props.message.parent&&!this.props.isPublic&&this.props.author&&s.me.me&&this.props.author.id==s.me.me.id&&(0,e.h)("div",{tabindex:"-1",class:"options dropdown d-none d-md-flex",onBlur:e=>(!e.relatedTarget||!e.relatedTarget.href)&&e.target.classList.remove("active"),onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)(r.default,{family:"solid",icon:"caret-down"}),(0,e.h)("div",{class:"dropdown-menu"},(0,e.h)("a",{class:"seamless-link",onClick:this.props.editMessage},lang.edit),(0,e.h)("a",{class:"seamless-link",onClick:this.props.deleteMessage},lang.delete),!this.props.message.parent&&(0,e.h)("a",{class:"seamless-link",onClick:this.props.openPublicLink},lang.public_link))),this.props.data&&this.props.data.title&&(0,e.h)("div",{class:"title"},(0,e.h)("span",null,this.props.data.title)),this.props.data&&this.props.data.text&&this.props.data.text.trim()&&(0,e.h)("p",{class:"card-text",dangerouslySetInnerHTML:this.displayMessageText()}),this.props.preview&&(0,e.h)(t.default,{key:this.props.preview.url,url:this.props.preview.url,preview:this.props.preview.preview,data:this.props.preview.data}),this.props.message.files&&(0,e.h)(i.default,{files:this.props.message.files}),this.props.message.parent&&(0,e.h)("div",{class:"infos",title:s.util.humanFullDate(this.props.message.createdAt)},(0,e.h)("span",null,s.util.humanTime(this.props.message.createdAt))))}}exports.default=l;
},{"preact":"OmAK","/core":"0rqM","./preview-block.component.js":"7smv","./file-grid.component.js":"FklW","../components/fa-icon.component.js":"fWpd"}],"gXdK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=l(require("./message.component.js"));function l(e){return e&&e.__esModule?e:{default:e}}class s extends e.Component{render(){return this.props.children&&this.props.displayedChildren?(0,e.h)("div",null,this.props.displayedChildren<this.props.children.length&&(0,e.h)("a",{class:"more-coms",onClick:this.props.displayMoreChildren},lang.more_coms),this.props.children.map((l,s,t)=>{if(!l.files.length&&""==l.data.text&&!l.children.length)return null;let i="";return t[s-1]&&t[s-1].author&&l.author&&t[s-1].author.id==l.author.id&&s>this.props.children.length-this.props.displayedChildren&&(t[s-1].files.length||""!=t[s-1].data.text||t[s-1].children.length)&&(i=" follow"),(0,e.h)(r.default,{message:l,key:l.id,follow:i,hidden:s<this.props.children.length-this.props.displayedChildren,isPublic:this.props.isPublic})})):null}}exports.default=s;
},{"preact":"OmAK","./message.component.js":"u6+B"}],"jeBy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=n(require("../components/fa-icon.component.js")),i=n(require("./preview-block.component.js")),l=n(require("./file-grid.component.js")),a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e};function n(e){return e&&e.__esModule?e:{default:e}}class r extends e.Component{constructor(e){super(e),this.sendMessage=this.sendMessage.bind(this),this.genPreview=this.genPreview.bind(this),this.postMessage=this.postMessage.bind(this),this.putMessage=this.putMessage.bind(this),this.onKeyPress=this.onKeyPress.bind(this),this.toggleFile=this.toggleFile.bind(this),this.inputImages=this.inputImages.bind(this),this.inputVideo=this.inputVideo.bind(this),this.uploadFile=this.uploadFile.bind(this),this.uploadNextImage=this.uploadNextImage.bind(this),this.state={files:[],writerId:+Date.now()}}componentWillMount(){this.setState({files:this.props.files||[],link:null,preview:null})}componentDidMount(){document.getElementById("title")&&(document.getElementById("title").value=this.props.title||""),document.getElementById("text")&&(document.getElementById("text").value=this.props.text||""),this.props.focus&&setTimeout(()=>{document.getElementById("text")&&(document.getElementById("text").focus(),document.getElementById("text").style.height=document.getElementById("text").scrollHeight+"px",this.genPreview(document.getElementById("text")))},10)}onKeyPress(e,t=!1){e.ctrlKey&&"Enter"==e.key?this.sendMessage():[" ","Enter","v"].includes(e.key)&&t&&this.genPreview(e.currentTarget)}genPreview(e){e.style.height="1px",e.style.height=e.scrollHeight+"px",setTimeout(()=>{let s=e.value.match(/(https?:\/\/[^\s]+)/gi);s&&s[0]!=this.state.link&&t.cache.get("/api/links/by_url?url="+encodeURIComponent(s[0])).then(t=>{t&&e.value.indexOf(s[0])>=0&&this.setState({link:s[0],preview:t})})},0)}toggleFile(e){let t=this.state.files,s=t.find(t=>t.fileIndex==e);s.removed=!s.removed,this.setState({files:t})}sendMessage(){this.props.messageId?this.putMessage():this.postMessage()}putMessage(){let e={files:this.state.files.filter(e=>!e.removed).map(e=>"/api/files/"+e.id).filter(e=>!!e),data:{text:document.getElementById("text").value}};this.props.parent||(e.data.title=document.getElementById("title").value),t.http.put("/api/messages/"+this.props.messageId,e).then(e=>{this.setState({sending:!1}),e?window.dispatchEvent(new CustomEvent("editMessage",{detail:e})):t.alert.add(lang.error_new_message,"alert-danger")}),this.setState({sending:!0})}postMessage(){let e={createdAt:Math.floor(Date.now()/1e3),author:"/api/users/"+t.me.me.id,group:this.props.group,children:[],files:this.state.files.filter(e=>!e.removed).map(e=>"/api/files/"+e.id).filter(e=>!!e),data:{text:document.getElementById("text").value},lastActivityDate:Math.floor(Date.now()/1e3)};this.props.parent?e.parent="/api/messages/"+t.util.getId(this.props.parent):e.data.title=document.getElementById("title").value,e.files.length||e.data.text||e.data.title?(t.http.post("/api/messages",e).then(s=>{if(!s)return t.alert.add(lang.error_new_message,"alert-danger"),void this.setState({sending:!1});this.props.parent?(t.cache.remove("/api/messages/"+this.props.parent),window.dispatchEvent(new CustomEvent("newChild",{detail:s}))):(t.cache.remove(this.props.group),t.router.navigate(t.router.backUrl||e.group.slice(4)),window.dispatchEvent(new CustomEvent("newMessage",{detail:s}))),this.setState({sending:!1,files:[],link:null,preview:null,writerId:+Date.now()}),document.getElementById("text")&&(document.getElementById("text").value="")}),this.setState({sending:!0})):t.alert.add(lang.empty_message,"alert-danger")}inputImages(e){const t=document.createElement("input");document.body.appendChild(t),t.style.display="none",t.type="file",t.multiple="multiple",t.accept="image/*",t.addEventListener("change",e=>{let t=Array.from(e.target.files),s=this.state.files;this.setState({files:[...s,...Array.apply(null,Array(t.length)).map(e=>new Object({fileIndex:1e3}))]}),this.uploadNextImage(t,t[Symbol.iterator](),s.length)}),t.click()}inputVideo(e){const t=document.createElement("input");document.body.appendChild(t),t.style.display="none",t.type="file",t.accept="video/*",t.addEventListener("change",e=>{let t=this.state.files,s=Date.now();this.setState({files:[...t,{fileIndex:s,type:"video",progress:0}]}),this.uploadFile(e.target.files[0],t.length,s)}),t.click()}uploadNextImage(e,s,i){let l=null;try{if(!s)return;if(!(l=s.next())||!l.value)return;l.value.size}catch(a){return void t.alert.add(lang.multiple_photos_upload,"alert-danger")}t.imageService.handleImage(l.value,t=>this.uploadFile(t,i+e.indexOf(l.value),null,()=>this.uploadNextImage(e,s,i)))}uploadFile(e,s,i,l=null){const a=new FormData;a.append("file",e),a.append("fileIndex",s);let n=i?t=>{if(Array.isArray(this.state.files)){let l=this.state.files;(e=l.find(e=>e.fileIndex==i))&&(e.progress=Math.floor(t.loaded/t.total*100),l.splice(s,1,e),this.setState({files:l}))}}:null,r=this.state.writerId;t.http.sendFile(a,e=>{if(r!=this.state.writerId)return;let i=this.state.files;e?i.splice(s,1,e):t.alert.add(lang.error_upload,"alert-danger"),this.setState({files:i}),l&&l()},n,e=>{console.warn(e),t.alert.add(lang.error_upload,"alert-danger");let i=this.state.files;i.splice(s,1,{fileIndex:s,error:e}),this.setState({files:i})})}render(){return this.state.sending?(0,e.h)("div",{class:"message-placeholder"},(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null))):(0,e.h)("div",{class:"writer"},!this.props.parent&&(0,e.h)("input",{type:"text",id:"title",onKeyPress:this.onKeyPress,placeholder:lang.title_placeholder}),(0,e.h)("textarea",{onKeyPress:e=>this.onKeyPress(e,!0),id:"text",placeholder:lang.text_placeholder,rows:"5",autocomplete:"off",autofocus:this.props.focus}),this.state.preview&&(0,e.h)(i.default,a({inWriter:!0},this.state.preview)),!!this.state.files.length&&(0,e.h)(l.default,{key:this.state.files.reduce((e,t)=>e+t.id+t.fileIndex+t.error,""),files:this.state.files,toggleFile:this.toggleFile,inWriter:!0}),(0,e.h)("div",{class:"options"},(0,e.h)("button",{class:"option",onClick:this.inputImages,title:lang.upload_image},(0,e.h)(s.default,{family:"regular",icon:"images"})),(0,e.h)("button",{class:"option",onClick:this.inputVideo,title:lang.upload_video},(0,e.h)(s.default,{family:"solid",icon:"film"})),(0,e.h)("div",{class:"actions"},this.props.cancel&&(0,e.h)("button",{class:"cancel",onClick:this.props.cancel},lang.cancel),(0,e.h)("button",{type:"submit",class:"submit",onClick:this.sendMessage},lang.submit))))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd","./preview-block.component.js":"7smv","./file-grid.component.js":"FklW"}],"u6+B":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=l(require("../components/fa-icon.component.js")),a=l(require("./message-head.component.js")),i=l(require("./message-body.component.js")),d=l(require("./message-children.component.js")),h=l(require("./writer.component.js"));function l(e){return e&&e.__esModule?e:{default:e}}class r extends e.Component{constructor(e){super(e),this.loadMessage=this.loadMessage.bind(this),this.deleteMessage=this.deleteMessage.bind(this),this.editMessage=this.editMessage.bind(this),this.shareMessage=this.shareMessage.bind(this),this.openPublicLink=this.openPublicLink.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.onNewChild=this.onNewChild.bind(this),this.onEditMessage=this.onEditMessage.bind(this),e.parent||window.addEventListener("newChild",this.onNewChild),window.addEventListener("editMessage",this.onEditMessage);let s=t.router.entityUrl;!s&&e.message&&(s="/api/message/"+e.message.id),this.state={url:s,preview:null},e.message&&this.loadMessage(e.message)}componentDidMount(){setTimeout(()=>window.scrollTo(0,0))}loadMessage(e){t.me.removeNews(e.id),this.setState({message:e,author:e.author,displayedChildren:e.children&&5})}cancelEdit(e){e.preventDefault(),this.setState({edit:!1})}async openPublicLink(e){e.preventDefault();let s=window.open("about:blank","_blank");const a=await t.http.get("/api/messages/"+this.state.message.id+"/get-public-link");s.location=window.origin+"/public/"+a.token}deleteMessage(e){e.preventDefault(),confirm(lang.ask_delete_message)&&(t.http.delete("/api/messages/"+this.state.message.id),t.cache.resetCache(),setTimeout(()=>{this.state.message.parent?this.setState({isRemoved:!0}):t.router.navigate(this.state.message.group,{data:{resetGroupDisplay:!0}})},100))}shareMessage(e){e.preventDefault(),t.router.navigate("/share?message="+this.state.message.id)}editMessage(e){e.preventDefault(),this.setState({edit:!0})}onEditMessage(e){if(e.detail.id==this.state.message.id){this.props.key=+Date.now();let t=this.state.message;t.data=e.detail.data,t.files=e.detail.files,this.setState({message:t,data:t.data}),setTimeout(e=>this.setState({edit:!1}))}}onNewChild(e){const s=e.detail;let a=this.state.message;s.parent&&t.util.getId(s.parent)==a.id&&(s.author=t.me.me,a.children=[...a.children,s],this.setState({displayedChildren:this.state.displayedChildren+1,message:a}))}displayWriter(){return(0,e.h)(h.default,{cancel:this.state.edit?this.cancelEdit:null,files:this.state.edit?this.state.message.files:[],focus:!!this.state.edit,group:this.state.message.group,messageId:this.state.edit?this.state.message.id:null,parent:this.state.edit?this.state.message.parent:this.state.message.id,text:this.state.edit?this.state.data.text:"",title:this.state.edit?this.state.data.title:""})}render(){if(!this.props.hidden&&(this.state.message||t.cache.get(this.state.url).then(e=>this.loadMessage(e)),this.state.message&&this.state.message.id&&!this.state.isRemoved)){if(!this.state.gotPreview&&this.state.message.data){let e=t.util.getUrl(this.state.message.data.text);e?t.cache.get("/api/links/by_url?url="+encodeURIComponent(e[0])).then(e=>{this.setState({preview:e,gotPreview:!0,data:this.state.message.data})}):this.setState({gotPreview:!0,data:this.state.message.data})}return(0,e.h)("div",null,(0,e.h)("div",{className:"message"+(this.state.message.parent?" child":"")+(this.props.follow||"")},this.state.edit&&this.state.message.parent&&t.me.me&&(0,e.h)("div",{class:"message-head p-1 d-none d-md-block"},(0,e.h)("img",{class:"rounded-circle w-3 material-shadow avatar",src:t.me.me.avatar?t.util.crop(t.me.me.avatar.id,100,100):t.util.defaultAvatar})),this.state.edit&&this.displayWriter(),!this.state.edit&&(0,e.h)(a.default,{author:this.state.author,message:this.state.message,editMessage:this.editMessage,deleteMessage:this.deleteMessage,openPublicLink:this.openPublicLink,shareMessage:this.shareMessage,isPublic:this.props.isPublic}),!this.state.edit&&(0,e.h)(i.default,{author:this.state.author,message:this.state.message,data:this.state.data,preview:this.state.preview,editMessage:this.editMessage,deleteMessage:this.deleteMessage,openPublicLink:this.openPublicLink,shareMessage:this.shareMessage,isPublic:this.props.isPublic})),!this.state.message.parent&&(0,e.h)(d.default,{children:this.state.message.children,displayedChildren:this.state.displayedChildren,displayMoreChildren:e=>this.setState({displayedChildren:this.state.displayedChildren+10}),isPublic:this.props.isPublic,key:this.state.message.id}),!this.state.edit&&!this.props.isPublic&&!this.state.message.parent&&(0,e.h)("div",{class:"message child"},t.me.me&&(0,e.h)("div",{class:"message-head p-1 d-none d-md-block"},(0,e.h)("img",{class:"rounded-circle w-3 material-shadow avatar",src:t.me.me.avatar?t.util.crop(t.me.me.avatar.id,100,100):t.util.defaultAvatar})),this.displayWriter()))}}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd","./message-head.component.js":"rXDu","./message-body.component.js":"xBfm","./message-children.component.js":"gXdK","./writer.component.js":"jeBy"}],"Ttzu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=a(require("../components/fa-icon.component.js"));function a(e){return e&&e.__esModule?e:{default:e}}class i extends e.Component{constructor(e){super(e),this.state={message:e.message},e.message.author&&t.cache.get("/api/users/"+e.message.author).then(e=>e&&this.setState({author:e})),this.setState({title:e.message.data.title||"",text:e.message.data.text||""}),e.message.preview&&this.setState({preview:e.message.preview})}getAvatar(s){return(0,e.h)("img",{title:s?s.name:"",className:"avatar material-shadow"+(s?"":" removed-user"),src:s&&s.avatar?t.util.crop(s.avatar.id,100,100):t.util.defaultAvatar,onError:e=>e.currentTarget.src=t.util.defaultAvatar})}render(){return(0,e.h)("a",{class:"d-inline-block seamless-link message-preview unselectable",href:"/messages/"+this.state.message.id,onClick:t.router.onClick,title:this.state.title},(0,e.h)("div",{tabindex:this.props.tabindex,class:"card material-shadow"},this.getAvatar(this.state.author),this.state.preview?(0,e.h)("div",{class:"card-miniature",style:"background-image: url('"+t.util.crop(this.state.preview,320,180)+"')"}):(0,e.h)("div",{class:"text-preview"},this.state.text),(0,e.h)("div",{class:"card-body border-top d-flex justify-content-between"},(0,e.h)("span",{class:"left-buffer"}),(0,e.h)("span",{class:"title",title:this.state.title||t.util.humanFullDate(this.state.message.lastActivityDate)},this.state.title||t.util.humanTime(this.state.message.lastActivityDate)),(0,e.h)("span",{class:"children"},!!this.state.message.children&&(0,e.h)("span",null,this.state.message.children+" ",(0,e.h)(s.default,{family:t.me.isNews(this.state.message.id)?"solid":"regular",icon:"comment"}))))))}}exports.default=i;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd"}],"/82E":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Writer=exports.PreviewBlock=exports.MessagePreview=exports.MessageHead=exports.MessageChildren=exports.MessageBody=exports.Message=exports.FileGrid=void 0;var e=p(require("./file-grid.component.js")),s=p(require("./message.component.js")),r=p(require("./message-body.component.js")),o=p(require("./message-children.component.js")),t=p(require("./message-head.component.js")),n=p(require("./message-preview.component.js")),i=p(require("./preview-block.component.js")),a=p(require("./writer.component.js"));function p(e){return e&&e.__esModule?e:{default:e}}const d=e.default;exports.FileGrid=d;const c=s.default;exports.Message=c;const u=r.default;exports.MessageBody=u;const l=o.default;exports.MessageChildren=l;const x=t.default;exports.MessageHead=x;const g=n.default;exports.MessagePreview=g;const m=i.default;exports.PreviewBlock=m;const f=a.default;exports.Writer=f;
},{"./file-grid.component.js":"FklW","./message.component.js":"u6+B","./message-body.component.js":"xBfm","./message-children.component.js":"gXdK","./message-head.component.js":"rXDu","./message-preview.component.js":"Ttzu","./preview-block.component.js":"7smv","./writer.component.js":"jeBy"}],"Zdby":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/message");class r extends e.Component{constructor(){super(),this.state={},t.router.id&&t.http.get("/api/public/"+t.router.id).then(e=>this.setState({message:e}))}render(){if(this.state.message)return(0,e.h)("article",{class:"justify-content-center d-flex"},(0,e.h)("div",{class:"container"},(0,e.h)(s.Message,{isPublic:!0,key:this.state.message.id,message:this.state.message})))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM","/message":"/82E"}],"Dm2o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Public=exports.StopNotificationEmails=exports.Signup=exports.ResetPassword=exports.Login=void 0;var e=i(require("./login.component.js")),o=i(require("./reset-password.component.js")),t=i(require("./signup.component.js")),s=i(require("./stop-notification-emails.component.js")),r=i(require("./public.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}const n=e.default;exports.Login=n;const p=o.default;exports.ResetPassword=p;const u=t.default;exports.Signup=u;const c=s.default;exports.StopNotificationEmails=c;const a=r.default;exports.Public=a;
},{"./login.component.js":"GoyJ","./reset-password.component.js":"gfHB","./signup.component.js":"HnNM","./stop-notification-emails.component.js":"IWRl","./public.component.js":"Zdby"}],"BHsO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),r=s(require("./fa-icon.component.js"));function s(e){return e&&e.__esModule?e:{default:e}}class a extends e.Component{constructor(e){super(e),this.clickBackButton=this.clickBackButton.bind(this),this.onUpdateMe=this.onUpdateMe.bind(this),window.addEventListener("updateMe",this.onUpdateMe)}clickBackButton(e){if(e.preventDefault(),t.router.backUrlPrompt&&!confirm(t.router.backUrlPrompt))return!1;t.router.onClick(e)}onUpdateMe(){this.setState({})}getTitle(){if(t.router.entity&&t.router.entity.name)return t.router.entity.name;if(t.me.me.groups){let e=t.me.me.groups.find(e=>e.id==t.util.getId(t.router.entity.group));return e?e.name:""}return""}getTitleRoute(){return"messages"==t.router.route?t.router.entity.group.slice(4):t.router.toApp(t.router.entity).slice(4)}groupsHasNews(){return t.me.me.groups.reduce((e,r)=>e||t.me.isNews(r.id),!1)}render(){return(0,e.h)("div",{class:"main-nav nav align-items-center z-index-100"},!t.router.backUrl&&(0,e.h)("div",{class:"menu dropdown",tabindex:"-1",onBlur:e=>(!e.relatedTarget||!e.relatedTarget.href)&&e.target.classList.remove("active"),onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)("div",{class:"rounded-circle avatar unselectable"},(0,e.h)("img",{class:"rounded-circle",src:t.me.me.avatar?t.util.crop(t.me.me.avatar.id,80,80):t.util.defaultAvatar,onError:e=>e.currentTarget.src=t.util.defaultAvatar})),(0,e.h)("div",{class:"dropdown-menu"},(0,e.h)("a",{class:"seamless-link",href:"/users/"+t.me.me.id+"/settings",onClick:t.router.onClick},lang.settings),(0,e.h)("a",{class:"seamless-link",href:"/logout",onClick:t.router.onClick},lang.logout))),t.router.backUrl&&(0,e.h)("a",{class:"seamless-link back",href:t.router.backUrl,onClick:this.clickBackButton},(0,e.h)(r.default,{family:"solid",icon:"arrow-left"})),["groups","messages"].includes(t.router.route)&&(0,e.h)("span",{class:"title"},(0,e.h)("a",{href:this.getTitleRoute(),class:"cursor-pointer unselectable"},this.getTitle())),t.me.me.groups&&(0,e.h)("div",{className:"nav-link dropdown groups unselectable"+(this.groupsHasNews()?" has-news":""),tabindex:"-1",onBlur:e=>(!e.relatedTarget||!e.relatedTarget.href)&&e.target.classList.remove("active"),onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)("div",{class:"dropdown-title unselectable"},lang.groups," ",(0,e.h)(r.default,{family:"solid",icon:"caret-down"})),(0,e.h)("div",{class:"dropdown-menu"},Array.isArray(t.me.me.groups)&&t.me.me.groups.map(r=>(0,e.h)("a",{className:"seamless-link unselectable"+(t.me.isNews(r.id)?" has-news":""),href:"/groups/"+r.id,onClick:t.router.onClick},r.name)),(0,e.h)("a",{class:"seamless-link unselectable",href:"/create-group",onClick:t.router.onClick},"+ "+lang.create_a_group))))}}exports.default=a;
},{"preact":"OmAK","/core":"0rqM","./fa-icon.component.js":"fWpd"}],"FJIr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),a=s(require("../components/fa-icon.component.js"));function s(e){return e&&e.__esModule?e:{default:e}}class r extends e.Component{constructor(e){super(e),this.updateSettings=this.updateSettings.bind(this),this.leaveGroup=this.leaveGroup.bind(this),this.leave=this.leave.bind(this),this.resetSecretKey=this.resetSecretKey.bind(this),this.state=Object.assign({hydratedUsers:[]},e),e.users.map(e=>t.cache.get(e).then(e=>this.setState({hydratedUsers:[...this.state.hydratedUsers,e]})))}resetSecretKey(e){e.preventDefault(),t.http.post("/api/groups/"+this.state.id+"/reset-invite-key",{}).then(e=>{t.alert.add(lang.group_updated),t.cache.resetCache(),this.setState({secretKey:e.inviteKey})})}updateSettings(e){e.preventDefault();const a=document.querySelector("#settings_form input[name='name']").value;let s={};a&&(s.name=a),t.http.put("/api/groups/"+this.state.id,s).then(e=>{t.alert.add(lang.group_updated),t.cache.resetCache(),this.setState(Object.assign(this.state,e))})}leaveGroup(e){if(e.preventDefault(),t.me.me.data.default_group==this.state.id){let e={};e.data={default_group:t.me.me.groups[0].id},t.http.put("/api/users/"+t.me.me.id,e).then(e=>{t.me.update(),this.leave()})}else this.leave()}leave(){t.http.post("/api/groups/"+this.state.id+"/leave",{}).then(e=>{e&&e.entityType?(t.me.update(),t.alert.add(lang.group_left),t.router.navigate("/")):t.alert.add(lang.error)})}render(){return(0,e.h)("div",null,(0,e.h)("div",{class:"group-settings mb-3"},(0,e.h)("div",{class:"card"},(0,e.h)("div",{class:"card-body"},(0,e.h)("div",{class:"container-fluid p-1"},(0,e.h)("div",{class:"row"},(0,e.h)("div",{class:"col-12 col-md-10"},(0,e.h)("form",{id:"settings_form",class:"mb-1 border-bottom pb-1"},(0,e.h)("div",{class:"form-group"},(0,e.h)("label",{for:"name"},lang.name,": "),(0,e.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:lang.name_input,value:this.state.name,class:"form-control",required:!0})),(0,e.h)("button",{onClick:this.updateSettings,class:"btn btn-outline-secondary"},lang.save_changes)),(0,e.h)("form",{class:"mb-1 border-bottom pb-1"},(0,e.h)("div",{class:"form-group"},(0,e.h)("label",{for:"inviteKey"},lang.invitation_link,": "),(0,e.h)("input",{type:"text",name:"inviteKey",value:location.protocol+"//"+location.hostname+"/invitation/"+this.state.secretKey,class:"form-control font-size-80",readonly:"readonly"})),(0,e.h)("button",{class:"btn btn-outline-secondary",onClick:this.resetSecretKey},lang.reset_invitation_link)),(0,e.h)("form",null,(0,e.h)("button",{onClick:this.leaveGroup,class:"btn btn-outline-danger"},lang.quit_group)))))))),(0,e.h)("div",{class:"user-list mb-3"},(0,e.h)("h3",null,lang.users),this.state.hydratedUsers.map(a=>(0,e.h)("div",{class:"user-card"},(0,e.h)("img",{class:"avatar material-shadow",src:a&&a.avatar?t.util.crop(a.avatar.id,200,200):t.util.defaultAvatar,onError:e=>e.currentTarget.src=t.util.defaultAvatar}),(0,e.h)("span",null,a.name)))))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd"}],"e3YL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),a=n(require("../components/fa-icon.component.js"));function n(t){return t&&t.__esModule?t:{default:t}}class s extends t.Component{constructor(t){super(t),this.updateSettings=this.updateSettings.bind(this),this.destroyAccount=this.destroyAccount.bind(this),this.state=Object.assign({},t),this.inputAvatar=this.inputAvatar.bind(this)}inputAvatar(t){const a=document.createElement("input");a.type="file",a.accept="image/*",a.addEventListener("change",t=>{let a=new Image;a.onload=(()=>{let t=Math.min(a.naturalWidth,256),n=Math.min(a.naturalHeight,256),s=Math.min(t/a.naturalWidth,n/a.naturalHeight),l=Math.floor(a.naturalWidth*s),o=Math.floor(a.naturalHeight*s);e.imageService.resize(a,l,o,t=>{const a=new FormData;a.append("file",t),e.http.post("/api/files/upload",a,!1).then(t=>{e.http.put("/api/users/"+this.state.id,{avatar:t.id}).then(a=>{this.setState({avatar:t}),e.cache.resetCache(),e.alert.add(lang.settings_updated)})})})}),a.src=URL.createObjectURL(t.target.files[0])}),a.click()}destroyAccount(t){t.preventDefault(),confirm(lang.are_you_sure)&&e.http.delete("/api/users/"+this.state.id).then(t=>{e.router.navigate("/logout")})}updateSettings(t){t.preventDefault();const a=document.querySelector("#settings_form input[name='name']").value,n=document.querySelector("#settings_form input[name='email']").value,s=document.querySelector("#settings_form input[name='password']").value,l=document.querySelector("#settings_form select[name='notification_emails']").value,o=document.querySelector("#settings_form select[name='default_group']").value;let i={};a&&(i.name=a),n&&(i.login=n),s&&(i.password=s),i.data={notification_emails:l,default_group:o},e.http.put("/api/users/"+this.state.id,i).then(t=>{this.setState(Object.assign(this.state,t)),e.alert.add(lang.settings_updated),e.me.update()})}render(){return(0,t.h)("div",{class:"user-settings"},(0,t.h)("div",{class:"card"},(0,t.h)("div",{class:"identite card-body"},(0,t.h)("div",{class:"container-fluid p-1"},(0,t.h)("div",{class:"row"},(0,t.h)("div",{class:"col-12 col-md-2"},(0,t.h)("img",{class:"img-fluid rounded-circle material-shadow avatar",src:this.state.avatar?e.util.crop(this.state.avatar.id,100,100):e.util.defaultAvatar,onError:t=>t.currentTarget.src=e.util.defaultAvatar,onClick:this.inputAvatar})),(0,t.h)("div",{class:"col-12 col-md-10"},(0,t.h)("form",{id:"settings_form",class:"mb-3"},(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"name"},lang.name,": "),(0,t.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:lang.name_input,value:this.state.name,class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"email"},lang.email,": "),(0,t.h)("input",{type:"email",name:"email",placeholder:lang.email_input,value:this.state.login,class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"password"},lang.password,": "),(0,t.h)("input",{type:"password",name:"password",autocomplete:"off",minlength:"8",maxlength:"128",placeholder:lang.password_input,class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"notification_emails"},lang.notification_emails,":"),(0,t.h)("select",{name:"notification_emails",class:"form-control",selectedIndex:["none","hourly","daily","weekly","monthly"].indexOf(this.state.data.notification_emails)},(0,t.h)("option",{value:"none"},lang.none),(0,t.h)("option",{value:"hourly"},lang.hourly),(0,t.h)("option",{value:"daily"},lang.daily),(0,t.h)("option",{value:"weekly"},lang.weekly),(0,t.h)("option",{value:"monthly"},lang.monthly))),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"default_group"},lang.default_group,":"),(0,t.h)("select",{name:"default_group",class:"form-control",selectedIndex:e.me.me.groups.map(t=>t.id).indexOf(this.state.data.default_group)},e.me.me.groups.map(e=>(0,t.h)("option",{value:e.id},e.name)))),(0,t.h)("button",{onClick:this.updateSettings,class:"btn btn-primary"},lang.save_changes)),(0,t.h)("form",{id:"destroy_form"},(0,t.h)("label",{for:"destroy_account"},lang.destroy_account_explain),(0,t.h)("button",{onClick:this.destroyAccount,name:"destroy_account",class:"btn btn-danger"},lang.destroy_account))))))),this.state.alert&&(0,t.h)("div",{class:"global-alert alert alert-success"},this.state.alert))}}exports.default=s;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd"}],"TbUJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=r(require("../components/fa-icon.component.js")),i=r(require("./user-settings.component.js")),n=r(require("./group-settings.component.js"));function r(e){return e&&e.__esModule?e:{default:e}}class a extends e.Component{constructor(e){super(e),this.state={},e.key&&t.cache.get(e.key).then(e=>this.setState({entity:e}))}render(){if(this.state.entity&&t.me.me)return(0,e.h)("div",{class:"settings"},(0,e.h)("ul",{class:"nav nav-tabs"},(0,e.h)("li",{class:"nav-item"},(0,e.h)("a",{class:"nav-link"+("user"==this.state.entity.entityType?" active":""),href:"/users/"+t.me.me.id+"/settings",onClick:t.router.onClick},lang.account)),t.me.me.groups.length>0&&(0,e.h)("li",{class:"nav-item dropdown group-list",tabindex:"-1",onBlur:e=>(!e.relatedTarget||!e.relatedTarget.href)&&e.target.classList.remove("active"),onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)("div",{class:"nav-link"+("group"==this.state.entity.entityType?" active":"")},lang.groups),(0,e.h)("div",{class:"dropdown-menu"},t.me.me.groups.map(s=>(0,e.h)("a",{class:"seamless-link",href:"/groups/"+s.id+"/settings",onClick:t.router.onClick},s.name))))),"user"===this.state.entity.entityType&&(0,e.h)(i.default,this.state.entity),"group"===this.state.entity.entityType&&(0,e.h)(n.default,this.state.entity))}}exports.default=a;
},{"preact":"OmAK","/core":"0rqM","../components/fa-icon.component.js":"fWpd","./user-settings.component.js":"e3YL","./group-settings.component.js":"FJIr"}],"kp7P":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserSettings=exports.Settings=exports.GroupSettings=void 0;var e=r(require("./group-settings.component.js")),t=r(require("./settings.component.js")),s=r(require("./user-settings.component.js"));function r(e){return e&&e.__esModule?e:{default:e}}const o=e.default;exports.GroupSettings=o;const n=t.default;exports.Settings=n;const u=s.default;exports.UserSettings=u;
},{"./group-settings.component.js":"FJIr","./settings.component.js":"TbUJ","./user-settings.component.js":"e3YL"}],"PKN3":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core");class r extends e.Component{constructor(){super(),this.postNewGroup=this.postNewGroup.bind(this)}postNewGroup(e){e.preventDefault();const r=document.querySelector("#create_group_form input[name='name']").value;let o={};if(!r)return!1;o.name=r,o.createdAt=Math.floor(Date.now()/1e3),t.http.post("/api/groups",o).then(e=>{t.http.post("/api/groups/invitation/"+e.secretKey,{}).then(e=>{window.location="/groups/"+e.id})})}render(){return(0,e.h)("div",{class:"container mt-1"},(0,e.h)("div",{class:"group-settings"},(0,e.h)("div",{class:"card"},(0,e.h)("div",{class:"card-body"},(0,e.h)("div",{class:"container-fluid p-1"},(0,e.h)("div",{class:"row"},(0,e.h)("div",{class:"col-12 col-md-10"},(0,e.h)("form",{id:"create_group_form",class:"mb-1"},(0,e.h)("div",{class:"form-group"},(0,e.h)("label",{for:"name"},lang.name,": "),(0,e.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:lang.name_input,class:"form-control",required:!0})),(0,e.h)("button",{onClick:this.postNewGroup,class:"btn btn-primary"},lang.create_the_group)))))))))}}exports.default=r;
},{"preact":"OmAK","/core":"0rqM"}],"3JNS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=require("/message");class a extends e.Component{constructor(e){super(e);let t=s.util.getId(s.router.url),a=1+Math.floor(window.screen.width*window.screen.height/68800);this.state={url:s.router.url,groupId:t,loaded:a,messages:[],scrollTop:0,totalMessages:0,pageYOffset:0,page:0},this.scroll_cooldown=Date.now(),this.onScroll=this.onScroll.bind(this),this.loadMessages=this.loadMessages.bind(this),window.addEventListener("resetCache",this.resetGroupDisplay),this.loadMessages(0)}componentDidMount(){window.addEventListener("scroll",this.onScroll),s.me.removeNews(this.state.groupId)}componentWillUnmount(){window.removeEventListener("scroll",this.onScroll)}loadMessages(e){s.cache.get("/api/groups/"+this.state.groupId+"/page/"+e).then(s=>{if(s&&Array.isArray(s.messages)){let t=Math.max(this.state.loaded,30*e),a=this.state.messages;s.messages.map(e=>!a.find(s=>s.id==e.id)&&a.push(e)),this.setState({messages:a,totalMessages:s.totalItems,page:e,loaded:t}),30*e<t&&setTimeout(()=>this.loadMessages(e+1))}})}onScroll(){"none"!=window.getComputedStyle(document.getElementById("group").parentNode).display&&this.scroll_cooldown+100<Date.now()&&(this.scroll_cooldown=Date.now(),this.setState({pageYOffset:window.pageYOffset}),Array.isArray(this.state.messages)&&document.body.scrollHeight-window.screen.height-500<window.pageYOffset&&this.state.loaded<this.state.totalMessages&&(this.setState({loaded:this.state.loaded+10}),this.state.loaded+30>this.state.messages.length&&(this.loadMessages(this.state.page+1),this.setState({page:this.state.page+1}))))}render(){return Array.isArray(this.state.messages)&&(0,e.h)("article",{id:"group",class:"justify-content-center d-flex"},(0,e.h)("div",{class:"message-container container-fluid d-flex justify-content-center flex-wrap"},this.state.messages.slice(0,this.state.loaded).map((a,o)=>(0,e.h)(t.MessagePreview,{tabindex:o+1,key:a.id,message:a,groupId:s.util.getId(s.router.url)}))))}}exports.default=a;
},{"preact":"OmAK","/core":"0rqM","/message":"/82E"}],"Fi1Q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/message"),s=require("/core"),r=a(require("./fa-icon.component.js"));function a(e){return e&&e.__esModule?e:{default:e}}class l extends e.Component{constructor(){super();let e=new URL(window.location);e.searchParams.get("message")?s.http.get("/api/messages/"+e.searchParams.get("message")).then(e=>{this.setState({loaded:!0,group:null,title:e&&e.data.title||"",text:e&&e.data.text||"",url:"",files:e&&e.files||null})}):this.state={loaded:!0,group:null,title:e.searchParams.get("title")||"",text:e.searchParams.get("text")||"",url:e.searchParams.get("url")||"",files:null},s.me.get().then(e=>{1==e.groups.length&&(this.setState({group:e.groups[0].id}),s.router.backUrl=s.router.toApp(e.groups[0]).slice(4))}),this.groupSelect=this.groupSelect.bind(this)}groupSelect(e){this.setState({group:e.target.value}),s.router.backUrl=e.target.value.slice(4)}render(){if(this.state.loaded)return(0,e.h)("article",null,(0,e.h)("div",{class:"container"},s.me.me&&s.me.me.groups.length>1&&(0,e.h)("div",{class:"mb-1"},(0,e.h)("label",{for:"group_share_choice"},lang.group_share_choice),(0,e.h)("select",{selectedIndex:"-1",class:"form-control",name:"group_share_choice",onChange:this.groupSelect,required:!0},s.me.me.groups.map(t=>(0,e.h)("option",{value:"/api/groups/"+t.id},t.name)))),(0,e.h)(t.Writer,{focus:!0,group:this.state.group,title:this.state.title,text:this.state.text||this.state.url?this.state.text+"\n"+this.state.url:"",files:this.state.files})))}}exports.default=l;
},{"preact":"OmAK","/message":"/82E","/core":"0rqM","./fa-icon.component.js":"fWpd"}],"MzKk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core"),t=require("/message"),s=require("/settings"),i=a(require("./create-group.component.js")),n=a(require("./group-board.component.js")),o=a(require("./share.component.js")),l=a(require("./fa-icon.component.js"));function a(e){return e&&e.__esModule?e:{default:e}}class u extends e.Component{render(){if("settings"==this.props.action)return(0,e.h)("article",{class:"justify-content-center d-flex"},(0,e.h)("div",{class:"container"},(0,e.h)(s.Settings,{key:this.props.entityUrl})));switch(this.props.route){case"create-group":return(0,e.h)(i.default,null);case"share":return(0,e.h)(o.default,null);case"messages":return(0,e.h)("article",{class:"justify-content-center d-flex"},(0,e.h)("div",{class:"container pb-1"},(0,e.h)(t.Message,{key:this.props.url,url:this.props.entityUrl})));case"groups":return"write"==this.props.action?(0,e.h)("article",null,(0,e.h)("div",{class:"container"},(0,e.h)(t.Writer,{focus:!0,group:this.props.entityUrl}))):(0,e.h)("div",null,(0,e.h)(n.default,{key:this.props.entityUrl,url:this.props.entityUrl}),(0,e.h)("a",{class:"write-button material-shadow seamless-link",href:this.props.url+"/write",onClick:r.router.onClick},(0,e.h)(l.default,{family:"solid",icon:"pencil-alt"})))}}}exports.default=u;
},{"preact":"OmAK","/core":"0rqM","/message":"/82E","/settings":"kp7P","./create-group.component.js":"PKN3","./group-board.component.js":"3JNS","./share.component.js":"Fi1Q","./fa-icon.component.js":"fWpd"}],"A2T1":[function(require,module,exports) {
"use strict";var e=require("preact"),t=require("/core"),r=require("/outside"),n=i(require("./components/navbar.component.js")),o=i(require("./components/main-content.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}class u extends e.Component{constructor(){super(),this.onRouterStateChange=this.onRouterStateChange.bind(this),window.addEventListener("routerStateChange",this.onRouterStateChange),window.addEventListener("meStateChange",e=>this.setState({me:t.me.me})),window.addEventListener("popstate",t.router.sync),t.cache.get("apiKey").then(e=>{t.router.isOutside()||e?t.router.sync():t.router.navigate("/login")}),this.state={action:t.router.action,route:t.router.route,url:t.router.url,entityUrl:t.router.entityUrl}}onRouterStateChange(){this.setState({action:t.router.action,route:t.router.route,url:t.router.url,entityUrl:t.router.entityUrl}),setTimeout(()=>window.scrollTo(0,0)),t.cache.get("apiKey").then(e=>{e?t.me.get().then(e=>{e||t.router.isOutside()?this.setState({action:t.router.action,route:t.router.route,url:t.router.url,entityUrl:t.router.entityUrl,me:e}):t.cache.set("apiKey","").then(e=>t.router.navigate("/login"))}):t.router.isOutside()||t.router.navigate("/login")})}render(){switch(this.state.route){case"signup":return(0,e.h)(r.Signup,null);case"stop-notification-emails":return(0,e.h)(r.StopNotificationEmails,null);case"public":return(0,e.h)(r.Public,null);case"password-reset":return(0,e.h)(r.ResetPassword,null);case"login":return(0,e.h)(r.Login,null)}if(this.state.me&&this.state.me.groups)return(0,e.h)("main",null,(0,e.h)(n.default,null),(0,e.h)("div",{class:"content"},(0,e.h)(o.default,this.state)))}}(0,e.render)((0,e.h)(u,null),document.body),"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").catch(e=>console.warn(e));
},{"preact":"OmAK","/core":"0rqM","/outside":"Dm2o","./components/navbar.component.js":"BHsO","./components/main-content.component.js":"MzKk","/data/app/src/service-worker.js":[["service-worker.js","AaGI"],"AaGI"]}]},{},["A2T1"], null)