{"version":3,"sources":["../node_modules/idb-keyval/dist/idb-keyval.mjs","core/param.js","core/alert.js","core/storage.js","core/lang.js","core/me.js","core/util.js","core/router.js","core/http.js","core/api.js","core/cache.js","core/index.js","service-workers.js"],"names":["Store","constructor","dbName","storeName","_dbp","Promise","resolve","reject","openreq","indexedDB","open","onerror","error","onsuccess","result","onupgradeneeded","createObjectStore","_withIDBStore","type","callback","then","db","transaction","oncomplete","onabort","objectStore","store","getDefaultStore","get","key","req","set","value","put","del","delete","clear","keys","openKeyCursor","openCursor","call","push","continue","param","ZUSAM_VERSION","CACHE_VERSION","CACHE","CACHE_STORE","alert","remove","id","document","getElementById","outerHTML","add","text","alertStyle","countdown","alertNode","createElement","hash","innerHTML","classList","body","appendChild","setTimeout","str","length","i","charCodeAt","storage","usage","total","k","localStorage","Object","prototype","hasOwnProperty","createStorageBox","data","metadata","createdAt","Date","now","removeItem","setItem","JSON","stringify","getItem","parse","r","reset","window","dispatchEvent","CustomEvent","lang","dict","possibleLang","en","es","fr","sk","getDefaultLang","querySelector","content","getCurrentLang","me","fetchDict","http","t","params","count","getOwnPropertyNames","map","e","filter","isNaN","sort","a","b","slice","assign","match","forEach","s","rid","replace","update","notifications","loadNotifications","matchNotification","notif","target","isNew","Array","isArray","some","n","fromMessage","removeMatchingNotifications","all","hasBookmark","bookmarks","bid","addBookmark","post","user","removeBookmark","util","genId","seed","toString","Math","random","id2Int","parseInt","urlRegExp","getUrl","txt","url","startsWith","link","endsWith","limitStrSize","limit","humanFullDate","timestamp","d","getTime","getTimezoneOffset","toISOString","humanTime","duration","abs","round","floor","split","getGroupId","groups","router","entity","entityType","getId","group","getGroupName","find","g","pop","console","thumbnail","width","height","toApp","crop","defaultAvatar","reduce","c","colorHash","backgroundHash","c1","c2","reverse","join","logout","location","href","origin","route","action","backUrl","backUrlPrompt","entityUrl","search","isValidUrl","URL","_","getSubpath","baseURI","pathname","removeSubpath","path","RegExp","getParam","searchParams","substring","res","decodeURIComponent","getSegments","isOutside","includes","isEntity","name","getUrlComponents","components","navigate","options","warn","catch","history","replaceState","pushState","apiKey","sync","onClick","newTab","preventDefault","stopPropagation","closest","getAttribute","targetUrl","host","ctrlKey","getElementsByClassName","sendFile","formData","loadFn","progressFn","errorFn","xhr","XMLHttpRequest","setRequestHeader","addEventListener","status","response","statusText","upload","onprogress","loaded","send","nocache","h","fetch","method","headers","Headers","ok","json","err","contentType","request","fetchOptions","exception","message","api","info","cache","cache_store","purgeOldCache","lastUsed","log","caches","removeMatching","openCache","matchAll","_param","_api","_alert","_cache","_storage","_http","_me","_router","_util","_lang","cached_routes","addToCache","fromNetwork","toCache","responseClone","clone","fromCache","matching","self","evt","respondWith","waitUntil","protoype"],"mappings":"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","file":"service-workers.js","sourceRoot":"../src","sourcesContent":["class Store {\r\n    constructor(dbName = 'keyval-store', storeName = 'keyval') {\r\n        this.storeName = storeName;\r\n        this._dbp = new Promise((resolve, reject) => {\r\n            const openreq = indexedDB.open(dbName, 1);\r\n            openreq.onerror = () => reject(openreq.error);\r\n            openreq.onsuccess = () => resolve(openreq.result);\r\n            // First time setup: create an empty object store\r\n            openreq.onupgradeneeded = () => {\r\n                openreq.result.createObjectStore(storeName);\r\n            };\r\n        });\r\n    }\r\n    _withIDBStore(type, callback) {\r\n        return this._dbp.then(db => new Promise((resolve, reject) => {\r\n            const transaction = db.transaction(this.storeName, type);\r\n            transaction.oncomplete = () => resolve();\r\n            transaction.onabort = transaction.onerror = () => reject(transaction.error);\r\n            callback(transaction.objectStore(this.storeName));\r\n        }));\r\n    }\r\n}\r\nlet store;\r\nfunction getDefaultStore() {\r\n    if (!store)\r\n        store = new Store();\r\n    return store;\r\n}\r\nfunction get(key, store = getDefaultStore()) {\r\n    let req;\r\n    return store._withIDBStore('readonly', store => {\r\n        req = store.get(key);\r\n    }).then(() => req.result);\r\n}\r\nfunction set(key, value, store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.put(value, key);\r\n    });\r\n}\r\nfunction del(key, store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.delete(key);\r\n    });\r\n}\r\nfunction clear(store = getDefaultStore()) {\r\n    return store._withIDBStore('readwrite', store => {\r\n        store.clear();\r\n    });\r\n}\r\nfunction keys(store = getDefaultStore()) {\r\n    const keys = [];\r\n    return store._withIDBStore('readonly', store => {\r\n        // This would be store.getAllKeys(), but it isn't supported by Edge or Safari.\r\n        // And openKeyCursor isn't supported by Safari.\r\n        (store.openKeyCursor || store.openCursor).call(store).onsuccess = function () {\r\n            if (!this.result)\r\n                return;\r\n            keys.push(this.result.key);\r\n            this.result.continue();\r\n        };\r\n    }).then(() => keys);\r\n}\n\nexport { Store, get, set, del, clear, keys };\n","const ZUSAM_VERSION = \"4.1\";\nconst CACHE_VERSION = \"0.3\";\n\nconst param = {\n  ZUSAM_VERSION,\n  CACHE_VERSION,\n  CACHE: `zusam-${  ZUSAM_VERSION  }-simplecache-${  CACHE_VERSION}`,\n  CACHE_STORE: `zusam-${  ZUSAM_VERSION}`\n};\n\nexport default param;\n","const alert = {\n  remove: id => (document.getElementById(id).outerHTML = \"\"),\n  add: (text, alertStyle = \"alert-success\", countdown = 5000) => {\n    if (!text) {\n      return;\n    }\n    let alertNode = document.createElement(\"DIV\");\n    alertNode.id = alert.hash(text);\n    alertNode.innerHTML = text;\n    alertNode.classList.add(\"global-alert\", \"alert\", alertStyle);\n    document.body.appendChild(alertNode);\n    setTimeout(() => alert.remove(alertNode.id), countdown);\n  },\n  hash: str => {\n    let hash = 0;\n    if (str.length == 0) {\n      return hash;\n    }\n    for (let i = 0; i < str.length; i++) {\n      let char = str.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash; // Convert to 32bit integer\n    }\n    return hash;\n  }\n};\nexport default alert;\n","const storage = {\n  usage: () => {\n    let total = 0;\n    let k;\n    for (k in localStorage) {\n      if (Object.prototype.hasOwnProperty.call(localStorage, k)) {\n        total += (localStorage[k].length + k.length) * 2;\n      }\n    }\n    return total;\n  },\n  createStorageBox: (data, metadata = null) => ({\n    data,\n    createdAt: Date.now(),\n    metadata\n  }),\n  remove: id => localStorage.removeItem(id),\n  set: (id, data, metadata = null) => {\n    localStorage.setItem(\n      id,\n      JSON.stringify(storage.createStorageBox(data, metadata))\n    );\n    return Promise.resolve(id);\n  },\n  get: id => {\n    let data = localStorage.getItem(id);\n    if (data != null) {\n      data = JSON.parse(data);\n      if (Object.prototype.hasOwnProperty.call(data, \"data\")) {\n        return new Promise(r => r(data.data));\n      }\n    }\n    return new Promise(r => r(null));\n  },\n  reset: () =>\n    localStorage.clear() &&\n    window.dispatchEvent(new CustomEvent(\"resetStorage\"))\n};\nexport default storage;\n","import me from \"./me.js\";\nimport http from \"./http.js\";\n\nconst lang = {\n  dict: [], // dicts loaded for the current session\n  possibleLang: {\n    en: \"English\",\n    es: \"Español\",\n    fr: \"Français\",\n    sk: \"Slovenský\"\n  }, // possible dicts names to load\n  getDefaultLang: () =>\n    (document.querySelector(\"meta[name='zusam:default-lang']\") || {}).content ||\n    \"en\",\n  getCurrentLang: () =>\n    me.me && me.me[\"data\"]\n      ? me.me.data[\"lang\"] || lang.getDefaultLang()\n      : lang.getDefaultLang(),\n  fetchDict: (dict = lang.getCurrentLang()) =>\n    !lang.dict[dict] &&\n    http.get(`/lang/${  dict  }.json`).then(r => {\n      lang.dict[dict] = r;\n      window.dispatchEvent(new CustomEvent(\"fetchedNewDict\"));\n    }),\n  t: (id, params = {}) => {\n    // prepare default values\n    params.dict = params[\"dict\"] || lang.getCurrentLang();\n    params.count = params[\"count\"] || 0;\n\n    // quick validity checks\n    if (!id || !lang.dict[params.dict]) {\n      return \"\";\n    }\n\n    // select translation string corresponding to count\n    // We treat the list of translation keys like ranges\n    // So if we have the keys 0, 1, 5; we have the ranges [0], [1, 4], [5, +inf]\n    let str = lang.dict[params.dict][id] || \"\";\n    if (typeof str == \"object\") {\n      let keys = Object.getOwnPropertyNames(str)\n        .map(e => +e)\n        .filter(e => !isNaN(e) && e <= params.count)\n        .sort((a, b) => a - b);\n      str = keys.length ? str[keys.slice(-1)[0]] : \"\";\n    }\n\n    // replace parameters\n    Object.assign([], str.match(/{{\\w+}}/g)).forEach(s => {\n      let rid = s.replace(/[{}]/g, \"\");\n      if (params[rid]) {\n        str = str.replace(s, params[rid]);\n      }\n    });\n\n    return str;\n  }\n};\nexport default lang;\n","import http from \"./http.js\";\nimport lang from \"./lang.js\";\n\nconst me = {\n  me: {},\n  get: () => (me.me.id ? Promise.resolve(me.me) : me.update()),\n  update: () =>\n    http.get(\"/api/me\", true).then(r => {\n      if (!r) {\n        return;\n      }\n      me.me = Object.assign({ notifications: [] }, r);\n      me.loadNotifications();\n      lang.fetchDict();\n      setTimeout(dispatchEvent(new CustomEvent(\"meStateChange\")));\n      return r;\n    }),\n  loadNotifications: () =>\n    http.get(`/api/users/${me.me.id}/notifications`).then(r => {\n      me.me.notifications = r;\n      setTimeout(dispatchEvent(new CustomEvent(\"meStateChange\")));\n    }),\n  matchNotification: (notif, id) => {\n    if (notif.id === id) {\n      return true;\n    }\n    if (notif.target === id) {\n      return true;\n    }\n    return false;\n  },\n  isNew: id =>\n    Array.isArray(me.me.notifications)\n      ? me.me.notifications.some(\n          n =>\n            me.matchNotification(n, id) ||\n            (n.type == \"new_comment\" && n.fromMessage.id === id)\n        )\n      : false,\n  removeMatchingNotifications: id => {\n    return me.loadNotifications().then(() => {\n      if (!Array.isArray(me.me.notifications)) {\n        return Promise.reject(\"Failed to get notifications from server\");\n      }\n      return Promise.all(\n        me.me.notifications\n          .filter(n => me.matchNotification(n, id))\n          .map(n =>\n            http.delete(`/api/notifications/${n.id}`).then(() => {\n              me.me.notifications = me.me.notifications.filter(\n                e => !me.matchNotification(e, id)\n              );\n              setTimeout(dispatchEvent(new CustomEvent(\"meStateChange\")));\n            })\n          )\n      );\n    });\n  },\n  hasBookmark: id => {\n    return Array.isArray(me.me?.data?.bookmarks) ? me.me.data.bookmarks.some(bid => bid === id) : false;\n  },\n  addBookmark: id => {\n    if (!me.hasBookmark(id)) {\n      http.post(`/api/bookmarks/${id}`).then(user => {\n        me.me = Object.assign(me.me, user);\n        setTimeout(dispatchEvent(new CustomEvent(\"meStateChange\")));\n      });\n    }\n  },\n  removeBookmark: id => {\n    if (me.hasBookmark(id)) {\n      http.delete(`/api/bookmarks/${id}`).then(user => {\n        me.me = Object.assign(me.me, user);\n        setTimeout(dispatchEvent(new CustomEvent(\"meStateChange\")));\n      });\n    }\n  },\n};\nexport default me;\n","import lang from \"./lang.js\";\nimport router from \"./router.js\";\nimport me from \"./me.js\";\nimport storage from \"./storage.js\";\n\nconst util = {\n  // genId starts with a letter to be DOM friendly\n  // seed can be used to order ids\n  genId: seed => `z${seed || \"\"}-${Date.now().toString().slice(-5)}${Math.random().toString().slice(-5)}`,\n  // transform an id into int for the API (TODO: revisit this on 0.5)\n  id2Int: id => parseInt(id.replace(/[^\\d]/g,''), 10),\n  urlRegExp: /(\\([^()]*)?https?:\\/\\/[^[\\]\\n\\r ]*[-A-Za-z0-9+&@#/%=~_()|]/i,\n  getUrl: txt => {\n    if (!txt) {\n      return \"\";\n    }\n    let url = txt.match(util.urlRegExp);\n    if (url && url[0].startsWith(\"(\")) {\n      let link = url[0].match(/https?:\\/\\//i);\n      url[\"index\"] += link[\"index\"];\n      url[0] = url[0].slice(link[\"index\"]);\n      if (url[0].endsWith(\")\")) {\n        url[0] = url[0].slice(0, -1);\n      }\n    }\n    return url;\n  },\n  limitStrSize: (str, limit) => str.length > limit ? `${str.slice(0, limit-3)}...` : str,\n  // full datetime as a string adapted to the users timezone\n  humanFullDate: timestamp => {\n    let d = new Date(timestamp * 1000);\n    d = new Date(d.getTime() + d.getTimezoneOffset() * 60000 * -1);\n    return d.toISOString().replace(\"T\", \" \").replace(/\\..*$/, \"\");\n  },\n  // duration relative to event\n  humanTime: timestamp => {\n    if (!timestamp) {\n      return null;\n    }\n    const duration = Math.abs(Math.round((Date.now() / 1000 - timestamp) / 60));\n    if (duration < 1) {\n      return lang.t(\"just_now\");\n    }\n    if (duration < 60) {\n      return lang.t(\"ago\", { duration: `${duration  }mn` });\n    }\n    if (duration < 60 * 24) {\n      return lang.t(\"ago\", { duration: `${Math.floor(duration / 60)  }h` });\n    }\n    return util.humanFullDate(timestamp).split(\" \")[0];\n  },\n  getGroupId: () => {\n    if (me.me.groups) {\n      switch (router.entity.entityType) {\n        case \"group\":\n          return util.getId(router.entity);\n        case \"message\":\n          return util.getId(router.entity.group);\n      }\n    }\n    return \"\";\n  },\n  getGroupName: () => {\n    let group = me.me.groups.find(g => g[\"id\"] == util.getGroupId());\n    return group ? group[\"name\"] : \"\";\n  },\n  // get the id of an object from an url\n  getId: e => {\n    switch (typeof e) {\n      case \"object\":\n        return e ? e.id : null;\n      case \"string\":\n        return e\n          .split(\"/\")\n          .pop()\n          .replace(/\\?.*$/, \"\")\n          .replace(/\\.\\w+$/, \"\");\n      default:\n        console.error(e);\n        throw \"Could not extract id !\";\n    }\n  },\n  // get the url to a thubmnail\n  thumbnail: (id, width, height) =>\n    typeof(id) == \"string\" && !id.startsWith(\"z\")\n      ? router.toApp(`/api/images/thumbnail/${width}/${height}/${id}`)\n      : null,\n  // same as http.thumbnail but for a crop\n  crop: (id, width, height) =>\n    typeof(id) == \"string\" && !id.startsWith(\"z\")\n      ? router.toApp(`/api/images/crop/${width}/${height}/${id}`)\n      : null,\n  // default avatar in base64\n  defaultAvatar:\n    \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAD///+l2Z/dAAAAAnRSTlMA/iyWEiMAAAMJSURBVHja7ZtBjpwwEEWxmIhFFmiURZZEyi6HCLkZHCXr2eQKHIUjoEiRSGRRiWB6klaDU/hDF4z+W6LuNz3+ZRvbkCSEEEIIIYQQQgghhBBCCCGEEEIIITvwGfy+kxoTpNJigkw6TJBLjwkK8ZiglMFYUInAAqwQRKRBBR0q8FhXEKwVR0GLCvxCjeo6oyzkoIxnEvj5661acPO3yvFqpxdcV+Pj88VeNZ7cGB4ul1QFkv399KT4KBIpmGEwF4i9oL6DIN/3FzToL2ju8AvsBeE2aNFfQMFJBCkF0/R+bkHyCgSVuaDcVaC5zyvMBTkqyHYVaBZDKSpw5oJgLcMC5doXFBSoIMNutjcQBHJULmlhQYUKlmNQbs9kqGC5P2o3FqBBOVjMWkEOdcZQKam3dyqkkgP/g35zxmEpLhbjir0ZFz2tXHgbPR5deI+EMPKmig/hhU/fIkOYL4iYDbIyqpCXajp2Zy4yhNuxqUfbMCaEIraQZ9swJgQBQ0jBQr6eYXrzQrYIYdtC9uaFbDKayJajyTkL+VijyWA+mnBajGpDeFrMzAu5BNvwKoQBDaFHQ+jQEBo0hBoMYUBD8GgIHRpCi44mcAiJRQhoITvzQs63LGQxL2SOJnEhiHUI296bwNOixb1JYr5kz8yX7Odf6XDfBC9kd6yVzq+np69QIY/8AEJ45kt0T4hIM0VONm5CiLlVhLflS+CwdTGEVa2AnfOFTogaVAAfcg1QivpqzLFHD4LnrR0q8FAhqlux3PPUu0EFLSrooL6kLeaQwKMCTY4OfUjVoY+IOvTxSFiw81NtnbmgRwXeXDAg08IxBPIKBPX5BQ0FBxC0+wtSCg4gcBT853nruwiqfQXNHQT/LDiGD9Old6sEL2umn3MtqxDks9NotVbwfaG+FDfL6fznsjV32365cTXrtqoPdJKYrbmreIDvT42DCMYoIUEu4FvIKSpwgr6JvYEAfJm8QgUl+j58gb6Rn4Nvcv/p0jUmcODr8IQQQgghhBBCCCGEEEIIIYQQQgghs/wGp6uYgtiKODIAAAAASUVORK5CYII=\",\n  hash: str =>\n    str.split(\"\").reduce((a, c) => ((a << 5) - a + c.charCodeAt()) | 0),\n  colorHash: str =>\n    [\n      \"#000000\",\n      \"#333366\",\n      \"#333399\",\n      \"#3333CC\",\n      \"#339933\",\n      \"#339999\",\n      \"#33CC33\",\n      \"#33CC99\",\n      \"#663333\",\n      \"#663366\",\n      \"#666633\",\n      \"#666699\",\n      \"#66CC33\",\n      \"#66CCCC\",\n      \"#993333\",\n      \"#993366\",\n      \"#993399\",\n      \"#996633\",\n      \"#999966\",\n      \"#CC3333\",\n      \"#CC3366\",\n      \"#CC3399\",\n      \"#CC33CC\",\n      \"#CC6633\",\n      \"#CC9933\",\n      \"#CC99CC\",\n      \"#CCCC33\"\n    ][Math.abs(util.hash(str)) % 27],\n  backgroundHash: str => {\n    if (!str) {\n      return \"background-color: #aaa;\";\n    }\n    let c1 = util.colorHash(str);\n    let c2 = util.colorHash(\n      str\n        .split(\"\")\n        .reverse()\n        .join(\".\")\n    );\n    let deg = 45 * (Math.abs(util.hash(str)) % 4);\n    return (\n      `background-color:${c1};background-image:linear-gradient(${deg}deg, ${c2} 15%, transparent 15% 30%, ${c2} 30% 45%, transparent 45% 60%, ${c2} 60% 75%, transparent 75% 90%, ${c2} 90%);`\n    );\n  },\n  logout: () => {\n    storage.reset();\n    window.location.href = window.location.origin;\n  }\n};\nexport default util;\n","import http from \"./http.js\";\nimport me from \"./me.js\";\nimport util from \"./util.js\";\nimport lang from \"./lang.js\";\nimport storage from \"./storage.js\";\n\nconst router = {\n  route: \"\",\n  id: \"\",\n  action: \"\",\n  backUrl: \"\",\n  backUrlPrompt: \"\",\n  entityUrl: \"\",\n  entityType: \"\",\n  search: \"\",\n  entity: {},\n  isValidUrl: url => {\n    try {\n      new URL(url);\n      return true;\n    } catch (_) {\n      return false;\n    }\n  },\n  getSubpath: () => new URL(document.baseURI).pathname.replace(/\\/$/, \"\"),\n  toApp: url => {\n    if (!url || typeof url != \"string\") {\n      return \"\";\n    }\n    if (router.isValidUrl(url)) {\n      return url;\n    }\n    return location.origin + router.getSubpath() + url;\n  },\n  removeSubpath: path =>\n    path ? path.replace(new RegExp(`^${  router.getSubpath()}`), \"\") : \"\",\n  getParam: (param, searchParams = window.location.search.substring(1)) => {\n    let res = searchParams.split(\"&\").find(e => e.split(\"=\")[0] === param);\n    return res ? decodeURIComponent(res.split(\"=\")[1]) : \"\";\n  },\n  getSegments: () =>\n    window.location.pathname\n      .slice(1)\n      .split(\"?\")[0]\n      .split(\"/\"),\n  // check if route is \"outside\": accessible to non connected user\n  isOutside: () =>\n    [\n      \"login\",\n      \"password-reset\",\n      \"signup\",\n      \"invitation\",\n      \"stop-notification-emails\",\n      \"public\"\n    ].includes(router.route || router.getSegments()[0]),\n  isEntity: name =>\n    [\"messages\", \"groups\", \"users\", \"links\", \"files\"].includes(name),\n  getUrlComponents: url => {\n    let components = {};\n    if (url) {\n      components.url = new URL(url);\n      components.path = components.url.pathname;\n      components.search = components.url.search.slice(1);\n      [components.route, components.id, components.action] = router\n        .removeSubpath(components.path)\n        .slice(1)\n        .split(\"/\");\n    }\n    components.entityUrl = \"\";\n    components.entityType = \"\";\n    components.backUrl = \"\";\n    components.backUrlPrompt = \"\";\n    return components;\n  },\n  navigate: async (url = \"/\", options = {}) => {\n    if (!url.match(/^http/) && !options[\"raw_url\"]) {\n      url = router.toApp(url);\n    }\n    let components = router.getUrlComponents(url);\n    // do not allow to renavigate to the same url. This is done to avoid accidental navigate locks\n    if (router.url && router.url.href == components.url.href) {\n      console.warn(\"navigate lock !\");\n      return;\n    }\n    Object.assign(router, components);\n\n    // set url, backUrl and entityUrl\n    if (router.id && router.isEntity(router?.route)) {\n      router.entityUrl = `/api/${router.route}/${router.id}`;\n      router.entityType = router.route;\n\n      await http\n        .get(router.entityUrl)\n        .then(res => {\n          if (!res) {\n            console.warn(\"Unknown entity\");\n            // TODO: what should we do here ?\n            //router.navigate(); // could go into navigate loop if disconnected\n            return;\n          }\n          router.entity = res;\n          switch (router.route) {\n            case \"groups\":\n              if (router.action == \"write\") {\n                router.backUrl = `/${router.route}/${router.id}`;\n                router.backUrlPrompt = lang.t(\"cancel_write\");\n              }\n              if (router.search) {\n                router.backUrl = `/${router.route}/${router.id}`;\n              }\n              break;\n            case \"messages\":\n              if (res[\"parent\"] && !res[\"isInFront\"]) {\n                router.backUrl = `/messages/${res[\"parent\"].id}`;\n              } else {\n                router.backUrl = `/groups/${util.getId(res.group)}`;\n              }\n              break;\n            case \"users\":\n              router.backUrl = \"/\";\n              break;\n            default:\n              if (router.action) {\n                router.backUrl = \"/\";\n              }\n          }\n        })\n        .catch(e => console.warn(e));\n    } else {\n      router.entity = null;\n    }\n\n    switch (router.route) {\n      case \"login\":\n        storage.reset();\n      case \"bookmarks\":\n      case \"create-group\":\n      case \"groups\":\n      case \"messages\":\n      case \"password-reset\":\n      case \"public\":\n      case \"share\":\n      case \"signup\":\n      case \"stop-notification-emails\":\n      case \"users\":\n        if (options.replace) {\n          history.replaceState(null, \"\", url);\n        } else {\n          history.pushState(null, \"\", url);\n        }\n        window.dispatchEvent(new CustomEvent(\"routerStateChange\"));\n        break;\n      case \"logout\":\n        util.logout();\n        break;\n      case \"invitation\":\n        storage.get(\"apiKey\").then(apiKey => {\n          if (apiKey) {\n            http.post(`/api/groups/invitation/${  router.id}`, {}).then(() => {\n              window.location.href = window.location.origin;\n            });\n          } else {\n            router.navigate(`/signup?inviteKey=${  router.id}`);\n          }\n        });\n        break;\n      default:\n        me.get().then(user => {\n          if (!user) {\n            router.navigate(\"/login\");\n            return;\n          }\n          if (user.data[\"default_group\"]) {\n            router.navigate(`/groups/${  user.data[\"default_group\"]}`);\n          } else if (user.groups[0]) {\n              router.navigate(`/groups/${  user.groups[0].id}`);\n            } else {\n              window.location = \"/create-group\";\n            }\n        });\n    }\n  },\n  sync: () => {\n    router.navigate(location.pathname + location.search + location.hash, {\n      replace: true\n    });\n  },\n  onClick: (e, newTab = false, url = null) => {\n    // stop propagation\n    e.preventDefault();\n    e.stopPropagation();\n\n    // if url is not given, try to guess it\n    if (!url) {\n      const t = e.target.closest(\"a\");\n      if (t) {\n        if (t.target == \"_blank\") {\n          newTab = true;\n        }\n        url = t.getAttribute(\"href\");\n      }\n    }\n\n    if (!url) {\n      return;\n    }\n\n    // check if it's an external url\n    if (url.startsWith(\"http\")) {\n      let targetUrl = new URL(url);\n      if (targetUrl.host != location.host) {\n        if (e.ctrlKey || newTab) {\n          open(url, \"_blank\");\n        } else {\n          location.href = url;\n        }\n        return;\n      }\n    }\n\n    // disable active stances (dropdowns...)\n    for (let e of document.getElementsByClassName(\"active\")) {\n      e.classList.remove(\"active\");\n    }\n\n    // go to target url\n    if (e.ctrlKey || newTab) {\n      open(url, \"_blank\");\n    } else {\n      router.navigate(url);\n    }\n  }\n};\nexport default router;\n","import alert from \"./alert.js\";\nimport storage from \"./storage.js\";\nimport router from \"./router.js\";\n\nconst http = {\n  sendFile: (formData, loadFn, progressFn = null, errorFn = null) => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        let xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", `${document.baseURI}api/files`, true);\n        xhr.setRequestHeader(\"X-AUTH-TOKEN\", apiKey);\n        xhr.addEventListener(\"load\", e => {\n          if (e.target.status > 199 && e.target.status < 300) {\n            loadFn(JSON.parse(e.target.response));\n          } else if (errorFn) {\n              errorFn(e.target.statusText);\n            } else {\n              console.error(e.target.statusText);\n            }\n        });\n        if (progressFn) {\n          xhr.upload.onprogress = e =>\n            progressFn({ loaded: e.loaded, total: e.total });\n        }\n        if (errorFn) {\n          xhr.addEventListener(\"error\", e => errorFn(e));\n        }\n        xhr.send(formData);\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  },\n  get: (url, nocache = false) => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        url = router.toApp(url);\n        if (!url) {\n          return;\n        }\n        let h = {};\n        if (apiKey) {\n          h[\"X-AUTH-TOKEN\"] = apiKey;\n        }\n        if (nocache) {\n          h[\"X-NOCACHE\"] = \"nocache\";\n        }\n        return fetch(url, {\n          method: \"GET\",\n          headers: new Headers(h)\n        })\n          .then(res => res.ok && res.json())\n          .catch(err => console.warn(`ERROR for ${url}`, err));\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  },\n  post: (url, data, contentType = \"application/json\") =>\n    http.request(url, data, \"POST\", contentType),\n  put: (url, data, contentType = \"application/json\") =>\n    http.request(url, data, \"PUT\", contentType),\n  delete: (url, data, contentType = \"application/json\") =>\n    http.request(url, null, \"DELETE\", contentType),\n  request: (url, data, method, contentType = \"application/json\") => {\n    return storage\n      .get(\"apiKey\")\n      .then(apiKey => {\n        url = router.toApp(url);\n        if (!url) {\n          return;\n        }\n        let h = {};\n        if (apiKey) {\n          h[\"X-AUTH-TOKEN\"] = apiKey;\n        }\n        if (contentType) {\n          h[\"Content-type\"] = contentType;\n        }\n        let fetchOptions = {\n          method,\n          headers: new Headers(h)\n        };\n        if (data) {\n          fetchOptions.body =\n            typeof data == \"object\" && data.constructor.name == \"Object\"\n              ? JSON.stringify(data)\n              : data;\n        }\n        return fetch(url, fetchOptions)\n          .then(res => {\n            try {\n              return res.json();\n            } catch (exception) {\n              console.warn(exception.message);\n              return Promise.reject(exception.message);\n            }\n          })\n          .catch(err => console.warn(`ERROR for ${  url}`, err));\n      })\n      .catch(error => alert.add(error, \"alert-danger\"));\n  }\n};\nexport default http;\n","import http from \"./http.js\";\n\nconst api = {\n  info: {},\n  update: () =>\n    http.get(\"/api/info\", true).then(r => {\n      if (!r) {\n        return;\n      }\n      api.info = Object.assign({}, r);\n      setTimeout(dispatchEvent(new CustomEvent(\"apiStateChange\")));\n      return r;\n    }),\n};\nexport default api;\n","import { Store, get, keys, del } from \"idb-keyval\";\nimport param from \"./param.js\";\n\nconst cache = {\n  name: param.CACHE,\n  cache_store: new Store(param.CACHE_STORE, param.CACHE),\n  purgeOldCache: () => {\n    keys().then(keys =>\n      keys.map(k =>\n        get(k).then(e => {\n          // purge if older than 30 days\n          if (e.lastUsed + 1000 * 60 * 60 * 24 * 30 < Date.now()) {\n            console.log(`Remove from cache: ${k.url}`);\n            del(k);\n            caches.open(cache.name).then(c => c.delete(k));\n          }\n        })\n      )\n    );\n  },\n  removeMatching: str => caches.open(cache.name).then(openCache => openCache.matchAll().then(a =>\n      Promise.all(a.filter(e => e.url.match(str)).map(e => openCache.delete(e)))\n    )\n  )\n};\n\nexport default cache;\n","import _param from \"./param.js\";\nimport _api from \"./api.js\";\nimport _alert from \"./alert.js\";\nimport _cache from \"./cache.js\";\nimport _storage from \"./storage.js\";\nimport _http from \"./http.js\";\nimport _me from \"./me.js\";\nimport _router from \"./router.js\";\nimport _util from \"./util.js\";\nimport _lang from \"./lang.js\";\n\nexport const param = _param;\nexport const api = _api;\nexport const alert = _alert;\nexport const cache = _cache;\nexport const storage = _storage;\nexport const http = _http;\nexport const me = _me;\nexport const router = _router;\nexport const util = _util;\nexport const lang = _lang;\n","import { Store, set, get } from \"idb-keyval\";\nimport param from \"/core\";\n\nconst cache_store = new Store(param.CACHE_STORE, param.CACHE);\nconst cached_routes = [\n  {\n    route: new RegExp(\"/api/users/[^/]+/?$\"),\n    duration: 1000 * 60 * 60 * 24, // 24h\n  },\n  {\n    route: new RegExp(\"/api/images/crop/\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  },\n  {\n    route: new RegExp(\"/api/images/thumbnail/\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  },\n  {\n    route: new RegExp(\"/api/links/by_url\\?\"),\n    duration: 1000 * 60 * 60 * 24 * 365, // 1 year\n  }\n];\n\n// On fetch, use cache but update the entry with the latest contents\n// from the server.\nself.addEventListener(\"fetch\", (evt) => {\n  if (evt.request.method == \"GET\") {\n    // cache-update routes: retrieve from cache and update in background\n    if (cached_routes.some(r => evt.request.url.match(r.route))) {\n      // You can use `respondWith()` to answer immediately, without waiting for the\n      // network response to reach the service worker...\n      evt.respondWith(fromCache(evt.request));\n\n      // ...and `waitUntil()` to prevent the worker from being killed until the function is finished.\n      evt.waitUntil(() => {\n        get(evt.request.url, cache_store)\n          .then(r => {\n            if (r && Object.protoype.hasOwnProperty.call(r, \"lastUsed\") && r.lastUsed != null) {\n              const timeout = r.lastUsed + cached_routes.find(r => evt.request.url.match(r.route))[\"duration\"];\n              // update the cache only if the timeout is reached\n              if (timeout < Date.now()) {\n                update(evt.request);\n              }\n            }\n          })\n          .catch(() => update(evt.request));\n      });\n    }\n  }\n});\n\n// Add response to cache and store the lastUsed timestamp at the same time\nfunction addToCache(cache, request, response) {\n  return set(\n    request.url,\n    {\n      lastUsed: Date.now()\n    },\n    cache_store\n  ).then(() => cache.put(request, response));\n}\n\n// Make a network request, return the result and add it to cache if asked\nfunction fromNetwork(request, toCache) {\n  return fetch(request).then(response => {\n    if (toCache) {\n      // response may be used only once\n      // we need to save clone to put one copy in cache\n      // and serve second one\n      let responseClone = response.clone();\n      caches.open(param.CACHE).then(cache => addToCache(cache, request, responseClone));\n    }\n    return response;\n  });\n}\n\n// Open the cache where the assets were stored and search for the requested\n// resource. Notice that in case of no matching, the promise still resolves\n// but it does with `undefined` as value.\nfunction fromCache(request) {\n  return caches.open(param.CACHE).then(cache => {\n    return cache.match(request).then(matching => {\n      if (matching) {\n        // reset lastUsed\n        return set(\n          request.url,\n          {\n            lastUsed: Date.now()\n          },\n          cache_store\n        ).then(() => matching);\n      }\n        // if nothing matches, return response from network\n        return fromNetwork(request, true);\n    });\n  });\n}\n\n// Update consists in opening the cache, performing a network request and\n// storing the new response data.\nfunction update(request) {\n  return caches.open(param.CACHE).then(cache => {\n    return fetch(request).then(response => {\n      return addToCache(cache, request, response);\n    });\n  });\n}\n"]}