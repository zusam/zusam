parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"aSor":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.render=M,exports.hydrate=F,exports.h=exports.createElement=f,exports.Fragment=h,exports.createRef=d,exports.Component=v,exports.cloneElement=R,exports.createContext=V,exports.toChildArray=b,exports.__u=W,exports.options=exports.isValidElement=void 0;var e,t,n,o,l,_,r,u={},i=[],s=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function c(e,t){for(var n in t)e[n]=t[n];return e}function p(e){var t=e.parentNode;t&&t.removeChild(e)}function f(e,t,n){var o,l=arguments,_={};for(o in t)"key"!==o&&"ref"!==o&&(_[o]=t[o]);if(arguments.length>3)for(n=[n],o=3;o<arguments.length;o++)n.push(l[o]);if(null!=n&&(_.children=n),"function"==typeof e&&null!=e.defaultProps)for(o in e.defaultProps)void 0===_[o]&&(_[o]=e.defaultProps[o]);return a(e,_,t&&t.key,t&&t.ref,null)}function a(t,n,o,l,_){var r={type:t,props:n,key:o,ref:l,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:_};return null==_&&(r.__v=r),e.vnode&&e.vnode(r),r}function d(){return{current:null}}function h(e){return e.children}function v(e,t){this.props=e,this.context=t}function y(e,t){if(null==t)return e.__?y(e.__,e.__.__k.indexOf(e)+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?y(e):null}function m(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return m(e)}}function g(t){(!t.__d&&(t.__d=!0)&&n.push(t)&&!k.__r++||l!==e.debounceRendering)&&((l=e.debounceRendering)||o)(k)}function k(){for(var e;k.__r=n.length;)e=n.sort(function(e,t){return e.__v.__b-t.__v.__b}),n=[],e.some(function(e){var t,n,o,l,_,r,u;e.__d&&(r=(_=(t=e).__v).__e,(u=t.__P)&&(n=[],(o=c({},_)).__v=o,l=U(u,_,o,t.__n,void 0!==u.ownerSVGElement,null,n,null==r?y(_):r),A(n,_),l!=r&&m(_)))})}function x(e,t,n,o,l,_,r,s,c,f){var d,v,m,g,k,x,b,w=o&&o.__k||i,S=w.length;for(c==u&&(c=null!=r?r[0]:S?y(o,0):null),n.__k=[],d=0;d<t.length;d++)if(null!=(g=n.__k[d]=null==(g=t[d])||"boolean"==typeof g?null:"string"==typeof g||"number"==typeof g?a(null,g,null,null,g):Array.isArray(g)?a(h,{children:g},null,null,null):null!=g.__e||null!=g.__c?a(g.type,g.props,g.key,null,g.__v):g)){if(g.__=n,g.__b=n.__b+1,null===(m=w[d])||m&&g.key==m.key&&g.type===m.type)w[d]=void 0;else for(v=0;v<S;v++){if((m=w[v])&&g.key==m.key&&g.type===m.type){w[v]=void 0;break}m=null}k=U(e,g,m=m||u,l,_,r,s,c,f),(v=g.ref)&&m.ref!=v&&(b||(b=[]),m.ref&&b.push(m.ref,null,g),b.push(v,g.__c||k,g)),null!=k?(null==x&&(x=k),c=C(e,g,m,w,r,k,c),"option"==n.type?e.value="":"function"==typeof n.type&&(n.__d=c)):c&&m.__e==c&&c.parentNode!=e&&(c=y(m))}if(n.__e=x,null!=r&&"function"!=typeof n.type)for(d=r.length;d--;)null!=r[d]&&p(r[d]);for(d=S;d--;)null!=w[d]&&W(w[d],w[d]);if(b)for(d=0;d<b.length;d++)T(b[d],b[++d],b[++d])}function b(e){return null==e||"boolean"==typeof e?[]:Array.isArray(e)?i.concat.apply([],e.map(b)):[e]}function C(e,t,n,o,l,_,r){var u,i,s;if(void 0!==t.__d)u=t.__d,t.__d=void 0;else if(l==n||_!=r||null==_.parentNode)e:if(null==r||r.parentNode!==e)e.appendChild(_),u=null;else{for(i=r,s=0;(i=i.nextSibling)&&s<o.length;s+=2)if(i==_)break e;e.insertBefore(_,r),u=r}return void 0!==u?u:_.nextSibling}function w(e,t,n,o,l){var _;for(_ in n)"children"===_||"key"===_||_ in t||P(e,_,null,n[_],o);for(_ in t)l&&"function"!=typeof t[_]||"children"===_||"key"===_||"value"===_||"checked"===_||n[_]===t[_]||P(e,_,t[_],n[_],o)}function S(e,t,n){"-"===t[0]?e.setProperty(t,n):e[t]="number"==typeof n&&!1===s.test(t)?n+"px":null==n?"":n}function P(e,t,n,o,l){var _,r,u,i,s;if(l?"className"===t&&(t="class"):"class"===t&&(t="className"),"style"===t)if(_=e.style,"string"==typeof n)_.cssText=n;else{if("string"==typeof o&&(_.cssText="",o=null),o)for(i in o)n&&i in n||S(_,i,"");if(n)for(s in n)o&&n[s]===o[s]||S(_,s,n[s])}else"o"===t[0]&&"n"===t[1]?(r=t!==(t=t.replace(/Capture$/,"")),u=t.toLowerCase(),t=(u in e?u:t).slice(2),n?(o||e.addEventListener(t,E,r),(e.l||(e.l={}))[t]=n):e.removeEventListener(t,E,r)):"list"!==t&&"tagName"!==t&&"form"!==t&&"type"!==t&&"size"!==t&&!l&&t in e?e[t]=null==n?"":n:"function"!=typeof n&&"dangerouslySetInnerHTML"!==t&&(t!==(t=t.replace(/^xlink:?/,""))?null==n||!1===n?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),n):null==n||!1===n&&!/^ar/.test(t)?e.removeAttribute(t):e.setAttribute(t,n))}function E(t){this.l[t.type](e.event?e.event(t):t)}function N(e,t,n){var o,l;for(o=0;o<e.__k.length;o++)(l=e.__k[o])&&(l.__=e,l.__e&&("function"==typeof l.type&&l.__k.length>1&&N(l,t,n),t=C(n,l,l,e.__k,null,l.__e,t),"function"==typeof e.type&&(e.__d=t)))}function U(t,n,o,l,_,r,u,i,s){var p,f,a,d,y,m,g,k,b,C,w,S=n.type;if(void 0!==n.constructor)return null;(p=e.__b)&&p(n);try{e:if("function"==typeof S){if(k=n.props,b=(p=S.contextType)&&l[p.__c],C=p?b?b.props.value:p.__:l,o.__c?g=(f=n.__c=o.__c).__=f.__E:("prototype"in S&&S.prototype.render?n.__c=f=new S(k,C):(n.__c=f=new v(k,C),f.constructor=S,f.render=L),b&&b.sub(f),f.props=k,f.state||(f.state={}),f.context=C,f.__n=l,a=f.__d=!0,f.__h=[]),null==f.__s&&(f.__s=f.state),null!=S.getDerivedStateFromProps&&(f.__s==f.state&&(f.__s=c({},f.__s)),c(f.__s,S.getDerivedStateFromProps(k,f.__s))),d=f.props,y=f.state,a)null==S.getDerivedStateFromProps&&null!=f.componentWillMount&&f.componentWillMount(),null!=f.componentDidMount&&f.__h.push(f.componentDidMount);else{if(null==S.getDerivedStateFromProps&&k!==d&&null!=f.componentWillReceiveProps&&f.componentWillReceiveProps(k,C),!f.__e&&null!=f.shouldComponentUpdate&&!1===f.shouldComponentUpdate(k,f.__s,C)||n.__v===o.__v){f.props=k,f.state=f.__s,n.__v!==o.__v&&(f.__d=!1),f.__v=n,n.__e=o.__e,n.__k=o.__k,f.__h.length&&u.push(f),N(n,i,t);break e}null!=f.componentWillUpdate&&f.componentWillUpdate(k,f.__s,C),null!=f.componentDidUpdate&&f.__h.push(function(){f.componentDidUpdate(d,y,m)})}f.context=C,f.props=k,f.state=f.__s,(p=e.__r)&&p(n),f.__d=!1,f.__v=n,f.__P=t,p=f.render(f.props,f.state,f.context),f.state=f.__s,null!=f.getChildContext&&(l=c(c({},l),f.getChildContext())),a||null==f.getSnapshotBeforeUpdate||(m=f.getSnapshotBeforeUpdate(d,y)),w=null!=p&&p.type==h&&null==p.key?p.props.children:p,x(t,Array.isArray(w)?w:[w],n,o,l,_,r,u,i,s),f.base=n.__e,f.__h.length&&u.push(f),g&&(f.__E=f.__=null),f.__e=!1}else null==r&&n.__v===o.__v?(n.__k=o.__k,n.__e=o.__e):n.__e=D(o.__e,n,o,l,_,r,u,s);(p=e.diffed)&&p(n)}catch(t){n.__v=null,e.__e(t,n,o)}return n.__e}function A(t,n){e.__c&&e.__c(n,t),t.some(function(n){try{t=n.__h,n.__h=[],t.some(function(e){e.call(n)})}catch(t){e.__e(t,n.__v)}})}function D(e,t,n,o,l,_,r,s){var c,p,f,a,d,h=n.props,v=t.props;if(l="svg"===t.type||l,null!=_)for(c=0;c<_.length;c++)if(null!=(p=_[c])&&((null===t.type?3===p.nodeType:p.localName===t.type)||e==p)){e=p,_[c]=null;break}if(null==e){if(null===t.type)return document.createTextNode(v);e=l?document.createElementNS("http://www.w3.org/2000/svg",t.type):document.createElement(t.type,v.is&&{is:v.is}),_=null,s=!1}if(null===t.type)h!==v&&e.data!=v&&(e.data=v);else{if(null!=_&&(_=i.slice.call(e.childNodes)),f=(h=n.props||u).dangerouslySetInnerHTML,a=v.dangerouslySetInnerHTML,!s){if(null!=_)for(h={},d=0;d<e.attributes.length;d++)h[e.attributes[d].name]=e.attributes[d].value;(a||f)&&(a&&f&&a.__html==f.__html||(e.innerHTML=a&&a.__html||""))}w(e,v,h,l,s),a?t.__k=[]:(c=t.props.children,x(e,Array.isArray(c)?c:[c],t,n,o,"foreignObject"!==t.type&&l,_,r,u,s)),s||("value"in v&&void 0!==(c=v.value)&&c!==e.value&&P(e,"value",c,h.value,!1),"checked"in v&&void 0!==(c=v.checked)&&c!==e.checked&&P(e,"checked",c,h.checked,!1))}return e}function T(t,n,o){try{"function"==typeof t?t(n):t.current=n}catch(t){e.__e(t,o)}}function W(t,n,o){var l,_,r;if(e.unmount&&e.unmount(t),(l=t.ref)&&(l.current&&l.current!==t.__e||T(l,null,n)),o||"function"==typeof t.type||(o=null!=(_=t.__e)),t.__e=t.__d=void 0,null!=(l=t.__c)){if(l.componentWillUnmount)try{l.componentWillUnmount()}catch(t){e.__e(t,n)}l.base=l.__P=null}if(l=t.__k)for(r=0;r<l.length;r++)l[r]&&W(l[r],n,o);null!=_&&p(_)}function L(e,t,n){return this.constructor(e,n)}function M(t,n,o){var l,r,s;e.__&&e.__(t,n),r=(l=o===_)?null:o&&o.__k||n.__k,t=f(h,null,[t]),s=[],U(n,(l?n:o||n).__k=t,r||u,u,void 0!==n.ownerSVGElement,o&&!l?[o]:r?null:n.childNodes.length?i.slice.call(n.childNodes):null,s,o||u,l),A(s,t)}function F(e,t){M(e,t,_)}function R(e,t){var n,o;for(o in t=c(c({},e.props),t),arguments.length>2&&(t.children=i.slice.call(arguments,2)),n={},t)"key"!==o&&"ref"!==o&&(n[o]=t[o]);return a(e.type,n,t.key||e.key,t.ref||e.ref,null)}function V(e){var t={},n={__c:"__cC"+r++,__:e,Consumer:function(e,t){return e.children(t)},Provider:function(e){var o,l=this;return this.getChildContext||(o=[],this.getChildContext=function(){return t[n.__c]=l,t},this.shouldComponentUpdate=function(e){l.props.value!==e.value&&o.some(function(t){t.context=e.value,g(t)})},this.sub=function(e){o.push(e);var t=e.componentWillUnmount;e.componentWillUnmount=function(){o.splice(o.indexOf(e),1),t&&t.call(e)}}),e.children}};return n.Consumer.contextType=n,n.Provider.__=n,n}exports.isValidElement=t,exports.options=e,exports.options=e={__e:function(e,t){for(var n,o;t=t.__;)if((n=t.__c)&&!n.__)try{if(n.constructor&&null!=n.constructor.getDerivedStateFromError&&(o=!0,n.setState(n.constructor.getDerivedStateFromError(e))),null!=n.componentDidCatch&&(o=!0,n.componentDidCatch(e)),o)return g(n.__E=n)}catch(t){e=t}throw e}},exports.isValidElement=t=function(e){return null!=e&&void 0===e.constructor},v.prototype.setState=function(e,t){var n;n=this.__s!==this.state?this.__s:this.__s=c({},this.state),"function"==typeof e&&(e=e(n,this.props)),e&&c(n,e),null!=e&&this.__v&&(t&&this.__h.push(t),g(this))},v.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),g(this))},v.prototype.render=h,n=[],o="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,k.__r=0,_=u,r=0;
},{}],"CwoO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e="4.1",s="0.3",t={ZUSAM_VERSION:"4.1",CACHE_VERSION:"0.3",CACHE:"zusam-4.1-simplecache-0.3",CACHE_STORE:"zusam-4.1"};var a=t;exports.default=a;
},{}],"vnR2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={remove:e=>document.getElementById(e).outerHTML="",add:(t,r="alert-success",d=5e3)=>{if(!t)return;let l=document.createElement("DIV");l.id=e.hash(t),l.innerHTML=t,l.classList.add("global-alert","alert",r),document.body.appendChild(l),setTimeout(()=>e.remove(l.id),d)},hash:e=>{let t=0;if(0==e.length)return t;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return t}};var t=e;exports.default=t;
},{}],"vRk2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.get=o,exports.set=n,exports.del=s,exports.clear=i,exports.keys=u,exports.Store=void 0;class e{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((r,o)=>{const n=indexedDB.open(e,1);n.onerror=(()=>o(n.error)),n.onsuccess=(()=>r(n.result)),n.onupgradeneeded=(()=>{n.result.createObjectStore(t)})})}_withIDBStore(e,t){return this._dbp.then(r=>new Promise((o,n)=>{const s=r.transaction(this.storeName,e);s.oncomplete=(()=>o()),s.onabort=s.onerror=(()=>n(s.error)),t(s.objectStore(this.storeName))}))}}let t;function r(){return t||(t=new e),t}function o(e,t=r()){let o;return t._withIDBStore("readonly",t=>{o=t.get(e)}).then(()=>o.result)}function n(e,t,o=r()){return o._withIDBStore("readwrite",r=>{r.put(t,e)})}function s(e,t=r()){return t._withIDBStore("readwrite",t=>{t.delete(e)})}function i(e=r()){return e._withIDBStore("readwrite",e=>{e.clear()})}function u(e=r()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}exports.Store=e;
},{}],"NUMl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("idb-keyval"),t=a(require("./param.js"));function a(e){return e&&e.__esModule?e:{default:e}}const l={name:t.default.CACHE,cache_store:new e.Store(t.default.CACHE_STORE,t.default.CACHE),purgeOldCache:()=>{(0,e.keys)().then(t=>t.map(t=>(0,e.get)(t).then(a=>{a.lastUsed+2592e6<Date.now()&&(console.log(`Remove from cache: ${t.url}`),(0,e.del)(t),caches.open(l.name).then(e=>e.delete(t)))})))},removeMatching:e=>caches.open(l.name).then(t=>t.matchAll().then(a=>Promise.all(a.filter(t=>t.url.match(e)).map(e=>t.delete(e)))))};var r=l;exports.default=r;
},{"idb-keyval":"vRk2","./param.js":"CwoO"}],"EDnG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e={usage:()=>{let e,t=0;for(e in localStorage)Object.prototype.hasOwnProperty.call(localStorage,e)&&(t+=2*(localStorage[e].length+e.length));return t},createStorageBox:(e,t=null)=>({data:e,createdAt:Date.now(),metadata:t}),remove:e=>localStorage.removeItem(e),set:(t,a,o=null)=>(localStorage.setItem(t,JSON.stringify(e.createStorageBox(a,o))),Promise.resolve(t)),get:e=>{let t=localStorage.getItem(e);return null!=t&&(t=JSON.parse(t),Object.prototype.hasOwnProperty.call(t,"data"))?new Promise(e=>e(t.data)):new Promise(e=>e(null))},reset:()=>localStorage.clear()&&window.dispatchEvent(new CustomEvent("resetStorage"))};var t=e;exports.default=t;
},{}],"dg0a":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("./me.js")),t=a(require("./http.js"));function a(e){return e&&e.__esModule?e:{default:e}}const n={dict:[],possibleLang:{en:"English",es:"Español",fr:"Français",sk:"Slovenský"},getDefaultLang:()=>(document.querySelector("meta[name='zusam:default-lang']")||{}).content||"en",getCurrentLang:()=>e.default.me&&e.default.me.data&&e.default.me.data.lang||n.getDefaultLang(),fetchDict:(e=n.getCurrentLang())=>!n.dict[e]&&t.default.get(`/lang/${e}.json`).then(t=>{n.dict[e]=t,window.dispatchEvent(new CustomEvent("fetchedNewDict"))}),t:(e,t={})=>{if(t.dict=t.dict||n.getCurrentLang(),t.count=t.count||0,!e||!n.dict[t.dict])return"";let a=n.dict[t.dict][e]||"";if("object"==typeof a){let e=Object.getOwnPropertyNames(a).map(e=>+e).filter(e=>!isNaN(e)&&e<=t.count).sort((e,t)=>e-t);a=e.length?a[e.slice(-1)[0]]:""}return Object.assign([],a.match(/{{\w+}}/g)).forEach(e=>{let n=e.replace(/[{}]/g,"");t[n]&&(a=a.replace(e,t[n]))}),a}};var r=n;exports.default=r;
},{"./me.js":"DIJp","./http.js":"MqMR"}],"DIJp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=i(require("./http.js")),t=i(require("./lang.js"));function i(e){return e&&e.__esModule?e:{default:e}}const o={me:{},get:()=>o.me.id?Promise.resolve(o.me):o.update(),update:()=>e.default.get("/api/me",!0).then(e=>{if(e)return o.me=Object.assign({notifications:[]},e),o.loadNotifications(),t.default.fetchDict(),setTimeout(dispatchEvent(new CustomEvent("meStateChange"))),e}),loadNotifications:()=>e.default.get(`/api/users/${o.me.id}/notifications`).then(e=>{o.me.notifications=e,setTimeout(dispatchEvent(new CustomEvent("meStateChange")))}),matchNotification:(e,t)=>e.id===t||e.target===t,isNew:e=>!!Array.isArray(o.me.notifications)&&o.me.notifications.some(t=>o.matchNotification(t,e)||"new_comment"==t.type&&t.fromMessage.id===e),removeMatchingNotifications:t=>o.loadNotifications().then(()=>Array.isArray(o.me.notifications)?Promise.all(o.me.notifications.filter(e=>o.matchNotification(e,t)).map(i=>e.default.delete(`/api/notifications/${i.id}`).then(()=>{o.me.notifications=o.me.notifications.filter(e=>!o.matchNotification(e,t)),setTimeout(dispatchEvent(new CustomEvent("meStateChange")))}))):Promise.reject("Failed to get notifications from server")),hasBookmark:e=>{var t,i;return!!Array.isArray(null===(t=o.me)||void 0===t?void 0:null===(i=t.data)||void 0===i?void 0:i.bookmarks)&&o.me.data.bookmarks.some(t=>t===e)},addBookmark:t=>{o.hasBookmark(t)||e.default.post(`/api/bookmarks/${t}`).then(e=>{o.me=Object.assign(o.me,e),setTimeout(dispatchEvent(new CustomEvent("meStateChange")))})},removeBookmark:t=>{o.hasBookmark(t)&&e.default.delete(`/api/bookmarks/${t}`).then(e=>{o.me=Object.assign(o.me,e),setTimeout(dispatchEvent(new CustomEvent("meStateChange")))})}};var a=o;exports.default=a;
},{"./http.js":"MqMR","./lang.js":"dg0a"}],"O1i9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./lang.js")),t=r(require("./router.js")),a=r(require("./me.js"));function r(e){return e&&e.__esModule?e:{default:e}}const n={genId:e=>`z${e}-${Date.now().toString().slice(-5)}${Math.random().toString().slice(-5)}`,id2Int:e=>parseInt(e.replace(/[^\d]/g,""),10),urlRegExp:/(\([^()]*)?https?:\/\/[^[\]\n\r ]*[-A-Za-z0-9+&@#/%=~_()|]/i,getUrl:e=>{if(!e)return"";let t=e.match(n.urlRegExp);if(t&&t[0].startsWith("(")){let e=t[0].match(/https?:\/\//i);t.index+=e.index,t[0]=t[0].slice(e.index),t[0].endsWith(")")&&(t[0]=t[0].slice(0,-1))}return t},limitStrSize:(e,t)=>e.length>t?`${e.slice(0,t-3)}...`:e,humanFullDate:e=>{let t=new Date(1e3*e);return(t=new Date(t.getTime()+6e4*t.getTimezoneOffset()*-1)).toISOString().replace("T"," ").replace(/\..*$/,"")},humanTime:t=>{if(!t)return null;const a=Math.abs(Math.round((Date.now()/1e3-t)/60));return a<1?e.default.t("just_now"):a<60?e.default.t("ago",{duration:`${a}mn`}):a<1440?e.default.t("ago",{duration:`${Math.floor(a/60)}h`}):n.humanFullDate(t).split(" ")[0]},getGroupId:()=>{if(a.default.me.groups)switch(t.default.entity.entityType){case"group":return n.getId(t.default.entity);case"message":return n.getId(t.default.entity.group)}return""},getGroupName:()=>{let e=a.default.me.groups.find(e=>e.id==n.getGroupId());return e?e.name:""},getId:e=>{switch(typeof e){case"object":return e?e.id:null;case"string":return e.split("/").pop().replace(/\?.*$/,"").replace(/\.\w+$/,"");default:throw console.error(e),"Could not extract id !"}},thumbnail:(e,a,r)=>e?t.default.toApp(`/api/images/thumbnail/${a}/${r}/${e}`):null,crop:(e,a,r)=>e?t.default.toApp(`/api/images/crop/${a}/${r}/${e}`):null,defaultAvatar:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIAAQMAAADOtka5AAAABlBMVEUAAAD///+l2Z/dAAAAAnRSTlMA/iyWEiMAAAMJSURBVHja7ZtBjpwwEEWxmIhFFmiURZZEyi6HCLkZHCXr2eQKHIUjoEiRSGRRiWB6klaDU/hDF4z+W6LuNz3+ZRvbkCSEEEIIIYQQQgghhBBCCCGEEEIIITvwGfy+kxoTpNJigkw6TJBLjwkK8ZiglMFYUInAAqwQRKRBBR0q8FhXEKwVR0GLCvxCjeo6oyzkoIxnEvj5661acPO3yvFqpxdcV+Pj88VeNZ7cGB4ul1QFkv399KT4KBIpmGEwF4i9oL6DIN/3FzToL2ju8AvsBeE2aNFfQMFJBCkF0/R+bkHyCgSVuaDcVaC5zyvMBTkqyHYVaBZDKSpw5oJgLcMC5doXFBSoIMNutjcQBHJULmlhQYUKlmNQbs9kqGC5P2o3FqBBOVjMWkEOdcZQKam3dyqkkgP/g35zxmEpLhbjir0ZFz2tXHgbPR5deI+EMPKmig/hhU/fIkOYL4iYDbIyqpCXajp2Zy4yhNuxqUfbMCaEIraQZ9swJgQBQ0jBQr6eYXrzQrYIYdtC9uaFbDKayJajyTkL+VijyWA+mnBajGpDeFrMzAu5BNvwKoQBDaFHQ+jQEBo0hBoMYUBD8GgIHRpCi44mcAiJRQhoITvzQs63LGQxL2SOJnEhiHUI296bwNOixb1JYr5kz8yX7Odf6XDfBC9kd6yVzq+np69QIY/8AEJ45kt0T4hIM0VONm5CiLlVhLflS+CwdTGEVa2AnfOFTogaVAAfcg1QivpqzLFHD4LnrR0q8FAhqlux3PPUu0EFLSrooL6kLeaQwKMCTY4OfUjVoY+IOvTxSFiw81NtnbmgRwXeXDAg08IxBPIKBPX5BQ0FBxC0+wtSCg4gcBT853nruwiqfQXNHQT/LDiGD9Old6sEL2umn3MtqxDks9NotVbwfaG+FDfL6fznsjV32365cTXrtqoPdJKYrbmreIDvT42DCMYoIUEu4FvIKSpwgr6JvYEAfJm8QgUl+j58gb6Rn4Nvcv/p0jUmcODr8IQQQgghhBBCCCGEEEIIIYQQQgghs/wGp6uYgtiKODIAAAAASUVORK5CYII=",hash:e=>e.split("").reduce((e,t)=>(e<<5)-e+t.charCodeAt()|0),colorHash:e=>["#000000","#333366","#333399","#3333CC","#339933","#339999","#33CC33","#33CC99","#663333","#663366","#666633","#666699","#66CC33","#66CCCC","#993333","#993366","#993399","#996633","#999966","#CC3333","#CC3366","#CC3399","#CC33CC","#CC6633","#CC9933","#CC99CC","#CCCC33"][Math.abs(n.hash(e))%27],backgroundHash:e=>{if(!e)return"background-color: #aaa;";let t=n.colorHash(e),a=n.colorHash(e.split("").reverse().join("."));return`background-color:${t};background-image:linear-gradient(${Math.abs(n.hash(e))%4*45}deg, ${a} 15%, transparent 15% 30%, ${a} 30% 45%, transparent 45% 60%, ${a} 60% 75%, transparent 75% 90%, ${a} 90%);`}};var i=n;exports.default=i;
},{"./lang.js":"dg0a","./router.js":"QBcK","./me.js":"DIJp"}],"QBcK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=n(require("./http.js")),t=n(require("./me.js")),a=n(require("./util.js")),r=n(require("./lang.js")),i=n(require("./storage.js"));function n(e){return e&&e.__esModule?e:{default:e}}const o={route:"",id:"",action:"",backUrl:"",backUrlPrompt:"",entityUrl:"",entityType:"",search:"",entity:{},isValidUrl:e=>{try{return new URL(e),!0}catch(t){return!1}},getSubpath:()=>new URL(document.baseURI).pathname.replace(/\/$/,""),toApp:e=>e&&"string"==typeof e?o.isValidUrl(e)?e:location.origin+o.getSubpath()+e:"",removeSubpath:e=>e?e.replace(new RegExp(`^${o.getSubpath()}`),""):"",getParam:(e,t=window.location.search.substring(1))=>{let a=t.split("&").find(t=>t.split("=")[0]===e);return a?decodeURIComponent(a.split("=")[1]):""},getSegments:()=>window.location.pathname.slice(1).split("?")[0].split("/"),isOutside:()=>["login","password-reset","signup","invitation","stop-notification-emails","public"].includes(o.route||o.getSegments()[0]),isEntity:e=>["messages","groups","users","links","files"].includes(e),getUrlComponents:e=>{let t={};return e&&(t.url=new URL(e),t.path=t.url.pathname,t.search=t.url.search.slice(1),[t.route,t.id,t.action]=o.removeSubpath(t.path).slice(1).split("/")),t.entityUrl="",t.entityType="",t.backUrl="",t.backUrlPrompt="",t},navigate:async(n="/",s={})=>{n.match(/^http/)||s.raw_url||(n=o.toApp(n));let l=o.getUrlComponents(n);if(o.url&&o.url.href==l.url.href)console.warn("navigate lock !");else switch(Object.assign(o,l),o.id&&o.isEntity(null==o?void 0:o.route)?(o.entityUrl=`/api/${o.route}/${o.id}`,o.entityType=o.route,await e.default.get(o.entityUrl).then(e=>{if(!e)return console.warn("Unknown entity"),void o.navigate();switch(o.entity=e,o.route){case"groups":"write"==o.action&&(o.backUrl=`/${o.route}/${o.id}`,o.backUrlPrompt=r.default.t("cancel_write")),o.search&&(o.backUrl=`/${o.route}/${o.id}`);break;case"messages":e.parent&&!e.isInFront?o.backUrl=`/messages/${e.parent.id}`:o.backUrl=`/groups/${a.default.getId(e.group)}`;break;case"users":o.backUrl="/";break;default:o.action&&(o.backUrl="/")}}).catch(e=>console.warn(e))):o.entity=null,o.route){case"login":i.default.reset();case"bookmarks":case"create-group":case"groups":case"messages":case"password-reset":case"public":case"share":case"signup":case"stop-notification-emails":case"users":s.replace?history.replaceState(null,"",n):history.pushState(null,"",n),window.dispatchEvent(new CustomEvent("routerStateChange"));break;case"logout":i.default.reset(),window.location.href=window.location.origin;break;case"invitation":i.default.get("apiKey").then(t=>{t?e.default.post(`/api/groups/invitation/${o.id}`,{}).then(()=>{window.location.href=window.location.origin}):o.navigate(`/signup?inviteKey=${o.id}`)});break;default:t.default.get().then(e=>{e?e.data.default_group?o.navigate(`/groups/${e.data.default_group}`):e.groups[0]?o.navigate(`/groups/${e.groups[0].id}`):window.location="/create-group":o.navigate("/login")})}},sync:()=>{o.navigate(location.pathname+location.search+location.hash,{replace:!0})},onClick:(e,t=!1,a=null)=>{if(e.preventDefault(),e.stopPropagation(),!a){const r=e.target.closest("a");r&&("_blank"==r.target&&(t=!0),a=r.getAttribute("href"))}if(a){if(a.startsWith("http")){if(new URL(a).host!=location.host)return void(e.ctrlKey||t?open(a,"_blank"):location.href=a)}for(let e of document.getElementsByClassName("active"))e.classList.remove("active");e.ctrlKey||t?open(a,"_blank"):o.navigate(a)}}};var s=o;exports.default=s;
},{"./http.js":"MqMR","./me.js":"DIJp","./util.js":"O1i9","./lang.js":"dg0a","./storage.js":"EDnG"}],"MqMR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=a(require("./alert.js")),t=a(require("./storage.js")),r=a(require("./router.js"));function a(e){return e&&e.__esModule?e:{default:e}}const s={sendFile:(r,a,s=null,n=null)=>t.default.get("apiKey").then(e=>{let t=new XMLHttpRequest;t.open("POST",`${document.baseURI}api/files`,!0),t.setRequestHeader("X-AUTH-TOKEN",e),t.addEventListener("load",e=>{e.target.status>199&&e.target.status<300?a(JSON.parse(e.target.response)):n?n(e.target.statusText):console.error(e.target.statusText)}),s&&(t.upload.onprogress=(e=>s({loaded:e.loaded,total:e.total}))),n&&t.addEventListener("error",e=>n(e)),t.send(r)}).catch(t=>e.default.add(t,"alert-danger")),get:(a,s=!1)=>t.default.get("apiKey").then(e=>{if(!(a=r.default.toApp(a)))return;let t={};return e&&(t["X-AUTH-TOKEN"]=e),s&&(t["X-NOCACHE"]="nocache"),fetch(a,{method:"GET",headers:new Headers(t)}).then(e=>e.ok&&e.json()).catch(e=>console.warn(`ERROR for ${a}`,e))}).catch(t=>e.default.add(t,"alert-danger")),post:(e,t,r="application/json")=>s.request(e,t,"POST",r),put:(e,t,r="application/json")=>s.request(e,t,"PUT",r),delete:(e,t,r="application/json")=>s.request(e,null,"DELETE",r),request:(a,s,n,o="application/json")=>t.default.get("apiKey").then(e=>{if(!(a=r.default.toApp(a)))return;let t={};e&&(t["X-AUTH-TOKEN"]=e),o&&(t["Content-type"]=o);let d={method:n,headers:new Headers(t)};return s&&(d.body="object"==typeof s&&"Object"==s.constructor.name?JSON.stringify(s):s),fetch(a,d).then(e=>{try{return e.json()}catch(t){return console.warn(t.message),Promise.reject(t.message)}}).catch(e=>console.warn(`ERROR for ${a}`,e))}).catch(t=>e.default.add(t,"alert-danger"))};var n=s;exports.default=n;
},{"./alert.js":"vnR2","./storage.js":"EDnG","./router.js":"QBcK"}],"rqMW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.lang=exports.util=exports.router=exports.me=exports.http=exports.storage=exports.cache=exports.alert=exports.param=void 0;var e=x(require("./param.js")),t=x(require("./alert.js")),r=x(require("./cache.js")),s=x(require("./storage.js")),o=x(require("./http.js")),u=x(require("./me.js")),a=x(require("./router.js")),p=x(require("./util.js")),l=x(require("./lang.js"));function x(e){return e&&e.__esModule?e:{default:e}}const c=e.default;exports.param=c;const i=t.default;exports.alert=i;const n=r.default;exports.cache=n;const d=s.default;exports.storage=d;const f=o.default;exports.http=f;const j=u.default;exports.me=j;const q=a.default;exports.router=q;const g=p.default;exports.util=g;const h=l.default;exports.lang=h;
},{"./param.js":"CwoO","./alert.js":"vnR2","./cache.js":"NUMl","./storage.js":"EDnG","./http.js":"MqMR","./me.js":"DIJp","./router.js":"QBcK","./util.js":"O1i9","./lang.js":"dg0a"}],"Kz2q":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var c=require("preact");class l extends c.Component{constructor(c){super(c),this.state={regular:{comment:[512,512,[],"f075","M256 32C114.6 32 0 125.1 0 240c0 47.6 19.9 91.2 52.9 126.3C38 405.7 7 439.1 6.5 439.5c-6.6 7-8.4 17.2-4.6 26S14.4 480 24 480c61.5 0 110-25.7 139.1-46.3C192 442.8 223.2 448 256 448c141.4 0 256-93.1 256-208S397.4 32 256 32zm0 368c-26.7 0-53.1-4.1-78.4-12.1l-22.7-7.2-19.5 13.8c-14.3 10.1-33.9 21.4-57.5 29 7.3-12.1 14.4-25.7 19.9-40.2l10.6-28.1-20.6-21.8C69.7 314.1 48 282.2 48 240c0-88.2 93.3-160 208-160s208 71.8 208 160-93.3 160-208 160z"],bookmark:[384,512,[],"f02e","M336 0H48C21.49 0 0 21.49 0 48v464l192-112 192 112V48c0-26.51-21.49-48-48-48zm0 428.43l-144-84-144 84V54a6 6 0 0 1 6-6h276c3.314 0 6 2.683 6 5.996V428.43z"],images:[576,512,[],"f302","M480 416v16c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V176c0-26.51 21.49-48 48-48h16v48H54a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6v-10h48zm42-336H150a6 6 0 0 0-6 6v244a6 6 0 0 0 6 6h372a6 6 0 0 0 6-6V86a6 6 0 0 0-6-6zm6-48c26.51 0 48 21.49 48 48v256c0 26.51-21.49 48-48 48H144c-26.51 0-48-21.49-48-48V80c0-26.51 21.49-48 48-48h384zM264 144c0 22.091-17.909 40-40 40s-40-17.909-40-40 17.909-40 40-40 40 17.909 40 40zm-72 96l39.515-39.515c4.686-4.686 12.284-4.686 16.971 0L288 240l103.515-103.515c4.686-4.686 12.284-4.686 16.971 0L480 208v80H192v-48z"],"check-circle":[512,512,[],"f058","M256 8C119.033 8 8 119.033 8 256s111.033 248 248 248 248-111.033 248-248S392.967 8 256 8zm0 48c110.532 0 200 89.451 200 200 0 110.532-89.451 200-200 200-110.532 0-200-89.451-200-200 0-110.532 89.451-200 200-200m140.204 130.267l-22.536-22.718c-4.667-4.705-12.265-4.736-16.97-.068L215.346 303.697l-59.792-60.277c-4.667-4.705-12.265-4.736-16.97-.069l-22.719 22.536c-4.705 4.667-4.736 12.265-.068 16.971l90.781 91.516c4.667 4.705 12.265 4.736 16.97.068l172.589-171.204c4.704-4.668 4.734-12.266.067-16.971z"],"file-pdf":[384,512,[],"f1c1","M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm250.2-143.7c-12.2-12-47-8.7-64.4-6.5-17.2-10.5-28.7-25-36.8-46.3 3.9-16.1 10.1-40.6 5.4-56-4.2-26.2-37.8-23.6-42.6-5.9-4.4 16.1-.4 38.5 7 67.1-10 23.9-24.9 56-35.4 74.4-20 10.3-47 26.2-51 46.2-3.3 15.8 26 55.2 76.1-31.2 22.4-7.4 46.8-16.5 68.4-20.1 18.9 10.2 41 17 55.8 17 25.5 0 28-28.2 17.5-38.7zm-198.1 77.8c5.1-13.7 24.5-29.5 30.4-35-19 30.3-30.4 35.7-30.4 35zm81.6-190.6c7.4 0 6.7 32.1 1.8 40.8-4.4-13.9-4.3-40.8-1.8-40.8zm-24.4 136.6c9.7-16.9 18-37 24.7-54.7 8.3 15.1 18.9 27.2 30.1 35.5-20.8 4.3-38.9 13.1-54.8 19.2zm131.6-5s-5 6-37.3-7.8c35.1-2.6 40.9 5.4 37.3 7.8z"],bell:[448,512,[],"f0f3","M439.39 362.29c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71zM67.53 368c21.22-27.97 44.42-74.33 44.53-159.42 0-.2-.06-.38-.06-.58 0-61.86 50.14-112 112-112s112 50.14 112 112c0 .2-.06.38-.06.58.11 85.1 23.31 131.46 44.53 159.42H67.53zM224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64z"]},solid:{bookmark:[384,512,[],"f02e","M0 512V48C0 21.49 21.49 0 48 0h288c26.51 0 48 21.49 48 48v464L192 400 0 512z"],comment:[512,512,[],"f075","M256 32C114.6 32 0 125.1 0 240c0 49.6 21.4 95 57 130.7C44.5 421.1 2.7 466 2.2 466.5c-2.2 2.3-2.8 5.7-1.5 8.7S4.8 480 8 480c66.3 0 116-31.8 140.6-51.4 32.7 12.3 69 19.4 107.4 19.4 141.4 0 256-93.1 256-208S397.4 32 256 32z"],"pencil-alt":[512,512,[],"f303","M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"],"arrow-left":[448,512,[],"f060","M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"],"caret-down":[320,512,[],"f0d7","M31.3 192h257.3c17.8 0 26.7 21.5 14.1 34.1L174.1 354.8c-7.8 7.8-20.5 7.8-28.3 0L17.2 226.1C4.6 213.5 13.5 192 31.3 192z"],film:[512,512,[],"f008","M488 64h-8v20c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12V64H96v20c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12V64h-8C10.7 64 0 74.7 0 88v336c0 13.3 10.7 24 24 24h8v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h320v-20c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v20h8c13.3 0 24-10.7 24-24V88c0-13.3-10.7-24-24-24zM96 372c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12H44c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm272 208c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm0-168c0 6.6-5.4 12-12 12H156c-6.6 0-12-5.4-12-12v-96c0-6.6 5.4-12 12-12h200c6.6 0 12 5.4 12 12v96zm112 152c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40zm0-96c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40z"],times:[352,512,[],"f00d","M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"],bell:[448,512,[],"f0f3","M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"],"ellipsis-h":[512,512,[],"f141","M328 256c0 39.8-32.2 72-72 72s-72-32.2-72-72 32.2-72 72-72 72 32.2 72 72zm104-72c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72zm-352 0c-39.8 0-72 32.2-72 72s32.2 72 72 72 72-32.2 72-72-32.2-72-72-72z"],search:[512,512,[],"f002","M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"]}}}render(){const l=this.state[this.props.family][this.props.icon];return l&&(0,c.h)("svg",{className:`fa-icon ${this.props.family} ${this.props.icon}`,viewBox:`0 0 ${l[0]} ${l[1]}`},(0,c.h)("path",{fill:"currentColor",d:l[4]}))}}exports.default=l;
},{"preact":"aSor"}],"V5Rv":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FaIcon=void 0;var e=o(require("./fa-icon.component.js"));function o(e){return e&&e.__esModule?e:{default:e}}const t=e.default;exports.FaIcon=t;
},{"./fa-icon.component.js":"Kz2q"}],"FheM":[function(require,module,exports) {
var t=null;function e(){return t||(t=n()),t}function n(){try{throw new Error}catch(e){var t=(""+e.stack).match(/(https?|file|ftp|chrome-extension|moz-extension):\/\/[^)\n]+/g);if(t)return r(t[0])}return"/"}function r(t){return(""+t).replace(/^((?:https?|file|ftp|chrome-extension|moz-extension):\/\/.+)\/[^/]+$/,"$1")+"/"}exports.getBundleURL=e,exports.getBaseURL=r;
},{}],"TUK3":[function(require,module,exports) {
var r=require("./bundle-url").getBundleURL;function e(r){Array.isArray(r)||(r=[r]);var e=r[r.length-1];try{return Promise.resolve(require(e))}catch(n){if("MODULE_NOT_FOUND"===n.code)return new s(function(n,i){t(r.slice(0,-1)).then(function(){return require(e)}).then(n,i)});throw n}}function t(r){return Promise.all(r.map(u))}var n={};function i(r,e){n[r]=e}module.exports=exports=e,exports.load=t,exports.register=i;var o={};function u(e){var t;if(Array.isArray(e)&&(t=e[1],e=e[0]),o[e])return o[e];var i=(e.substring(e.lastIndexOf(".")+1,e.length)||e).toLowerCase(),u=n[i];return u?o[e]=u(r()+e).then(function(r){return r&&module.bundle.register(t,r),r}).catch(function(r){throw delete o[e],r}):void 0}function s(r){this.executor=r,this.promise=null}s.prototype.then=function(r,e){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.then(r,e)},s.prototype.catch=function(r){return null===this.promise&&(this.promise=new Promise(this.executor)),this.promise.catch(r)};
},{"./bundle-url":"FheM"}],"FklW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),i=require("/core"),l=require("/misc");class r extends e.Component{constructor(e){super(e),this.toggleFile=this.toggleFile.bind(this);let i=[];Array.isArray(e.files)&&e.files.forEach((e,l)=>{null==e.fileIndex&&(e.fileIndex=l),i.splice(e.fileIndex,0,e)}),this.state={files:i}}toggleFile(e){e.stopPropagation(),e.preventDefault(),"function"==typeof this.props.toggleFile&&this.props.toggleFile(e.currentTarget.getAttribute("fileIndex"))}renderFile(r,t=!1){let s=r.contentUrl?`/files/${r.contentUrl}`:null,n=s;if(/image/.test(r.type)&&"image/gif"!=r.type&&(n=i.util.thumbnail(r.id,1366,999999)),1==t)switch(r.status){case"raw":return(0,e.h)("a",{class:"rounded"},(0,e.h)("div",{class:"miniature"},(0,e.h)(l.FaIcon,{family:"regular",icon:"check-circle"})));case"initial":return(0,e.h)("a",{class:"rounded"},(0,e.h)("div",{class:"miniature video-raw",style:`background-image:url('${i.util.crop(r.id,160,160)}')`}),(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)),(null==r?void 0:r.progress)>0&&(0,e.h)("div",{class:"progress-bar"},(0,e.h)("div",{style:{width:`${r.progress}%`}})));case"ready":default:return(0,e.h)("a",{"data-nlg":!this.props.inWriter,"data-origin":s,"data-src":i.util.thumbnail(r.id,1366,768),href:this.props.inWriter?void 0:i.router.toApp(n),class:"rounded"},(0,e.h)("div",{className:`miniature${r.removed?" removed":""}`,style:`background-image:url('${i.util.crop(r.id,160,160)}')`}),(0,e.h)("div",{class:"remove-button",style:r.removed?"color:red":"",fileIndex:r.fileIndex,onClick:e=>this.toggleFile(e)},(0,e.h)(l.FaIcon,{family:"solid",icon:"times"})))}if(r.contentUrl){if(/video/.test(r.type))return"ready"==r.status?(0,e.h)("video",{poster:i.util.thumbnail(r.id,1280,720),class:"img-fluid contained-height video",controls:"true",src:n}):(0,e.h)("a",{class:"image video-uploaded"},(0,e.h)("img",{class:"img-fluid video-raw",src:i.util.crop(r.id,320,180)}),(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)));if(/image/.test(r.type))return(0,e.h)("a",{"data-nlg":!this.props.inWriter,"data-origin":s,href:this.props.inWriter?void 0:i.router.toApp(n),className:`image${r.removed?" removed":""}`},(0,e.h)("img",{class:"img-fluid",src:n}),(0,e.h)("div",{class:"remove-button",style:r.removed?"color:red":"",fileIndex:r.fileIndex,onClick:e=>this.toggleFile(e)},(0,e.h)(l.FaIcon,{family:"solid",icon:"times"})))}return(0,e.h)("div",{class:"file-placeholder"},r.error?(0,e.h)("div",{class:"orange-error"},"×"):(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null)),(0,e.h)("div",{class:"progress-bar"},(0,e.h)("div",{style:{width:`${r.progress}%`}})))}render(){return this.props.files&&0!==this.props.files.length?this.props.files&&this.props.files.length>3?(0,e.h)("div",{class:"file-grid"},this.state.files.sort((e,i)=>e.fileIndex>i.fileIndex?1:-1).map(e=>this.renderFile(e,!0))):(0,e.h)("div",{class:"d-flex justify-content-center flex-wrap"},this.state.files.sort((e,i)=>e.fileIndex>i.fileIndex?1:-1).map(e=>this.renderFile(e))):null}componentDidMount(){require("_bundle_loader")(require.resolve("/lazy/nlg.js")).then(e=>e.default.start())}componentDidUpdate(){require("_bundle_loader")(require.resolve("/lazy/nlg.js")).then(e=>e.default.start())}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","_bundle_loader":"TUK3","/lazy/nlg.js":[["nlg.8003bf41.js","vjjh"],"nlg.8003bf41.js.map","vjjh"]}],"cVVC":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=a(require("./message.component.js"));function a(e){return e&&e.__esModule?e:{default:e}}class i extends e.Component{constructor(e){super(e),this.state={message:this.props.message}}componentDidMount(){t.me.removeMatchingNotifications(this.props.message.id)}componentWillUpdate(){let e=document.getElementById(this.state.message.id);this.state.message.id==t.router.action&&e.classList.contains("highlight")&&setTimeout(()=>{e.scrollIntoView({block:"start",behavior:"smooth"}),setTimeout(()=>e.classList.remove("highlight"),1e3)},1e3)}render(){if(this.state.message&&!this.state.isRemoved)return(0,e.h)(s.default,{message:this.state.message,isPublic:this.props.isPublic,isChild:!0,preMessageHeadComponent:this.state.edit&&t.me.me&&(0,e.h)("div",{class:"message-head d-none d-md-block"},(0,e.h)("img",{class:"rounded-circle w-3 material-shadow avatar",style:t.util.backgroundHash(t.me.me.id),src:t.me.me.avatar?t.util.crop(t.me.me.avatar.id,100,100):t.util.defaultAvatar}))})}}exports.default=i;
},{"preact":"aSor","/core":"rqMW","./message.component.js":"u6BK"}],"gXdK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var s=require("preact"),e=require("/core"),i=t(require("./message-child.component.js"));function t(s){return s&&s.__esModule?s:{default:s}}class l extends s.Component{constructor(s){super(s),this.onNewChild=this.onNewChild.bind(this),this.loadMessage=this.loadMessage.bind(this),this.displayPreviousChildren=this.displayPreviousChildren.bind(this),this.displayNextChildren=this.displayNextChildren.bind(this),this.state={firstDisplayedChild:0,lastDisplayedChild:0},window.addEventListener("newChild",this.onNewChild)}onNewChild(s){const i=s.detail;i.parent&&e.util.getId(i.parent)==this.props.id&&this.setState(s=>({lastDisplayedChild:s.lastDisplayedChild+1}))}loadMessage(){let s=0,i=0;if(this.props.childMessages.length){let t=e.router.action?this.props.childMessages.findIndex(s=>s&&s.id===e.router.action):-1;-1!=t?(s=Math.max(0,t-1),i=Math.min(this.props.childMessages.length,t+1)):(s=this.props.childMessages&&this.props.childMessages.length-5,i=this.props.childMessages&&this.props.childMessages.length)}this.setState({firstDisplayedChild:s,lastDisplayedChild:i})}displayPreviousChildren(){this.setState(s=>({firstDisplayedChild:Math.max(0,s.firstDisplayedChild-10)}))}displayNextChildren(){this.setState(s=>({lastDisplayedChild:Math.min(this.props.childMessages.length,s.lastDisplayedChild+10)}))}componentDidMount(){this.loadMessage()}render(){return this.state.lastDisplayedChild-this.state.firstDisplayedChild<1||!this.props.childMessages?null:(0,s.h)("div",{class:"children"},this.state.firstDisplayedChild>0&&(0,s.h)("div",{class:"d-flex"},(0,s.h)("a",{class:"more-coms unselectable",onClick:()=>this.displayPreviousChildren()},e.lang.t("previous_coms"))),this.props.childMessages.map((e,t)=>e.files.length||""!=e.data.text||e.children.length?t<this.state.firstDisplayedChild||t>this.state.lastDisplayedChild?null:(0,s.h)(i.default,{message:e,key:e.id,isPublic:this.props.isPublic}):null),this.state.lastDisplayedChild+1<this.props.childMessages.length&&(0,s.h)("div",{class:"d-flex"},(0,s.h)("span",{class:"more-coms unselectable",onClick:()=>this.displayNextChildren()},e.lang.t("next_coms"))))}}exports.default=l;
},{"preact":"aSor","/core":"rqMW","./message-child.component.js":"cVVC"}],"rXDu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=r;var a=require("preact"),i=require("/core");function r(){var r,o,s,t,e,l,d;return(0,a.h)("div",{class:"message-head d-flex"},(0,a.h)("div",null,(0,a.h)("img",{className:`rounded-circle material-shadow avatar${(null===(r=this.props.author)||void 0===r?void 0:r.name)?"":" removed-user"}`,style:i.util.backgroundHash((null===(o=this.props.author)||void 0===o?void 0:o.name)?null===(s=this.props.author)||void 0===s?void 0:s.id:""),src:(null===(t=this.props.author)||void 0===t?void 0:t.avatar)?i.util.crop(null===(e=this.props.author)||void 0===e?void 0:e.avatar.id,100,100):i.util.defaultAvatar,title:(null===(l=this.props.author)||void 0===l?void 0:l.name)||""})),!this.props.isChild&&(0,a.h)("div",{class:"infos"},(0,a.h)("span",{class:"capitalize author"},(null===(d=this.props.author)||void 0===d?void 0:d.name)||"--")))}
},{"preact":"aSor","/core":"rqMW"}],"W867":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var s=require("preact"),e=require("/core"),i=require("/misc");function l(){var l,a,o,t,n;return(0,s.h)("div",{class:"message-footer"},(0,s.h)("div",{class:"infos"},!this.props.isPublic&&(null===(l=this.props.author)||void 0===l?void 0:l.id)==e.me.me.id&&(0,s.h)(s.Fragment,null,(0,s.h)("a",{class:"action seamless-link font-size-90 capitalize d-none d-sm-block",onClick:s=>this.props.editMessage(s)},e.lang.t("edit")),(0,s.h)("div",{class:"dot d-none d-sm-block"},"•")),!this.props.isPublic&&this.props.isChild&&(0,s.h)(s.Fragment,null,(0,s.h)("a",{class:"action seamless-link font-size-90 capitalize",href:e.router.toApp(`/messages/${this.props.message.id}${this.props.message.children.length?"":"?focus=reply"}`),onClick:s=>e.router.onClick(s)},this.props.message.children.length?this.props.message.children.some(s=>e.me.isNew(s.id))?(0,s.h)("b",null,e.lang.t("replies",{count:this.props.message.children.length})):e.lang.t("replies",{count:this.props.message.children.length}):e.lang.t("reply")),(0,s.h)("div",{class:"dot"},"•")),(0,s.h)("div",{class:"date font-size-90",title:e.util.humanFullDate(this.props.message.createdAt)},e.util.humanTime(this.props.message.createdAt)),(0,s.h)(s.Fragment,null,(0,s.h)("div",{class:"dot"},"•"),(0,s.h)("div",{class:"font-size-90"},(null===(a=this.props.author)||void 0===a?void 0:a.name)||"--"))),(0,s.h)("div",null,!this.props.isPublic&&(0,s.h)("div",{class:"options dropdown",onClick:s=>s.target.closest(".dropdown").classList.toggle("active")},(0,s.h)("div",{class:"none-if-follows-empty"},(0,s.h)(i.FaIcon,{family:"solid",icon:"ellipsis-h"})),(0,s.h)("div",{class:"dropdown-menu dropdown-options"},(null===(o=this.props.author)||void 0===o?void 0:o.id)==e.me.me.id&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.deleteMessage(s)},e.lang.t("delete")),(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.openPublicLink(s)},e.lang.t("public_link")),e.me.me.groups.length>1&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.shareMessage(s)},e.lang.t("share_message")),!this.props.message.isInFront&&(null===(t=this.props.author)||void 0===t?void 0:t.id)==e.me.me.id&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:s=>this.props.publishInGroup(s)},e.lang.t("publish_in_group")),!e.me.hasBookmark(this.props.message.id)&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:()=>e.me.addBookmark(this.props.message.id)},e.lang.t("add_bookmark")),e.me.hasBookmark(this.props.message.id)&&(0,s.h)("a",{class:"seamless-link capitalize",onClick:()=>e.me.removeBookmark(this.props.message.id)},e.lang.t("remove_bookmark")),(null===(n=this.props.author)||void 0===n?void 0:n.id)==e.me.me.id&&(0,s.h)("a",{class:"seamless-link capitalize d-block d-sm-none",onClick:s=>this.props.editMessage(s)},e.lang.t("edit"))))))}
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"gPUS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=s;var e=require("preact"),t=require("/core");function s(){let s="";const r=this.props.url.split("/"),l=t.router.getParam("t",this.props.url.split("?")[1]);switch(r[2]){case"www.twitch.tv":s=r.length>5&&"clip"==r[4]?`https://clips.twitch.tv/embed?clip=${r[5].replace(/\?.*$/,"")}&autoplay=false`:`https://player.twitch.tv/?video=${r[4].replace(/\?.*$/,"")}&autoplay=false${l?`&t=${l}`:""}`;break;case"clips.twitch.tv":s=`https://clips.twitch.tv/embed?clip=${r[3].replace(/\?.*$/,"")}&autoplay=false`}return(0,e.h)("div",{class:"embed-responsive embed-responsive-16by9"},(0,e.h)("iframe",{allowfullscreen:!0,class:"embed-responsive-item",src:s}))}
},{"preact":"aSor","/core":"rqMW"}],"U94H":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact");class s extends e.Component{render(){const s=`${this.props.url}/size=large/bgcol=f5f5f5/linkcol=0687f5/minimal=true/tracklist=false/`;return this.state.revealed?(0,e.h)("div",{class:"bandcamp-embed embed-responsive embed-responsive-1by1"},(0,e.h)("iframe",{class:"embed-responsive-item",src:s})):(0,e.h)("div",{class:"embed-preview",onClick:()=>this.setState({revealed:!0})},(0,e.h)("div",{class:"bandcamp"}),(0,e.h)("img",{src:this.props.preview}))}}exports.default=s;
},{"preact":"aSor"}],"bleW":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact");class s extends e.Component{render(){return this.state.revealed?(0,e.h)("div",{class:"embed-responsive embed-responsive-16by9"},(0,e.h)("iframe",{allowfullscreen:!0,class:"embed-responsive-item",src:this.props.url})):(0,e.h)("div",{class:"embed-preview",onClick:()=>this.setState({revealed:!0})},(0,e.h)("div",{className:this.props.playBtnClass}),(0,e.h)("img",{src:this.props.preview}))}}exports.default=s;
},{"preact":"aSor"}],"M0D7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),r=i(require("./embeds/twitch-embed.component.js")),s=i(require("./embeds/bandcamp-embed.component.js")),p=i(require("./embeds/generic-embed.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}class a extends e.Component{getPreview(){if(this.props.data.providerUrl)switch(this.props.data.providerUrl.toLowerCase().replace(/\/$/,"").replace(/^https?:\/\/(www\.)?/,"")){case"lichess.org":return(0,e.h)(p.default,{preview:t.util.crop(this.props.preview.id,270,270),url:this.props.url.match("/study/")?this.props.url.replace("/study/","/study/embed/"):this.props.url.replace("lichess.org/","lichess.org/embed/"),playBtnClass:"lichess"});case"gamerdvr.com":if(this.props.data.url.match(/\/gamer\/\w+\/video\//))return(0,e.h)(p.default,{preview:t.util.crop(this.props.preview.id,1024,270),url:`${this.props.data.url}/embed`,playBtnClass:"gamerdvr"});break;case"youtube.com":if("video"==this.props.data.type&&this.props.data.code)return(0,e.h)(p.default,{preview:t.util.crop(this.props.preview.id,1024,270),url:`${this.props.data.code.match(/https:\/\/[^"\s]+/)[0]}&autoplay=1&controls=2&wmode=opaque`,playBtnClass:"youtube"});break;case"soundcloud.com":if(this.props.data.code)return(0,e.h)(p.default,{preview:t.util.crop(this.props.preview.id,1024,270),url:`${this.props.data.code.match(/https:\/\/[^"\s]+/)[0]}&auto_play=true`,playBtnClass:"soundcloud"});break;case"twitch.tv":return(0,e.h)(r.default,{preview:this.props.preview,url:this.props.data.url});case"bandcamp.com":if(this.props.data.code){let r=this.props.data.code.match(/https:\/\/.*album=\d+/);if(r||(r=this.props.data.code.match(/https:\/\/.*track=\d+/)),r)return(0,e.h)(s.default,{preview:t.util.crop(this.props.preview.id,1024,270),url:r[0]})}break;case"imgur.com":if("photo"==this.props.data.type)break}if(this.props.data.providerName)switch(this.props.data.providerName.toLowerCase()){case"peertube":if(this.props.data.code)return(0,e.h)("div",{class:"embed-container",dangerouslySetInnerHTML:{__html:this.props.data.code}})}return/image/.test(this.props.data["content-type"])?(0,e.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,e.h)("img",{"data-nlg":!this.props.inWriter,href:t.router.toApp(this.props.url),class:"img-fluid cursor-pointer","data-origin":this.props.url,"data-src":this.props.preview&&!/gif/.test(this.props.data["content-type"])?t.util.thumbnail(this.props.preview.id,1366,768):this.props.url,src:this.props.preview&&!/gif/.test(this.props.data["content-type"])?t.util.thumbnail(this.props.preview.id,1366,99999):this.props.url})):/video/.test(this.props.data["content-type"])?(0,e.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,e.h)("video",{class:"img-fluid",controls:!0,src:this.props.url})):/audio/.test(this.props.data["content-type"])?(0,e.h)("div",{class:"container d-flex justify-content-center flex-wrap align-items-center"},(0,e.h)("audio",{class:"w-100",controls:!0},(0,e.h)("source",{src:this.props.url}))):this.props.data.title&&(this.props.preview||this.props.data.description)?(0,e.h)("a",{class:"preview-card seamless-link d-inline-block",target:"_blank",rel:"noreferrer",href:t.router.toApp(this.props.url)},(0,e.h)("div",{class:"card",style:"max-width: 480px"},this.props.preview&&(0,e.h)("img",{class:"card-img-top",src:t.util.crop(this.props.preview.id,320,180)}),(0,e.h)("div",{class:"card-body p-1"},(0,e.h)("h5",null,this.props.data.title),this.props.data.description&&(0,e.h)("p",null,(0,e.h)("small",null,this.props.data.description.slice(0,500)))))):null}render(){if(!this.props.url||!this.props.data)return null;let t=this.getPreview();return t?(0,e.h)("p",{class:"text-center card-text"},t):null}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","./embeds/twitch-embed.component.js":"gPUS","./embeds/bandcamp-embed.component.js":"U94H","./embeds/generic-embed.component.js":"bleW"}],"xBfm":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=i(require("./embed-block.component.js")),a=i(require("./file-grid.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}class r extends e.Component{constructor(e){super(e),this.state={preview:null}}displayMessageText(){if(!this.props.message.data)return"";let e=this.props.message.data.text.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim(),s=0,a=null;for(;a=t.util.getUrl(e.slice(s));){let t=a[0];t.length>=50&&(t=`${t.slice(0,25)}...${t.slice(-24)}`);let i=`<a href="${a[0]}" target="_blank">${t}</a>`;e=e.slice(0,a.index+s)+i+e.slice(a.index+s+a[0].length),s+=a.index+i.length}return{__html:e=e.replace(/\n/g,"<br/>")}}componentDidMount(){this.componentWillUpdate()}componentWillUpdate(){if(!this.state.gotPreview&&this.props.message&&this.props.message.data){let e=t.util.getUrl(this.props.message.data.text);e?t.http.get(`/api/links/by_url?url=${encodeURIComponent(e[0])}`).then(e=>{this.setState({preview:e,gotPreview:!0})}):this.setState({gotPreview:!0})}}render(){return(0,e.h)("div",{class:"message-body"},this.props.message.data&&this.props.message.data.title&&(0,e.h)("div",{class:"title"},(0,e.h)("span",null,this.props.message.data.title)),this.props.message.data&&this.props.message.data.text&&this.props.message.data.text.trim()&&(0,e.h)("p",{class:"card-text",dangerouslySetInnerHTML:this.displayMessageText()}),this.state.preview&&(0,e.h)(s.default,{key:this.state.preview.url,url:this.state.preview.url,preview:this.state.preview.preview,data:this.state.preview.data}),this.props.message.files&&(0,e.h)(a.default,{files:this.props.message.files}))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","./embed-block.component.js":"M0D7","./file-grid.component.js":"FklW"}],"jeBy":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),i=require("/misc"),s=n(require("./embed-block.component.js")),l=n(require("./file-grid.component.js"));function n(e){return e&&e.__esModule?e:{default:e}}function a(){return(a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e}).apply(this,arguments)}class r extends e.Component{constructor(e){super(e),this.sendMessage=this.sendMessage.bind(this),this.genPreview=this.genPreview.bind(this),this.postMessage=this.postMessage.bind(this),this.putMessage=this.putMessage.bind(this),this.onKeyPress=this.onKeyPress.bind(this),this.toggleFile=this.toggleFile.bind(this),this.inputImages=this.inputImages.bind(this),this.inputVideo=this.inputVideo.bind(this),this.uploadFile=this.uploadFile.bind(this),this.addFile=this.addFile.bind(this),this.removeFile=this.removeFile.bind(this),this.updateFile=this.updateFile.bind(this),this.manageWorkers=this.manageWorkers.bind(this),this.removeWorker=this.removeWorker.bind(this),this.addWorker=this.addWorker.bind(this),this.state={files:[],writerId:t.util.genId(),workers:[],workerManager:setInterval(this.manageWorkers,1e3)}}componentWillMount(){this.setState({files:this.props.files||[],link:null,preview:null})}componentDidMount(){document.getElementById("title")&&(document.getElementById("title").value=this.props.title||""),document.getElementById("text")&&(document.getElementById("text").value=this.props.text||"")}componentWillUnmount(){clearInterval(this.state.workerManager)}onKeyPress(e,t=!1){e.ctrlKey&&"Enter"==e.key?this.sendMessage():[" ","Enter","v"].includes(e.key)&&t&&this.genPreview(e.currentTarget)}genPreview(e){e.style.height="1px",e.style.height=`${25+e.scrollHeight}px`,setTimeout(()=>{let i=e.value.match(/(https?:\/\/[^\s]+)/gi);i&&i[0]!=this.state.link&&t.http.get(`/api/links/by_url?url=${encodeURIComponent(i[0])}`).then(t=>{t&&e.value.indexOf(i[0])>=0&&this.setState({link:i[0],preview:t})})},0)}toggleFile(e){let t=this.state.files,i=t.find(t=>t.fileIndex==e);i.removed=!i.removed,this.setState({files:t})}sendMessage(){this.props.messageId?this.putMessage():this.postMessage()}putMessage(){let e={files:this.state.files.filter(e=>!e.removed).map(e=>e.id).filter(e=>!!e),data:{text:document.getElementById("text").value}};document.getElementById("title")&&(e.data.title=document.getElementById("title").value||""),t.http.put(`/api/messages/${this.props.messageId}`,e).then(e=>{this.setState({sending:!1}),e?window.dispatchEvent(new CustomEvent("editMessage",{detail:e})):t.alert.add(t.lang.t("error_new_message"),"alert-danger")}),this.setState({sending:!0})}postMessage(){let e={createdAt:Math.floor(Date.now()/1e3),author:t.me.me.id,group:t.util.getId(this.props.group),children:[],files:this.state.files.filter(e=>!e.removed).map(e=>e.id).filter(e=>!!e),data:{text:(document.getElementById("text").value||"").substring(0,5e4)},lastActivityDate:Math.floor(Date.now()/1e3)};this.props.parent&&(e.parent=t.util.getId(this.props.parent)),document.getElementById("title")&&(e.data.title=document.getElementById("title").value||""),e.files.length||e.data.text||e.data.title?(t.http.post("/api/messages",e).then(e=>{if(!e)return this.setState({sending:!1}),void t.alert.add(t.lang.t("error_new_message"),"alert-danger");this.props.isChild?(this.setState({sending:!1}),window.dispatchEvent(new CustomEvent("newChild",{detail:e}))):setTimeout(()=>{window.dispatchEvent(new CustomEvent("newParent",{detail:e})),t.router.navigate(t.router.toApp(`/messages/${e.id}`))},500),this.setState({files:[],link:null,preview:null,writerId:t.util.genId()}),document.getElementById("text")&&(document.getElementById("text").value="")}),this.setState({sending:!0})):t.alert.add(t.lang.t("empty_message"),"alert-danger")}inputVideo(){const e=document.createElement("input");document.body.appendChild(e),e.style.display="none",e.type="file",e.accept="video/*",e.addEventListener("change",e=>{this.addFile(e.target.files[0],"video")}),e.click()}inputImages(){const e=document.createElement("input");document.body.appendChild(e),e.style.display="none",e.type="file",e.multiple="multiple",e.accept="image/*",e.addEventListener("change",e=>{Array.from(e.target.files).map(e=>this.addFile(e,"image"))}),e.click()}addFile(e,i){this.setState(s=>({files:[...s.files,{inputFile:e,type:i,id:t.util.genId(),progress:0,status:"initial"}]}))}updateFile(e,t,i=null){this.setState(i=>({files:i.files.map(i=>i.id===e?Object.assign(i,t):i)}),i)}removeFile(e){this.setState(t=>({files:t.files.filter(t=>t.id!=e)}))}manageWorkers(){if(this.state.workers.length>=navigator.hardwareConcurrency)return;let e=this.state.files.find(e=>!this.state.workers.map(e=>{var t;return null===(t=e.target)||void 0===t?void 0:t.id}).includes(e.id)&&"initial"==(null==e?void 0:e.status));if(e){let i={target:e,id:t.util.genId()};this.setState(e=>({workers:[...e.workers,i]}),()=>this.addWorker(i.id))}}removeWorker(e){this.setState(t=>({workers:t.workers.filter(t=>t.id!=e)}))}addWorker(e){let t=this.state.workers.find(t=>t.id==e);switch(t.target.type){case"image":require("_bundle_loader")(require.resolve("/lazy/image-service.js")).then(i=>{i.default.handleImage(t.target.inputFile,i=>{this.updateFile(t.target.id,{inputFile:i},this.uploadFile(t.target.id,()=>this.removeWorker(e)))})});break;case"video":this.uploadFile(t.target.inputFile,()=>this.removeWorker(e));break;default:console.warn(t.target),console.warn("unknown file type for worker")}}uploadFile(e,i=null){const s=new FormData;let l=this.state.files.find(t=>t.id==e);if(!(null==l?void 0:l.inputFile))throw console.log(this.state,l,e),"error";s.append("file",l.inputFile),s.append("fileIndex",this.state.files.findIndex(e=>e.id==l.id));let n=this.state.writerId;t.http.sendFile(s,t=>{n==this.state.writerId&&(t.status="ready",this.updateFile(e,t,i))},t=>{this.updateFile(e,{progress:Math.floor(t.loaded/t.total*100)})},i=>{console.warn(i),t.alert.add(t.lang.t("error_upload"),"alert-danger"),this.removeFile(e)})}render(){return this.state.sending?(0,e.h)("div",{class:"message-placeholder"},(0,e.h)("div",{class:"spinner orange-spinner"},(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null),(0,e.h)("div",null))):(0,e.h)("div",{class:"writer"},!this.props.isChild&&(0,e.h)("input",{type:"text",id:"title",onKeyPress:e=>this.onKeyPress(e),placeholder:t.lang.t("title_placeholder")}),(0,e.h)("textarea",{onKeyPress:e=>this.onKeyPress(e,!0),id:"text",rows:"5",autocomplete:"off",autofocus:this.props.focus,placeholder:t.lang.t("text_placeholder"),maxlength:"50000"}),this.state.preview&&(0,e.h)(s.default,a({inWriter:!0},this.state.preview)),!!this.state.files.length&&(0,e.h)(l.default,{key:this.state.files.reduce((e,t)=>e+t.id+t.fileIndex+t.error,""),files:this.state.files,toggleFile:this.toggleFile,inWriter:!0}),(0,e.h)("div",{class:"options"},(0,e.h)("button",{class:"option",onClick:e=>this.inputImages(e),title:t.lang.t("upload_image")},(0,e.h)(i.FaIcon,{family:"regular",icon:"images"})),(0,e.h)("button",{class:"option",onClick:e=>this.inputVideo(e),title:t.lang.t("upload_video")},(0,e.h)(i.FaIcon,{family:"solid",icon:"film"})),(0,e.h)("div",{class:"actions"},this.props.cancel&&(0,e.h)("button",{class:"cancel",onClick:e=>this.props.cancel(e)},t.lang.t("cancel")),(0,e.h)("button",{disabled:!this.props.group,type:"submit",class:"submit",onClick:e=>this.sendMessage(e)},t.lang.t("submit")))))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","./embed-block.component.js":"M0D7","./file-grid.component.js":"FklW","_bundle_loader":"TUK3","/lazy/image-service.js":[["image-service.c15d7544.js","Z93z"],"image-service.c15d7544.js.map","Z93z"]}],"u6BK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var s=require("preact"),e=require("/core"),t=p(require("./message-children.component.js")),i=p(require("./message-head.component.js")),a=p(require("./message-footer.component.js")),r=p(require("./message-body.component.js")),h=p(require("./writer.component.js"));function p(s){return s&&s.__esModule?s:{default:s}}class o extends s.Component{constructor(s){super(s),this.getComponentClass=this.getComponentClass.bind(this),this.editMessage=this.editMessage.bind(this),this.deleteMessage=this.deleteMessage.bind(this),this.shareMessage=this.shareMessage.bind(this),this.publishInGroup=this.publishInGroup.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.onEditMessage=this.onEditMessage.bind(this),this.openPublicLink=this.openPublicLink.bind(this),window.addEventListener("editMessage",this.onEditMessage)}async openPublicLink(s){s.preventDefault();let t=window.open("about:blank","_blank");const i=await e.http.get(`/api/messages/${this.props.message.id}/get-public-link`);t.location=`${window.origin}/public/${i.token}`}onEditMessage(s){if(s.detail.id==this.props.message.id){this.props.key=+Date.now();let e=this.props.message;e.data=s.detail.data,e.files=s.detail.files,this.setState({message:e,data:e.data,gotPreview:!1}),setTimeout(()=>this.setState({edit:!1}))}}getComponentClass(){let s="message";return this.props.isChild&&(s+=" child"),this.props.message.id==e.router.action&&(s+=" highlight"),s}deleteMessage(s){s.preventDefault(),confirm(e.lang.t("ask_delete_message"))&&(e.http.delete(`/api/messages/${this.props.message.id}`),this.props.isChild?this.setState({isRemoved:!0}):e.router.navigate(`/groups/${this.props.message.group.id}`,{data:{resetGroupDisplay:!0}}))}shareMessage(s){s.preventDefault(),e.router.navigate(`/share?message=${this.props.message.id}`)}editMessage(s){s.preventDefault(),this.setState({edit:!0})}publishInGroup(){e.http.put(`/api/messages/${this.props.message.id}`,{lastActivityDate:Math.floor(Date.now()/1e3),isInFront:!0}).then(s=>{s?e.router.navigate(`/groups/${this.props.message.group.id}`):alert.add(e.lang.t("error"),"alert-danger")})}cancelEdit(s){s.preventDefault(),this.setState({edit:!1})}displayWriter(e,t){return(0,s.h)(h.default,{cancel:this.state.edit?this.cancelEdit:null,files:this.state.edit?this.props.message.files:[],focus:t||!!this.state.edit,group:this.props.message.group,messageId:this.state.edit?this.props.message.id:null,parent:this.state.edit?this.props.message.parent:this.props.message.id,text:this.state.edit?this.props.message.data.text:"",title:this.state.edit?this.props.message.data.title:"",isChild:e})}render(){return this.state.isRemoved?null:(0,s.h)(s.Fragment,null,(0,s.h)("div",{id:this.props.message.id,className:this.getComponentClass()},this.state.edit&&this.displayWriter(this.props.isChild),!this.state.edit&&(0,s.h)(s.Fragment,null,this.props.preMessageHeadComponent,(0,s.h)(i.default,{author:this.props.message.author,message:this.props.message,isPublic:this.props.isPublic,isChild:this.props.isChild}),(0,s.h)("div",{class:"main"},(0,s.h)(r.default,{message:this.props.message,isPublic:this.props.isPublic,isChild:this.props.isChild}),(0,s.h)(a.default,{author:this.props.message.author,message:this.props.message,editMessage:this.editMessage,deleteMessage:this.deleteMessage,shareMessage:this.shareMessage,publishInGroup:this.publishInGroup,openPublicLink:this.openPublicLink,isPublic:this.props.isPublic,isChild:this.props.isChild})))),this.props.postMessageComponent,!this.props.isChild&&(0,s.h)(t.default,{childMessages:this.props.message.children,isPublic:this.props.isPublic,key:this.props.message.id,id:this.props.message.id}),!this.state.edit&&!this.props.isPublic&&!this.props.isChild&&(0,s.h)("div",{class:"message child mt-2"},e.me.me&&(0,s.h)("div",{class:"message-head d-none d-md-block"},(0,s.h)("img",{class:"rounded-circle w-3 material-shadow avatar",style:e.util.backgroundHash(e.me.me.id),src:e.me.me.avatar?e.util.crop(e.me.me.avatar.id,100,100):e.util.defaultAvatar})),this.displayWriter(!0,this.props.focus)))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","./message-children.component.js":"gXdK","./message-head.component.js":"rXDu","./message-footer.component.js":"W867","./message-body.component.js":"xBfm","./writer.component.js":"jeBy"}],"kSsz":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=i(require("./message.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(e){super(e),this.onNewChild=this.onNewChild.bind(this),window.addEventListener("newChild",this.onNewChild),this.state={message:this.props.message}}componentDidMount(){s.me.removeMatchingNotifications(this.props.message.id),setTimeout(()=>window.scrollTo(0,0))}onNewChild(e){const t=e.detail;let i=this.state.message;t.parent&&s.util.getId(t.parent)==i.id&&(t.author=s.me.me,i.children=[...i.children,t],this.setState(e=>({lastDisplayedChild:e.lastDisplayedChild+1,message:i})))}render(){if(this.state.message&&!this.state.isRemoved)return(0,e.h)(t.default,{message:this.state.message,focus:this.props.focus,isPublic:this.props.isPublic,isChild:!1})}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","./message.component.js":"u6BK"}],"Ttzu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=require("/misc");class a extends e.Component{constructor(e){super(e),this.state={author:null}}componentDidMount(){var e;(null===(e=this.props.message)||void 0===e?void 0:e.author)&&("string"==typeof this.props.message.author?s.http.get(`/api/users/${this.props.message.author}`).then(e=>e&&this.setState({author:e})):this.setState({author:this.props.message.author}))}getAvatar(t){return(0,e.h)("img",{title:t?t.name:"--",className:`avatar material-shadow${t?"":" removed-user"}`,style:s.util.backgroundHash(t?t.id:""),src:(null==t?void 0:t.avatar)?s.util.crop(t.avatar.id,100,100):s.util.defaultAvatar,onError:e=>e.currentTarget.src=s.util.defaultAvatar})}render(){return this.props.message?(0,e.h)("a",{class:"d-inline-block seamless-link message-preview unselectable",href:s.router.toApp(`/messages/${this.props.message.id}`),onClick:e=>s.router.onClick(e),title:this.props.message.data.title},(0,e.h)("div",{tabindex:this.props.tabindex,class:"card material-shadow"},this.getAvatar(this.state.author),this.props.message.preview?(0,e.h)("div",{class:"card-miniature",style:`background-image: url('${s.util.crop(s.util.getId(this.props.message.preview),320,180)}')`}):(0,e.h)("div",{class:"text-preview"},this.props.message.data.text),(0,e.h)("div",{class:"card-body border-top d-flex justify-content-between"},(0,e.h)("span",{class:"left-buffer"}),(0,e.h)("span",{class:"title",title:this.props.message.data.title||s.util.humanFullDate(this.props.message.lastActivityDate)},this.props.message.data.title||s.util.humanTime(this.props.message.lastActivityDate)),(0,e.h)("span",{class:"children"},!!this.props.message.children&&(0,e.h)("span",null,`${Array.isArray(this.props.message.children)?this.props.message.children.length:this.props.message.children} `,(0,e.h)(t.FaIcon,{family:s.me.isNew(this.props.message.id)?"solid":"regular",icon:"comment"})))))):null}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"tKGR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/misc");class i extends e.Component{constructor(e){super(e),this.state={message:e.message,title:e.message.data.title||"",text:e.message.data.text||"",preview:e.message.preview||null},this.getMiniature=this.getMiniature.bind(this),this.getLink=this.getLink.bind(this),this.displayMessageTitle=this.displayMessageTitle.bind(this),this.displayMessageText=this.displayMessageText.bind(this)}componentDidMount(){this.props.message.author&&t.http.get(`/api/users/${this.props.message.author}`).then(e=>e&&this.setState({author:e}))}displayAuthorName(){if(!this.state.author)return{__html:"--"};let e=this.state.author.name,s=e.split(" ");for(let i=0;i<s.length;i++)if(!s[i].match(t.util.urlRegExp)){let e=this.props.search.split(" ");for(let t=0;t<e.length;t++)s[i]=s[i].replace(new RegExp(e[t],"gi"),"<b>$&</b>")}return{__html:e=s.join(" ")}}displayMessageTitle(){if(!this.props.message.data||!this.props.message.data.title)return{__html:t.util.humanTime(this.props.message.lastActivityDate)};let e=this.props.message.data.title.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim(),s=e.split(" ");for(let i=0;i<s.length;i++)if(!s[i].match(t.util.urlRegExp)){let e=this.props.search.split(" ");for(let t=0;t<e.length;t++)s[i]=s[i].replace(new RegExp(e[t],"gi"),"<b>$&</b>")}return{__html:e=s.join(" ")}}displayMessageText(){if(!this.props.message.data||!this.props.message.data.text)return"";let e=this.props.message.data.text.replace(/</g,"&lt;").replace(/>/g,"&gt;").trim(),s=e.split("\n");for(let l=0;l<s.length;l++){let e=s[l].split(" ");for(let s=0;s<e.length;s++)if(!e[s].match(t.util.urlRegExp)){let t=this.props.search.split(" ");for(let a=0;a<t.length;a++)t[a]&&(e[s]=e[s].replace(new RegExp(t[a],"gi"),"<b>$&</b>"));let i=this.props.hashtags.split(" ");for(let a=0;a<i.length;a++)i[a]&&(e[s]=e[s].replace(new RegExp(`#${i[a]}`,"gi"),"<b>$&</b>"))}s[l]=e.join(" ")}e=s.join("\n");let i=0,a=null;for(;a=t.util.getUrl(e.slice(i));){let t=a[0];t.length>=50&&(t=`${t.slice(0,25)}...${t.slice(-24)}`);let s=this.props.search.split(" ");for(let e=0;e<s.length;e++)t=t.replace(new RegExp(s[e],"gi"),"<b>$&</b>");let l=`<a href="${a[0]}" target="_blank">${t}</a>`;e=e.slice(0,a.index+i)+l+e.slice(a.index+i+a[0].length),i+=a.index+l.length}return{__html:e=e.replace(/\n/g,"<br/>")}}getMiniature(){if(this.state.preview)return(0,e.h)("div",{class:"card-miniature",style:`background-image: url('${t.util.crop(this.state.preview,100,100)}')`});let s=t.util.defaultAvatar;return this.state.author&&this.state.author.avatar&&this.state.author.avatar.id&&(s=t.util.crop(this.state.author.avatar.id,100,100)),(0,e.h)("div",{class:"card-miniature",style:`background-image: url('${s}')`})}getLink(){return this.state.message.parent&&0==this.state.message.children?`/messages/${this.state.message.parent}/${this.state.message.id}`:`/messages/${this.state.message.id}`}render(){return(0,e.h)("a",{class:"d-inline-block seamless-link message-preview unselectable",href:t.router.toApp(this.getLink()),onClick:e=>t.router.onClick(e),title:this.state.title},(0,e.h)("div",{tabindex:this.props.tabindex,class:"card material-shadow"},(0,e.h)("div",{class:"card-body border-top"},this.getMiniature(),(0,e.h)("div",{class:"infos"},(0,e.h)("div",{class:"title",dangerouslySetInnerHTML:this.displayAuthorName()}),(0,e.h)("div",{class:"dot"},"•"),(0,e.h)("div",{class:"title",title:this.state.title||t.util.humanFullDate(this.state.message.lastActivityDate),dangerouslySetInnerHTML:this.displayMessageTitle()})),(0,e.h)("div",{class:"text"},this.state.text.trim()&&(0,e.h)("p",{class:"card-text",dangerouslySetInnerHTML:this.displayMessageText()})),(0,e.h)("div",{class:"children"},!!this.state.message.children&&(0,e.h)("span",null,`${this.state.message.children} `,(0,e.h)(s.FaIcon,{family:t.me.isNew(this.state.message.id)?"solid":"regular",icon:"comment"}))))))}}exports.default=i;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"EPQO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EmbedBlock=exports.MessageSearchResult=exports.MessagePreview=exports.MessageHead=exports.MessageChildren=exports.MessageChild=exports.MessageParent=exports.MessageFooter=exports.MessageBody=exports.FileGrid=void 0;var e=u(require("./file-grid.component.js")),s=u(require("./message-parent.component.js")),o=u(require("./message-child.component.js")),t=u(require("./message-body.component.js")),r=u(require("./message-children.component.js")),a=u(require("./message-head.component.js")),n=u(require("./message-footer.component.js")),p=u(require("./message-preview.component.js")),d=u(require("./message-search-result.component.js")),c=u(require("./embed-block.component.js"));function u(e){return e&&e.__esModule?e:{default:e}}const i=e.default;exports.FileGrid=i;const l=t.default;exports.MessageBody=l;const g=n.default;exports.MessageFooter=g;const m=s.default;exports.MessageParent=m;const x=o.default;exports.MessageChild=x;const M=r.default;exports.MessageChildren=M;const f=a.default;exports.MessageHead=f;const j=p.default;exports.MessagePreview=j;const h=d.default;exports.MessageSearchResult=h;const q=c.default;exports.EmbedBlock=q;
},{"./file-grid.component.js":"FklW","./message-parent.component.js":"kSsz","./message-child.component.js":"cVVC","./message-body.component.js":"xBfm","./message-children.component.js":"gXdK","./message-head.component.js":"rXDu","./message-footer.component.js":"W867","./message-preview.component.js":"Ttzu","./message-search-result.component.js":"tKGR","./embed-block.component.js":"M0D7"}],"I6Rh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=require("/message");class a extends e.Component{constructor(e){super(e);let t=s.util.getId(s.router.id);this.state={groupId:t,loaded:!1,messages:[],totalMessages:0,search:s.router.getParam("search").replace(/\+/g," "),hashtags:s.router.getParam("hashtags").replace(/\+/g," ")},this.loadMessages=this.loadMessages.bind(this),window.addEventListener("routerStateChange",()=>this.loadMessages())}getGroupName(){if(s.me.me.groups&&"group"==s.router.entity.entityType){let e=s.me.me.groups.find(e=>e.id==s.util.getId(s.router.entity));return e?e.name:""}return""}componentDidMount(){this.loadMessages()}loadMessages(){let e=s.router.getParam("search").replace(/\+/g," "),t=s.router.getParam("hashtags").split("+").join(" ");s.http.post("/api/messages/search",{group:this.state.groupId,search:e,hashtags:t}).then(s=>{s&&Array.isArray(s.messages)&&this.setState({search:e,messages:s.messages,totalMessages:s.totalItems,loaded:!0})})}render(){return Array.isArray(this.state.messages)&&(0,e.h)("div",null,(0,e.h)("a",{href:s.router.toApp(`/groups/${s.util.getGroupId()}`),onClick:e=>s.router.onClick(e)},(0,e.h)("div",{class:"group-name no-decoration"},s.util.getGroupName())),(0,e.h)("article",{id:"group",class:"justify-content-center d-flex"},(0,e.h)("div",{class:"search-results-container container-fluid d-flex justify-content-center flex-wrap"},0==this.state.messages.length&&this.state.loaded&&(0,e.h)("p",null,s.lang.t("search_without_result")),this.state.messages.map((s,a)=>(0,e.h)(t.MessageSearchResult,{tabindex:a+1,key:s.id,message:s,groupId:this.state.groupId,search:this.state.search,hashtags:this.state.hashtags})))))}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO"}],"WcYj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core"),t=require("/misc");class s extends e.Component{constructor(e){super(e),addEventListener("meStateChange",()=>this.setState({}))}render(){return(0,e.h)(e.Fragment,null,r.me.me.groups&&(0,e.h)("div",{class:"nav-link dropdown groups unselectable",tabindex:"-1",onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)("div",{class:"unselectable pr-1"},r.lang.t("groups")," ",(0,e.h)(t.FaIcon,{family:"solid",icon:"caret-down"})),(0,e.h)("div",{class:"dropdown-menu dropdown-left"},r.me.me.groups.map(t=>(0,e.h)("a",{class:"d-block seamless-link unselectable",href:r.router.toApp(`/groups/${t.id}`),onClick:e=>r.router.onClick(e)},t.name)),(0,e.h)("a",{class:"seamless-link unselectable",href:r.router.toApp("/create-group"),onClick:e=>r.router.onClick(e)},`+ ${r.lang.t("create_a_group")}`))))}}exports.default=s;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"lNP6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core");class r extends e.Component{constructor(){super(),this.postNewGroup=this.postNewGroup.bind(this)}postNewGroup(e){e.preventDefault();const r=document.querySelector("#create_group_form input[name='name']").value;let o={};if(!r)return!1;o.name=r,o.createdAt=Math.floor(Date.now()/1e3),t.http.post("/api/groups",o).then(e=>{t.http.post(`/api/groups/invitation/${e.secretKey}`,{}).then(e=>{window.location=`/groups/${e.id}`})})}render(){return(0,e.h)("div",{class:"container mt-2"},(0,e.h)("div",{class:"group-settings"},(0,e.h)("div",{class:"card"},(0,e.h)("div",{class:"card-body"},(0,e.h)("div",{class:"container-fluid p-1"},(0,e.h)("div",{class:"row"},(0,e.h)("div",{class:"col-12 col-md-10"},(0,e.h)("form",{id:"create_group_form",class:"mb-1"},(0,e.h)("div",{class:"form-group"},(0,e.h)("label",{for:"name"},t.lang.t("name"),": "),(0,e.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:t.lang.t("name_input"),class:"form-control",required:!0})),(0,e.h)("button",{onClick:e=>this.postNewGroup(e),class:"btn btn-primary"},t.lang.t("create_the_group"))))))))))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW"}],"Hinj":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/message"),a=require("/pages");class o extends e.Component{constructor(e){super(e);let s=t.util.getId(t.router.id),a=1+Math.floor(window.screen.width*window.screen.height/68800);this.state={groupId:s,loaded:a,messages:[],scrollTop:0,totalMessages:0,pageYOffset:0,page:0},this.scroll_cooldown=Date.now(),this.onScroll=this.onScroll.bind(this),this.loadMessages=this.loadMessages.bind(this),this.onNewParent=this.onNewParent.bind(this),window.addEventListener("newParent",this.onNewParent),window.addEventListener("resetCache",this.resetGroupDisplay)}onNewParent(){this.loadMessages(0)}componentDidMount(){this.loadMessages(0),window.addEventListener("scroll",this.onScroll)}componentWillUnmount(){window.removeEventListener("scroll",this.onScroll)}loadMessages(e){t.http.get(`/api/groups/${this.state.groupId}/page/${e}`).then(t=>{if(t&&Array.isArray(t.messages)){let s=Math.max(this.state.loaded,30*e),a=this.state.messages;t.messages.map(e=>!a.find(t=>t.id==e.id)&&a.push(e)),this.setState({messages:a,totalMessages:t.totalItems,page:e,loaded:s}),30*(e+1)<s&&setTimeout(()=>this.loadMessages(e+1))}})}onScroll(){"none"!=window.getComputedStyle(document.getElementById("group").parentNode).display&&this.scroll_cooldown+100<Date.now()&&(this.scroll_cooldown=Date.now(),this.setState({pageYOffset:window.pageYOffset}),Array.isArray(this.state.messages)&&document.body.scrollHeight-window.screen.height-500<window.pageYOffset&&this.state.loaded<this.state.totalMessages&&(this.setState(e=>({loaded:e.loaded+10})),this.state.loaded+30>this.state.messages.length&&(this.loadMessages(this.state.page+1),this.setState(e=>({page:e.page+1})))))}render(){return Array.isArray(this.state.messages)&&(0,e.h)("div",null,(0,e.h)(a.GroupTitle,{key:t.util.getGroupId(),id:t.util.getGroupId(),name:t.util.getGroupName()}),(0,e.h)("article",{id:"group",class:"justify-content-center d-flex"},(0,e.h)("div",{class:"message-container container-fluid d-flex justify-content-center flex-wrap"},this.state.messages.slice(0,this.state.loaded).map((a,o)=>(0,e.h)(s.MessagePreview,{tabindex:o+1,key:a.id,message:a,groupId:t.util.getId(t.router.id)})))))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO","/pages":"U7IS"}],"Z0FA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=require("/message");class a extends e.Component{constructor(e){super(e),this.state={messages:[]},this.loadBookmarks=this.loadBookmarks.bind(this),addEventListener("meStateChange",()=>this.loadBookmarks())}loadBookmarks(){var e,t;Promise.all(null===(e=s.me.me.data)||void 0===e?void 0:null===(t=e.bookmarks)||void 0===t?void 0:t.map(e=>s.http.get(`/api/messages/${e}`))).then(e=>this.setState({messages:e}))}componentDidMount(){this.loadBookmarks()}render(){return Array.isArray(this.state.messages)&&this.state.messages.length&&(0,e.h)("div",null,(0,e.h)("a",{href:s.router.toApp("/bookmarks"),onClick:e=>s.router.onClick(e),class:"no-decoration"},(0,e.h)("div",{class:"group-name"},s.lang.t("bookmarks"))),(0,e.h)("article",{id:"group",class:"justify-content-center d-flex"},(0,e.h)("div",{class:"message-container container-fluid d-flex justify-content-center flex-wrap"},this.state.messages.map((s,a)=>(0,e.h)(t.MessagePreview,{tabindex:a+1,key:s.id,message:s,groupId:s.group.id})))))}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO"}],"FJIr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core");class a extends t.Component{constructor(t){super(t),this.updateSettings=this.updateSettings.bind(this),this.leaveGroup=this.leaveGroup.bind(this),this.leave=this.leave.bind(this),this.resetSecretKey=this.resetSecretKey.bind(this),this.state=Object.assign({hydratedUsers:[]},t)}resetSecretKey(t){t.preventDefault(),e.http.post(`/api/groups/${this.state.id}/reset-invite-key`,{}).then(t=>{e.alert.add(e.lang.t("group_updated")),this.setState({secretKey:t.inviteKey})})}updateSettings(t){t.preventDefault();const a=document.querySelector("#settings_form input[name='name']").value;let s={};a&&(s.name=a),e.http.put(`/api/groups/${this.state.id}`,s).then(t=>{e.alert.add(e.lang.t("group_updated")),this.setState(e=>Object.assign(e,t))})}leaveGroup(t){if(t.preventDefault(),e.me.me.data.default_group==this.state.id){let t={};t.data={default_group:e.me.me.groups[0].id},e.http.put(`/api/users/${e.me.me.id}`,t).then(()=>{e.me.update(),this.leave()})}else this.leave()}leave(){e.http.post(`/api/groups/${this.state.id}/leave`,{}).then(t=>{t&&t.entityType?(e.me.update(),e.alert.add(e.lang.t("group_left")),e.router.navigate("/")):e.alert.add(e.lang.t("error"),"alert-danger")})}render(){return(0,t.h)("div",null,(0,t.h)("div",{class:"group-settings mb-3"},(0,t.h)("div",{class:"card"},(0,t.h)("div",{class:"card-body"},(0,t.h)("div",{class:"container-fluid p-1"},(0,t.h)("div",{class:"row"},(0,t.h)("div",{class:"col-12 col-md-10"},(0,t.h)("form",{id:"settings_form",class:"mb-1 border-bottom pb-1"},(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"name"},e.lang.t("name"),": "),(0,t.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:e.lang.t("name_input"),value:this.state.name,class:"form-control",required:!0})),(0,t.h)("button",{onClick:this.updateSettings,class:"btn btn-outline-secondary"},e.lang.t("save_changes"))),(0,t.h)("form",{class:"mb-1 border-bottom pb-1"},(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"inviteKey"},e.lang.t("invitation_link"),":"," "),(0,t.h)("input",{type:"text",name:"inviteKey",value:`${location.protocol}//${location.host}/invitation/${this.state.secretKey}`,class:"form-control font-size-80",readonly:"readonly"})),(0,t.h)("button",{class:"btn btn-outline-secondary",onClick:this.resetSecretKey},e.lang.t("reset_invitation_link"))),(0,t.h)("form",null,(0,t.h)("button",{onClick:t=>this.leaveGroup(t),class:"btn btn-outline-danger"},e.lang.t("quit_group"))))))))),(0,t.h)("div",{class:"user-list mb-3"},(0,t.h)("h3",null,e.lang.t("users")),this.props.users.map(a=>a&&(0,t.h)("div",{class:"user-card"},(0,t.h)("img",{class:"avatar material-shadow",style:e.util.backgroundHash(a.id),src:a.avatar?e.util.crop(a.avatar.id,200,200):e.util.defaultAvatar,onError:t=>t.currentTarget.src=e.util.defaultAvatar}),(0,t.h)("span",null,a.name)))))}}exports.default=a;
},{"preact":"aSor","/core":"rqMW"}],"e3YL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core");class a extends t.Component{constructor(t){super(t),this.destroyAccount=this.destroyAccount.bind(this),this.inputAvatar=this.inputAvatar.bind(this),this.updateSettings=this.updateSettings.bind(this),this.state=Object.assign({},t)}inputAvatar(){const t=document.createElement("input");t.type="file",t.accept="image/*",t.addEventListener("change",t=>{let a=new Image;a.onload=(()=>{let t=Math.min(a.naturalWidth,1024),l=Math.min(a.naturalHeight,1024),s=Math.min(t/a.naturalWidth,l/a.naturalHeight),n=Math.floor(a.naturalWidth*s),o=Math.floor(a.naturalHeight*s);require("_bundle_loader")(require.resolve("/lazy/image-service.js")).then(t=>{t.default.resize(a,n,o,t=>{const a=new FormData;a.append("file",t),e.http.post("/api/files",a,!1).then(t=>{e.http.put(`/api/users/${this.state.id}`,{avatar:t.id}).then(()=>{this.setState({avatar:t}),e.alert.add(e.lang.t("settings_updated"))})})})})}),a.src=URL.createObjectURL(t.target.files[0])}),t.click()}destroyAccount(t){t.preventDefault(),confirm(e.lang.t("are_you_sure"))&&e.http.delete(`/api/users/${this.state.id}`).then(()=>{e.router.navigate("/logout")})}updateSettings(t){t.preventDefault();const a=document.querySelector("#settings_form input[name='name']").value,l=document.querySelector("#settings_form input[name='email']").value,s=document.querySelector("#settings_form input[name='password']").value,n=document.querySelector("#settings_form select[name='notification_emails']").value,o=document.querySelector("#settings_form select[name='default_group']").value,r=document.querySelector("#settings_form select[name='lang']").value;let i={};a&&(i.name=a),l&&(i.login=l),s&&(i.password=s),i.data={notification_emails:n,default_group:o,lang:r},e.http.put(`/api/users/${this.state.id}`,i).then(t=>{t.error?e.alert.add(t.error,"alert-danger"):(e.cache.removeMatching(this.state.id),this.setState(e=>Object.assign(e,t)),location.href=e.router.toApp(`${location.pathname}?alert=settings_updated`))})}render(){return(0,t.h)("div",{class:"user-settings"},(0,t.h)("div",{class:"card"},(0,t.h)("div",{class:"identite card-body"},(0,t.h)("div",{class:"container-fluid p-1"},(0,t.h)("div",{class:"row"},(0,t.h)("div",{class:"col-12 col-md-2"},(0,t.h)("img",{class:"img-fluid rounded-circle material-shadow avatar",src:this.state.avatar?e.util.crop(this.state.avatar.id,100,100):e.util.defaultAvatar,style:e.util.backgroundHash(this.state.id||""),onError:t=>t.currentTarget.src=e.util.defaultAvatar,onClick:t=>this.inputAvatar(t)})),(0,t.h)("div",{class:"col-12 col-md-10"},(0,t.h)("form",{id:"settings_form",class:"mb-3"},(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"name"},e.lang.t("name"),": "),(0,t.h)("input",{type:"text",name:"name",minlength:"1",maxlength:"128",placeholder:e.lang.t("name_input"),value:this.state.name,class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"email"},e.lang.t("email"),": "),(0,t.h)("input",{type:"email",name:"email",placeholder:e.lang.t("email_input"),value:this.state.login,class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"password"},e.lang.t("password"),": "),(0,t.h)("input",{type:"password",name:"password",autocomplete:"off",minlength:"8",maxlength:"128",placeholder:e.lang.t("password_input"),class:"form-control"})),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"notification_emails"},e.lang.t("notification_emails"),":"),(0,t.h)("select",{name:"notification_emails",class:"form-control",value:this.state.data.notification_emails},(0,t.h)("option",{value:"none"},e.lang.t("none")),(0,t.h)("option",{value:"hourly"},e.lang.t("hourly")),(0,t.h)("option",{value:"daily"},e.lang.t("daily")),(0,t.h)("option",{value:"weekly"},e.lang.t("weekly")),(0,t.h)("option",{value:"monthly"},e.lang.t("monthly")))),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{for:"default_group"},e.lang.t("default_group"),":"),(0,t.h)("select",{name:"default_group",class:"form-control",value:this.state.data.default_group},e.me.me.groups.map(e=>(0,t.h)("option",{value:e.id},e.name)))),(0,t.h)("div",{class:"form-group"},(0,t.h)("label",{class:"capitalize",for:"lang"},e.lang.t("lang"),":"),(0,t.h)("select",{name:"lang",class:"form-control",value:e.lang.getCurrentLang()},Object.keys(e.lang.possibleLang).map(a=>(0,t.h)("option",{value:a},e.lang.possibleLang[a])))),(0,t.h)("button",{onClick:t=>this.updateSettings(t),class:"btn btn-primary"},e.lang.t("save_changes"))),(0,t.h)("form",{id:"destroy_form"},(0,t.h)("label",{class:"d-block",for:"destroy_account"},e.lang.t("destroy_account_explain")),(0,t.h)("button",{onClick:t=>this.destroyAccount(t),name:"destroy_account",class:"btn btn-danger"},e.lang.t("destroy_account")))))))),this.state.alert&&(0,t.h)("div",{class:"global-alert alert alert-success"},this.state.alert))}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","_bundle_loader":"TUK3","/lazy/image-service.js":[["image-service.c15d7544.js","Z93z"],"image-service.c15d7544.js.map","Z93z"]}],"TbUJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),s=n(require("./user-settings.component.js")),i=n(require("./group-settings.component.js"));function n(t){return t&&t.__esModule?t:{default:t}}class r extends t.Component{constructor(t){super(t),this.state={},t.entityUrl&&e.http.get(t.entityUrl).then(t=>this.setState({entity:t}))}render(){if(this.state.entity&&e.me.me)return(0,t.h)("div",{class:"settings"},(0,t.h)("ul",{class:"nav nav-tabs"},(0,t.h)("li",{class:"nav-item"},(0,t.h)("a",{class:`nav-link${"user"==this.state.entity.entityType?" active":""}`,href:e.router.toApp(`/users/${e.me.me.id}/settings`),onClick:t=>e.router.onClick(t)},e.lang.t("account"))),e.me.me.groups.length>0&&(0,t.h)("li",{class:"nav-item dropdown group-list",tabindex:"-1",onClick:t=>t.currentTarget.classList.toggle("active")},(0,t.h)("div",{class:`nav-link${"group"==this.state.entity.entityType?" active":""}`},e.lang.t("groups")),(0,t.h)("div",{class:"dropdown-menu"},e.me.me.groups.map(s=>(0,t.h)("a",{class:"seamless-link",href:e.router.toApp(`/groups/${s.id}/settings`),onClick:t=>e.router.onClick(t)},s.name))))),"user"===this.state.entity.entityType&&(0,t.h)(s.default,this.state.entity),"group"===this.state.entity.entityType&&(0,t.h)(i.default,this.state.entity))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","./user-settings.component.js":"e3YL","./group-settings.component.js":"FJIr"}],"kp7P":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.UserSettings=exports.Settings=exports.GroupSettings=void 0;var e=r(require("./group-settings.component.js")),t=r(require("./settings.component.js")),s=r(require("./user-settings.component.js"));function r(e){return e&&e.__esModule?e:{default:e}}const o=e.default;exports.GroupSettings=o;const n=t.default;exports.Settings=n;const u=s.default;exports.UserSettings=u;
},{"./group-settings.component.js":"FJIr","./settings.component.js":"TbUJ","./user-settings.component.js":"e3YL"}],"s19K":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=l;var e=require("preact"),r=require("/core"),t=require("/message"),a=require("/pages"),i=require("/settings"),u=require("/navbar"),s=require("/misc"),o=n(require("/message/writer.component.js"));function n(e){return e&&e.__esModule?e:{default:e}}function l(n){if("settings"==n.action)return(0,e.h)("article",{class:"mt-2 justify-content-center d-flex"},(0,e.h)("div",{class:"container pb-3"},(0,e.h)(i.Settings,{key:n.entityUrl,entityUrl:n.entityUrl})));switch(n.route){case"create-group":return(0,e.h)(a.CreateGroup,null);case"share":return(0,e.h)(a.Share,null);case"messages":return(0,e.h)("article",{class:"mb-3 justify-content-center d-flex"},(0,e.h)("div",{class:"container pb-3"},(0,e.h)(a.GroupTitle,{key:r.util.getGroupId(),id:r.util.getGroupId(),name:r.util.getGroupName()}),(0,e.h)(t.MessageParent,{focus:!!r.router.getParam("focus",r.router.search),key:r.router.entity.id,message:r.router.entity})));case"bookmarks":return(0,e.h)("div",null,(0,e.h)(a.BookmarkBoard,null));case"groups":return"write"==n.action?(0,e.h)("article",{class:"mb-3"},(0,e.h)("div",{class:"container pb-3"},(0,e.h)(a.GroupTitle,{key:r.util.getGroupId(),id:r.util.getGroupId(),name:r.util.getGroupName()}),(0,e.h)(o.default,{focus:!0,group:n.id}))):r.router.getParam("search")||r.router.getParam("hashtags")?(0,e.h)("div",null,(0,e.h)(u.GroupSearch,{key:n.id})):(0,e.h)("div",null,(0,e.h)(a.GroupBoard,{key:n.id}),(0,e.h)("a",{class:"write-button material-shadow seamless-link",href:r.router.toApp(`/groups/${n.id}/write`),onClick:e=>r.router.onClick(e)},(0,e.h)(s.FaIcon,{family:"solid",icon:"pencil-alt"})))}}
},{"preact":"aSor","/core":"rqMW","/message":"EPQO","/pages":"U7IS","/settings":"kp7P","/navbar":"slC9","/misc":"V5Rv","/message/writer.component.js":"jeBy"}],"AhCJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core");class s extends t.Component{constructor(t){super(t),this.getMiniature=this.getMiniature.bind(this),this.setMiniatureOnError=this.setMiniatureOnError.bind(this),this.getAction=this.getAction.bind(this),this.getTarget=this.getTarget.bind(this),this.getTitle=this.getTitle.bind(this),this.state={target:this.getTarget(),action:this.getAction(),title:this.getTitle()}}getMiniature(){let s=e.util.defaultAvatar;return this.props.fromUser&&this.props.fromUser.avatar&&"global_notification"!=this.props.type&&(s=e.util.crop(this.props.fromUser.avatar.id,80,80)),(0,t.h)("img",{style:e.util.backgroundHash(this.props.fromUser?this.props.fromUser.id:""),src:s,onError:t=>this.setMiniatureOnError(t)})}setMiniatureOnError(t){t.currentTarget.src=e.util.defaultAvatar}getAction(){switch(this.props.type){case"new_message":return e.lang.t("has_posted_in");case"new_comment":return e.lang.t("has_commented_on");case"user_joined_group":return e.lang.t("has_joined");case"user_left_group":return e.lang.t("has_left");case"group_name_change":return e.lang.t("changed_group_name");default:return""}}getTitle(){switch(this.props.type){case"new_message":case"new_comment":if(this.props.fromMessage&&this.props.fromMessage.data){if(this.props.fromMessage.data.title)return this.props.fromMessage.data.title;if(this.props.fromMessage.data.text){let t=e.util.getUrl(this.props.fromMessage.data.text);return t&&t.length>0&&(t=t[0]),t?(e.http.get(`/api/links/by_url?url=${encodeURIComponent(t)}`).then(t=>{this.setState({title:t.data.title||t.data.description||t.data.url})}),t):this.props.fromMessage.data.text}}return"";default:return""}}getObject(){switch(this.props.type){case"new_message":return(0,t.h)(t.Fragment,null,(0,t.h)("strong",null,this.props.fromGroup.name),this.state.title&&(0,t.h)(t.Fragment,null,(0,t.h)("br",null),(0,t.h)("small",null,(0,t.h)("em",null,e.util.limitStrSize(this.state.title,52)))));case"new_comment":return(0,t.h)("span",null,`${e.lang.t("the_message_from")} `,(0,t.h)("strong",null,this.props.fromMessage&&this.props.fromMessage.author?this.props.fromMessage.author.name:""),this.state.title&&(0,t.h)(t.Fragment,null,(0,t.h)("br",null),(0,t.h)("small",null,(0,t.h)("em",null,e.util.limitStrSize(this.state.title,52)))));case"user_joined_group":case"user_left_group":return(0,t.h)("strong",null,this.props.fromGroup.name);case"group_name_change":return(0,t.h)("span",null,(0,t.h)("strong",null,this.props.data.previousGroupName),` ${e.lang.t("to")} `,(0,t.h)("strong",null,this.props.data.newGroupName));case"global_notification":return this.props.data.text;default:return""}}getTarget(){switch(this.props.type){case"user_joined_group":case"user_left_group":case"group_name_change":return`/groups/${this.props.fromGroup.id}`;case"new_message":return`/messages/${this.props.target}`;case"new_comment":return`/messages/${this.props.fromMessage.id}/${this.props.target}`;case"global_notification":return this.props.target;default:return""}}render(){return(0,t.h)("a",{class:"notification seamless-link unselectable",href:e.router.toApp(this.state.target),onClick:t=>{t.preventDefault(),e.me.removeMatchingNotifications(this.props.id).then(()=>e.router.onClick(t,!1,this.state.target))}},(0,t.h)("div",{class:"miniature unselectable"},this.getMiniature()),(0,t.h)("div",{class:"infos"},(0,t.h)("div",{class:"description"},"global_notification"!=this.props.type&&(0,t.h)(t.Fragment,null,(0,t.h)("strong",null,this.props.fromUser.name||"--"),(0,t.h)("span",null,` ${this.state.action} `)),this.getObject()),(0,t.h)("div",{class:"date",title:e.util.humanFullDate(this.props.createdAt)},e.util.humanTime(this.props.createdAt))))}}exports.default=s;
},{"preact":"aSor","/core":"rqMW"}],"YeY7":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),r=require("/core"),t=require("/misc");class o extends e.Component{constructor(e){super(e),this.search=this.search.bind(this)}search(e){var t,o,i;e.preventDefault();let s="messages"==r.router.route?null===(t=r.router.entity)||void 0===t?void 0:null===(o=t.group)||void 0===o?void 0:o.id:null===(i=r.router.entity)||void 0===i?void 0:i.id,a=document.getElementById("search").value.normalize("NFD").replace(/[\u0300-\u036f]/g,"").split(" ");r.router.navigate(`/groups/${s}?search=${a.map(e=>encodeURIComponent(e)).join("+")}`)}render(){var o,i,s;if((null===(o=r.router.entity)||void 0===o?void 0:null===(i=o.group)||void 0===i?void 0:i.id)||(null===(s=r.router.entity)||void 0===s?void 0:s.id))return(0,e.h)("form",{class:"navbar-block search-block",onSubmit:e=>this.search(e)},(0,e.h)("div",{class:"input-group"},(0,e.h)("input",{class:"form-control",type:"text",id:"search",placeholder:r.lang.t("search_in_group"),value:decodeURIComponent(r.router.getParam("search").replace(/\+/g," "))}),(0,e.h)("div",{class:"input-group-append"},(0,e.h)("button",{class:"btn btn-secondary",type:"submit"},(0,e.h)(t.FaIcon,{family:"solid",icon:"search"})))))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv"}],"WLLU":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),s=r(require("/message/writer.component.js"));function r(t){return t&&t.__esModule?t:{default:t}}class a extends t.Component{constructor(){super();let t=new URL(window.location);this.state={loaded:!1,group:null,currentUrl:t,title:t.searchParams.get("title")||"",text:t.searchParams.get("text")||"",url:t.searchParams.get("url")||"",files:null},this.groupSelect=this.groupSelect.bind(this)}componentDidMount(){e.me.get().then(t=>{t.data.default_group?(this.setState({group:t.data.default_group}),e.router.backUrl=`/groups/${t.data.default_group}`):1==t.groups.length&&(this.setState({group:t.groups[0].id}),e.router.backUrl=`/groups/${t.groups[0]}`),this.state.currentUrl.searchParams.get("message")?e.http.get(`/api/messages/${this.state.currentUrl.searchParams.get("message")}`).then(t=>{this.setState({loaded:!0,title:t&&t.data.title||"",text:t&&t.data.text||"",url:"",files:t&&t.files||null})}):this.setState({loaded:!0})})}groupSelect(t){this.setState({group:t.target.value}),e.router.backUrl=`/groups/${t.target.value}`}render(){if(this.state.loaded)return(0,t.h)("article",{class:"mt-2"},(0,t.h)("div",{class:"container"},e.me.me&&e.me.me.groups.length>1&&(0,t.h)("div",{class:"mb-1"},(0,t.h)("label",{class:"px-1",for:"group_share_choice"},e.lang.t("group_share_choice")),(0,t.h)("select",{value:this.state.group,class:"form-control",name:"group_share_choice",onChange:t=>this.groupSelect(t),required:!0},e.me.me.groups.map(e=>(0,t.h)("option",{value:e.id},e.name)))),(0,t.h)(s.default,{focus:!0,group:this.state.group,title:this.state.title,text:this.state.text||this.state.url?`${this.state.text}\n${this.state.url}`:"",files:this.state.files})))}}exports.default=a;
},{"preact":"aSor","/core":"rqMW","/message/writer.component.js":"jeBy"}],"qHFq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=o;var e=require("preact"),r=require("/core");function o(){return(0,e.h)("a",{href:r.router.toApp(`/groups/${this.props.id}`),onClick:e=>r.router.onClick(e),class:"no-decoration"},(0,e.h)("div",{class:"group-name"},this.props.name))}
},{"preact":"aSor","/core":"rqMW"}],"U7IS":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GroupTitle=exports.Share=exports.Search=exports.Notification=exports.MainContent=exports.BookmarkBoard=exports.GroupBoard=exports.CreateGroup=void 0;var e=u(require("./create-group.component.js")),o=u(require("./group-board.component.js")),t=u(require("./bookmark-board.component.js")),r=u(require("./main-content.component.js")),n=u(require("./notification.component.js")),s=u(require("./search.component.js")),a=u(require("./share.component.js")),p=u(require("./group-title.component.js"));function u(e){return e&&e.__esModule?e:{default:e}}const c=e.default;exports.CreateGroup=c;const i=o.default;exports.GroupBoard=i;const d=t.default;exports.BookmarkBoard=d;const x=r.default;exports.MainContent=x;const l=n.default;exports.Notification=l;const f=s.default;exports.Search=f;const m=a.default;exports.Share=m;const j=p.default;exports.GroupTitle=j;
},{"./create-group.component.js":"lNP6","./group-board.component.js":"Hinj","./bookmark-board.component.js":"Z0FA","./main-content.component.js":"s19K","./notification.component.js":"AhCJ","./search.component.js":"YeY7","./share.component.js":"WLLU","./group-title.component.js":"qHFq"}],"jTq1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),o=require("/core"),r=require("/misc"),t=require("/pages"),a=require("/navbar");class l extends e.Component{constructor(e){super(e),this.clickBackButton=this.clickBackButton.bind(this),addEventListener("meStateChange",()=>this.setState({}))}clickBackButton(e){if(e.preventDefault(),o.router.backUrlPrompt&&!confirm(o.router.backUrlPrompt))return!1;o.router.onClick(e)}render(){var l,i,n,s,c,u,d,v,k,m;return(0,e.h)("div",{class:"main-nav nav align-items-center z-index-100"},(0,e.h)("div",{class:"navbar-block"},(["share"].includes(o.router.route)||["settings"].includes(o.router.action)||!o.router.backUrl)&&(0,e.h)("div",{class:"menu dropdown cursor-pointer",tabindex:"-1",onClick:e=>e.currentTarget.classList.toggle("active")},(0,e.h)("div",{class:"rounded-circle avatar unselectable"},(0,e.h)("img",{class:"rounded-circle",style:o.util.backgroundHash(o.me.me.id),src:o.me.me.avatar?o.util.crop(o.me.me.avatar.id,80,80):o.util.defaultAvatar,onError:e=>e.currentTarget.src=o.util.defaultAvatar})),(0,e.h)("div",{class:"dropdown-menu dropdown-right"},(0,e.h)("a",{class:"d-block seamless-link",href:o.router.toApp(`/users/${o.me.me.id}/settings`),onClick:e=>o.router.onClick(e)},o.lang.t("settings")),(0,e.h)("a",{class:"d-block seamless-link",href:o.router.toApp("/logout"),onClick:e=>o.router.onClick(e)},o.lang.t("logout")))),["groups","messages"].includes(o.router.route)&&o.router.backUrl&&(0,e.h)("a",{class:"seamless-link back",href:o.router.toApp(o.router.backUrl),onClick:e=>this.clickBackButton(e)},(0,e.h)(r.FaIcon,{family:"solid",icon:"arrow-left"})),(0,e.h)(a.NotificationsDropdownNavbar,null)),(0,e.h)(t.Search,null),(0,e.h)("div",{class:"navbar-block"},(0,e.h)("a",{href:(null===(l=o.me.me.data)||void 0===l?void 0:null===(i=l.bookmarks)||void 0===i?void 0:i.length)?o.router.toApp("/bookmarks"):void 0,onClick:e=>{var r,t;return(null===(r=o.me.me.data)||void 0===r?void 0:null===(t=r.bookmarks)||void 0===t?void 0:t.length)?o.router.onClick(e):void 0},title:o.lang.t("bookmarks"),className:`menu align-middle-inside color-white${(null===(n=o.me.me.data)||void 0===n?void 0:null===(s=n.bookmarks)||void 0===s?void 0:s.length)?" cursor-pointer":""}`},(0,e.h)("div",{class:"unselectable button-with-count"},(0,e.h)(r.FaIcon,{family:(null===(c=o.me.me.data)||void 0===c?void 0:null===(u=c.bookmarks)||void 0===u?void 0:u.length)?"solid":"regular",icon:"bookmark"}),!!(null===(d=o.me.me.data)||void 0===d?void 0:null===(v=d.bookmarks)||void 0===v?void 0:v.length)&&(0,e.h)("span",{class:"badge-count"},null===(k=o.me.me.data)||void 0===k?void 0:null===(m=k.bookmarks)||void 0===m?void 0:m.length))),(0,e.h)(a.GroupsDropdownNavbar,null)))}}exports.default=l;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","/pages":"U7IS","/navbar":"slC9"}],"P2ph":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("preact"),e=require("/core"),i=require("/misc"),n=require("/pages");function a(){return(a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}class o extends t.Component{constructor(t){super(t),addEventListener("meStateChange",()=>this.setState({})),this.clearAllNotifications=this.clearAllNotifications.bind(this)}clearAllNotifications(){e.me.me.notifications.length&&Promise.all(e.me.me.notifications.map(t=>e.http.delete(`/api/notifications/${t.id}`))).then(e.me.update())}render(){return(0,t.h)("div",{className:`menu dropdown${e.me.me.notifications.length?" cursor-pointer":""}`,title:e.lang.t("notifications"),tabindex:"-1",onClick:t=>e.me.me.notifications.length&&t.currentTarget.classList.toggle("active")},(0,t.h)("div",{class:"unselectable button-with-count"},(0,t.h)(i.FaIcon,{family:e.me.me.notifications.length?"solid":"regular",icon:"bell"}),!!e.me.me.notifications.length&&(0,t.h)("span",{class:"badge-count"},e.me.me.notifications.length)),(0,t.h)("div",{class:"dropdown-menu dropdown-right notifications-menu"},(0,t.h)("div",{class:"notification-header"},(0,t.h)("strong",{class:"capitalize"},e.lang.t("notifications")),(0,t.h)("div",{class:"action capitalize",onClick:()=>this.clearAllNotifications()},e.lang.t("mark_all_as_read"))),e.me.me.notifications?e.me.me.notifications.sort((t,e)=>e.createdAt-t.createdAt).map(e=>(0,t.h)(n.Notification,a({key:e.id},e))):null))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/misc":"V5Rv","/pages":"U7IS"}],"slC9":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NotificationsDropdownNavbar=exports.Navbar=exports.GroupsDropdownNavbar=exports.GroupSearch=void 0;var o=a(require("./group-search.component.js")),r=a(require("./groups-dropdown-navbar.component.js")),e=a(require("./navbar.component.js")),t=a(require("./notifications-dropdown-navbar.component.js"));function a(o){return o&&o.__esModule?o:{default:o}}const n=o.default;exports.GroupSearch=n;const s=r.default;exports.GroupsDropdownNavbar=s;const p=e.default;exports.Navbar=p;const u=t.default;exports.NotificationsDropdownNavbar=u;
},{"./group-search.component.js":"I6Rh","./groups-dropdown-navbar.component.js":"WcYj","./navbar.component.js":"jTq1","./notifications-dropdown-navbar.component.js":"P2ph"}],"TXJy":[function(require,module,exports) {
module.exports="zusam_logo.12e2d2b3.svg";
},{}],"GoyJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core"),t=a(require("/assets/zusam_logo.svg"));function a(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(){super(),this.state={showAlert:!1,error:""},this.sendLoginForm=this.sendLoginForm.bind(this),this.sendPasswordReset=this.sendPasswordReset.bind(this),this.showPasswordReset=this.showPasswordReset.bind(this),s.storage.get("apiKey").then(e=>e&&s.router.navigate("/"))}sendPasswordReset(e){e.preventDefault();let t=document.getElementById("login").value||"";t.toLowerCase(),this.setState({sending:!0}),s.http.post("/api/password-reset-mail",{mail:t}).then(e=>{this.setState({sending:!1}),e&&!e.message?s.alert.add(s.lang.t("password_reset_mail_sent")):s.alert.add(s.lang.t(e.message),"alert-danger")})}sendLoginForm(e){e.preventDefault(),this.setState({showAlert:!1,sending:!0});let t=document.getElementById("login").value||"";t.toLowerCase();const a=document.getElementById("password").value;s.http.post("/api/login",{login:t,password:a}).then(e=>{this.setState({sending:!1}),e&&e.api_key?s.storage.set("apiKey",e.api_key).then(()=>{s.me.update().then(()=>{setTimeout(()=>s.router.navigate("/"),100)})}):e&&e.message?s.alert.add(s.lang.t(e.message),"alert-danger"):s.alert.add(s.lang.t("error"),"alert-danger")})}showPasswordReset(){this.setState({showResetPassword:!0})}render(){return(0,e.h)("div",{class:"login"},(0,e.h)("div",{class:"login-form"},(0,e.h)("img",{src:t.default}),!this.state.showResetPassword&&(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:s.lang.t("login_placeholder")})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:s.lang.t("password_placeholder")})),(0,e.h)("div",{class:"forgot-password"},(0,e.h)("span",{onClick:e=>this.showPasswordReset(e)},s.lang.t("forgot_password"))),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendLoginForm(e),disabled:this.state.sending},s.lang.t("connect"))),!!this.state.showResetPassword&&(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:s.lang.t("login_placeholder")})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendPasswordReset(e),disabled:this.state.sending},s.lang.t("submit")))))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/assets/zusam_logo.svg":"TXJy"}],"gfHB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),s=require("/core");class t extends e.Component{constructor(){super(),this.sendNewPassword=this.sendNewPassword.bind(this)}sendNewPassword(e){e.preventDefault(),s.storage.set("apiKey","");const t=document.getElementById("password").value||"",r=document.getElementById("password_confirmation").value||"",a=s.router.getParam("mail"),o=s.router.getParam("key");if(a&&t){if(t!=r)return void s.alert.add(s.lang.t("passwords_dont_match"));s.http.post("/api/new-password",{mail:a,key:o,password:t}).then(e=>{e.api_key?(s.storage.set("apiKey",e.api_key),setTimeout(()=>s.router.navigate("/"),100)):s.alert.add(s.lang.t(e.message))}).catch(e=>console.warn(e))}}render(){return(0,e.h)("div",{class:"login"},(0,e.h)("div",{class:"login-form"},(0,e.h)("h2",{class:"title"},s.lang.t("reset_password_title")),(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:s.lang.t("new_password_placeholder")})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password_confirmation",placeholder:s.lang.t("confirm_password_placeholder")})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendNewPassword(e)},s.lang.t("submit")))))}}exports.default=t;
},{"preact":"aSor","/core":"rqMW"}],"HnNM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=r(require("/assets/zusam_logo.svg"));function r(e){return e&&e.__esModule?e:{default:e}}class o extends e.Component{constructor(){super(),this.state={showAlert:!1,error:"",inviteKey:t.router.getParam("inviteKey")},this.sendSignupForm=this.sendSignupForm.bind(this)}sendSignupForm(e){e.preventDefault(),this.setState({showAlert:!1});let s=document.getElementById("login").value||"";s.toLowerCase();const r=document.getElementById("password").value;t.storage.set("apiKey",""),t.http.post("/api/signup",{login:s,password:r,invite_key:this.state.inviteKey}).then(e=>{e&&!e.message?(t.storage.set("apiKey",e.api_key),setTimeout(()=>t.router.navigate("/"),100)):t.alert.add(t.lang.t(e.message))})}render(){return(0,e.h)("div",{class:"signup"},(0,e.h)("div",{class:"signup-form"},(0,e.h)("img",{src:s.default}),(0,e.h)("div",{class:"welcome lead"},t.lang.t("invitation_welcome")),(0,e.h)("form",null,(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"email",class:"form-control",required:!0,id:"login",placeholder:t.lang.t("login_placeholder")})),(0,e.h)("div",{class:"form-group"},(0,e.h)("input",{type:"password",class:"form-control",required:!0,id:"password",placeholder:t.lang.t("password_placeholder")})),(0,e.h)("button",{type:"submit",class:"btn btn-light",onClick:e=>this.sendSignupForm(e)},t.lang.t("signup")))))}}exports.default=o;
},{"preact":"aSor","/core":"rqMW","/assets/zusam_logo.svg":"TXJy"}],"IWRl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core");class s extends e.Component{constructor(){super(),t.http.get(`/api${window.location.pathname}`).then(()=>{this.setState({message:t.lang.t("notification_emails_stopped")})}).catch(e=>{console.warn(e),this.setState({message:t.lang.t("error")})})}render(){return(0,e.h)("div",null,this.state.message||"")}}exports.default=s;
},{"preact":"aSor","/core":"rqMW"}],"Zdby":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("preact"),t=require("/core"),s=require("/message");class r extends e.Component{constructor(e){super(e),this.state={}}componentDidMount(){this.props.token&&t.http.get(`/api/public/${this.props.token}`).then(e=>this.setState({message:e}))}render(){if(this.state.message)return(0,e.h)("article",{class:"justify-content-center d-flex mt-2"},(0,e.h)("div",{class:"container"},(0,e.h)(s.MessageParent,{isPublic:!0,key:this.state.message.id,message:this.state.message})))}}exports.default=r;
},{"preact":"aSor","/core":"rqMW","/message":"EPQO"}],"Dm2o":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Public=exports.StopNotificationEmails=exports.Signup=exports.ResetPassword=exports.Login=void 0;var e=i(require("./login.component.js")),o=i(require("./reset-password.component.js")),t=i(require("./signup.component.js")),s=i(require("./stop-notification-emails.component.js")),r=i(require("./public.component.js"));function i(e){return e&&e.__esModule?e:{default:e}}const n=e.default;exports.Login=n;const p=o.default;exports.ResetPassword=p;const u=t.default;exports.Signup=u;const c=s.default;exports.StopNotificationEmails=c;const a=r.default;exports.Public=a;
},{"./login.component.js":"GoyJ","./reset-password.component.js":"gfHB","./signup.component.js":"HnNM","./stop-notification-emails.component.js":"IWRl","./public.component.js":"Zdby"}],"A2T1":[function(require,module,exports) {
"use strict";var e=require("preact"),t=require("/core"),r=require("/navbar"),o=require("/pages"),i=require("/outside");class n extends e.Component{constructor(){super(),this.onRouterStateChange=this.onRouterStateChange.bind(this),console.log(`localStorage usage: ${t.storage.usage()}`),t.cache.purgeOldCache(),window.addEventListener("routerStateChange",this.onRouterStateChange),window.addEventListener("meStateChange",()=>this.setState({me:t.me.me})),window.addEventListener("fetchedNewDict",()=>this.setState({})),window.addEventListener("popstate",t.router.sync),window.addEventListener("click",e=>{e.target.closest(".dropdown")||document.querySelectorAll(".dropdown").forEach(e=>e.classList.remove("active"))}),t.lang.fetchDict(),t.storage.get("apiKey").then(e=>{t.router.isOutside()||e?t.router.sync():t.router.navigate("/login")}),this.state={action:t.router.action,route:t.router.route,id:t.router.id,entityUrl:t.router.entityUrl}}onRouterStateChange(){this.setState({action:t.router.action,route:t.router.route,id:t.router.id,entityUrl:t.router.entityUrl}),setTimeout(()=>window.scrollTo(0,0)),t.storage.get("apiKey").then(e=>{e&&"login"!=t.router.route?t.me.get().then(e=>{e||t.router.isOutside()?this.setState({action:t.router.action,route:t.router.route,id:t.router.id,me:e,entityUrl:t.router.entityUrl}):t.storage.set("apiKey","").then(()=>t.router.navigate("/login"))}):t.router.isOutside()||t.router.navigate("/login")}),t.alert.add(t.lang.t(t.router.getParam("alert",t.router.search)))}render(){switch(this.state.route){case"signup":return(0,e.h)(i.Signup,null);case"stop-notification-emails":return(0,e.h)(i.StopNotificationEmails,null);case"public":return(0,e.h)(i.Public,{token:this.state.id,key:this.state.id});case"password-reset":return(0,e.h)(i.ResetPassword,null);case"login":return(0,e.h)(i.Login,null)}if(this.state.me&&this.state.me.groups)return(0,e.h)("main",null,(0,e.h)(r.Navbar,null),(0,e.h)("div",{class:"content"},(0,e.h)(o.MainContent,this.state)))}}(0,e.render)((0,e.h)(n,null),document.body),"serviceWorker"in navigator&&window.addEventListener("load",()=>{location.search.includes("service-workers=unregister")&&(navigator.serviceWorker.getRegistrations().then(e=>{for(let t of e)t.unregister()}),console.log("Service workers unregistered")),navigator.serviceWorker.register("service-workers.js").then(e=>{console.log("ServiceWorker registration successful with scope: ",e.scope)},e=>{console.warn("ServiceWorker registration failed: ",e)})});
},{"preact":"aSor","/core":"rqMW","/navbar":"slC9","/pages":"U7IS","/outside":"Dm2o","/data/app/src/service-workers.js":[["service-workers.js","qGzB"],"service-workers.js.map","qGzB"]}],"Yi9z":[function(require,module,exports) {
module.exports=function(n){return new Promise(function(e,o){var r=document.createElement("script");r.async=!0,r.type="text/javascript",r.charset="utf-8",r.src=n,r.onerror=function(n){r.onerror=r.onload=null,o(n)},r.onload=function(){r.onerror=r.onload=null,e()},document.getElementsByTagName("head")[0].appendChild(r)})};
},{}],0:[function(require,module,exports) {
var b=require("TUK3");b.register("js",require("Yi9z"));
},{}]},{},[0,"A2T1"], null)
//# sourceMappingURL=app.6ccd5298.js.map